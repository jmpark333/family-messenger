module.exports=[12907,(a,b,c)=>{"use strict";let d={};d.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},d.localCName=d.generateIdentifier(),d.splitLines=function(a){return a.trim().split("\n").map(a=>a.trim())},d.splitSections=function(a){return a.split("\nm=").map((a,b)=>(b>0?"m="+a:a).trim()+"\r\n")},d.getDescription=function(a){let b=d.splitSections(a);return b&&b[0]},d.getMediaSections=function(a){let b=d.splitSections(a);return b.shift(),b},d.matchPrefix=function(a,b){return d.splitLines(a).filter(a=>0===a.indexOf(b))},d.parseCandidate=function(a){let b,c={foundation:(b=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[b[1]]||b[1],protocol:b[2].toLowerCase(),priority:parseInt(b[3],10),ip:b[4],address:b[4],port:parseInt(b[5],10),type:b[7]};for(let a=8;a<b.length;a+=2)switch(b[a]){case"raddr":c.relatedAddress=b[a+1];break;case"rport":c.relatedPort=parseInt(b[a+1],10);break;case"tcptype":c.tcpType=b[a+1];break;case"ufrag":c.ufrag=b[a+1],c.usernameFragment=b[a+1];break;default:void 0===c[b[a]]&&(c[b[a]]=b[a+1])}return c},d.writeCandidate=function(a){let b=[];b.push(a.foundation);let c=a.component;"rtp"===c?b.push(1):"rtcp"===c?b.push(2):b.push(c),b.push(a.protocol.toUpperCase()),b.push(a.priority),b.push(a.address||a.ip),b.push(a.port);let d=a.type;return b.push("typ"),b.push(d),"host"!==d&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort)),a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType)),(a.usernameFragment||a.ufrag)&&(b.push("ufrag"),b.push(a.usernameFragment||a.ufrag)),"candidate:"+b.join(" ")},d.parseIceOptions=function(a){return a.substring(14).split(" ")},d.parseRtpMap=function(a){let b=a.substring(9).split(" "),c={payloadType:parseInt(b.shift(),10)};return c.name=(b=b[0].split("/"))[0],c.clockRate=parseInt(b[1],10),c.channels=3===b.length?parseInt(b[2],10):1,c.numChannels=c.channels,c},d.writeRtpMap=function(a){let b=a.payloadType;void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType);let c=a.channels||a.numChannels||1;return"a=rtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==c?"/"+c:"")+"\r\n"},d.parseExtmap=function(a){let b=a.substring(9).split(" ");return{id:parseInt(b[0],10),direction:b[0].indexOf("/")>0?b[0].split("/")[1]:"sendrecv",uri:b[1],attributes:b.slice(2).join(" ")}},d.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+(a.direction&&"sendrecv"!==a.direction?"/"+a.direction:"")+" "+a.uri+(a.attributes?" "+a.attributes:"")+"\r\n"},d.parseFmtp=function(a){let b,c={},d=a.substring(a.indexOf(" ")+1).split(";");for(let a=0;a<d.length;a++)c[(b=d[a].trim().split("="))[0].trim()]=b[1];return c},d.writeFmtp=function(a){let b="",c=a.payloadType;if(void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.parameters&&Object.keys(a.parameters).length){let d=[];Object.keys(a.parameters).forEach(b=>{void 0!==a.parameters[b]?d.push(b+"="+a.parameters[b]):d.push(b)}),b+="a=fmtp:"+c+" "+d.join(";")+"\r\n"}return b},d.parseRtcpFb=function(a){let b=a.substring(a.indexOf(" ")+1).split(" ");return{type:b.shift(),parameter:b.join(" ")}},d.writeRtcpFb=function(a){let b="",c=a.payloadType;return void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(a=>{b+="a=rtcp-fb:"+c+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+"\r\n"}),b},d.parseSsrcMedia=function(a){let b=a.indexOf(" "),c={ssrc:parseInt(a.substring(7,b),10)},d=a.indexOf(":",b);return d>-1?(c.attribute=a.substring(b+1,d),c.value=a.substring(d+1)):c.attribute=a.substring(b+1),c},d.parseSsrcGroup=function(a){let b=a.substring(13).split(" ");return{semantics:b.shift(),ssrcs:b.map(a=>parseInt(a,10))}},d.getMid=function(a){let b=d.matchPrefix(a,"a=mid:")[0];if(b)return b.substring(6)},d.parseFingerprint=function(a){let b=a.substring(14).split(" ");return{algorithm:b[0].toLowerCase(),value:b[1].toUpperCase()}},d.getDtlsParameters=function(a,b){return{role:"auto",fingerprints:d.matchPrefix(a+b,"a=fingerprint:").map(d.parseFingerprint)}},d.writeDtlsParameters=function(a,b){let c="a=setup:"+b+"\r\n";return a.fingerprints.forEach(a=>{c+="a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"}),c},d.parseCryptoLine=function(a){let b=a.substring(9).split(" ");return{tag:parseInt(b[0],10),cryptoSuite:b[1],keyParams:b[2],sessionParams:b.slice(3)}},d.writeCryptoLine=function(a){return"a=crypto:"+a.tag+" "+a.cryptoSuite+" "+("object"==typeof a.keyParams?d.writeCryptoKeyParams(a.keyParams):a.keyParams)+(a.sessionParams?" "+a.sessionParams.join(" "):"")+"\r\n"},d.parseCryptoKeyParams=function(a){if(0!==a.indexOf("inline:"))return null;let b=a.substring(7).split("|");return{keyMethod:"inline",keySalt:b[0],lifeTime:b[1],mkiValue:b[2]?b[2].split(":")[0]:void 0,mkiLength:b[2]?b[2].split(":")[1]:void 0}},d.writeCryptoKeyParams=function(a){return a.keyMethod+":"+a.keySalt+(a.lifeTime?"|"+a.lifeTime:"")+(a.mkiValue&&a.mkiLength?"|"+a.mkiValue+":"+a.mkiLength:"")},d.getCryptoParameters=function(a,b){return d.matchPrefix(a+b,"a=crypto:").map(d.parseCryptoLine)},d.getIceParameters=function(a,b){let c=d.matchPrefix(a+b,"a=ice-ufrag:")[0],e=d.matchPrefix(a+b,"a=ice-pwd:")[0];return c&&e?{usernameFragment:c.substring(12),password:e.substring(10)}:null},d.writeIceParameters=function(a){let b="a=ice-ufrag:"+a.usernameFragment+"\r\na=ice-pwd:"+a.password+"\r\n";return a.iceLite&&(b+="a=ice-lite\r\n"),b},d.parseRtpParameters=function(a){let b={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=d.splitLines(a)[0].split(" ");b.profile=c[2];for(let e=3;e<c.length;e++){let f=c[e],g=d.matchPrefix(a,"a=rtpmap:"+f+" ")[0];if(g){let c=d.parseRtpMap(g),e=d.matchPrefix(a,"a=fmtp:"+f+" ");switch(c.parameters=e.length?d.parseFmtp(e[0]):{},c.rtcpFeedback=d.matchPrefix(a,"a=rtcp-fb:"+f+" ").map(d.parseRtcpFb),b.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":b.fecMechanisms.push(c.name.toUpperCase())}}}d.matchPrefix(a,"a=extmap:").forEach(a=>{b.headerExtensions.push(d.parseExtmap(a))});let e=d.matchPrefix(a,"a=rtcp-fb:* ").map(d.parseRtcpFb);return b.codecs.forEach(a=>{e.forEach(b=>{a.rtcpFeedback.find(a=>a.type===b.type&&a.parameter===b.parameter)||a.rtcpFeedback.push(b)})}),b},d.writeRtpDescription=function(a,b){let c="";c+="m="+a+" ",c+=b.codecs.length>0?"9":"0",c+=" "+(b.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=b.codecs.map(a=>void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType).join(" ")+"\r\n",c+="c=IN IP4 0.0.0.0\r\n",c+="a=rtcp:9 IN IP4 0.0.0.0\r\n",b.codecs.forEach(a=>{c+=d.writeRtpMap(a),c+=d.writeFmtp(a),c+=d.writeRtcpFb(a)});let e=0;return b.codecs.forEach(a=>{a.maxptime>e&&(e=a.maxptime)}),e>0&&(c+="a=maxptime:"+e+"\r\n"),b.headerExtensions&&b.headerExtensions.forEach(a=>{c+=d.writeExtmap(a)}),c},d.parseRtpEncodingParameters=function(a){let b,c=[],e=d.parseRtpParameters(a),f=-1!==e.fecMechanisms.indexOf("RED"),g=-1!==e.fecMechanisms.indexOf("ULPFEC"),h=d.matchPrefix(a,"a=ssrc:").map(a=>d.parseSsrcMedia(a)).filter(a=>"cname"===a.attribute),i=h.length>0&&h[0].ssrc,j=d.matchPrefix(a,"a=ssrc-group:FID").map(a=>a.substring(17).split(" ").map(a=>parseInt(a,10)));j.length>0&&j[0].length>1&&j[0][0]===i&&(b=j[0][1]),e.codecs.forEach(a=>{if("RTX"===a.name.toUpperCase()&&a.parameters.apt){let d={ssrc:i,codecPayloadType:parseInt(a.parameters.apt,10)};i&&b&&(d.rtx={ssrc:b}),c.push(d),f&&((d=JSON.parse(JSON.stringify(d))).fec={ssrc:i,mechanism:g?"red+ulpfec":"red"},c.push(d))}}),0===c.length&&i&&c.push({ssrc:i});let k=d.matchPrefix(a,"b=");return k.length&&(k=0===k[0].indexOf("b=TIAS:")?parseInt(k[0].substring(7),10):0===k[0].indexOf("b=AS:")?1e3*parseInt(k[0].substring(5),10)*.95-16e3:void 0,c.forEach(a=>{a.maxBitrate=k})),c},d.parseRtcpParameters=function(a){let b={},c=d.matchPrefix(a,"a=ssrc:").map(a=>d.parseSsrcMedia(a)).filter(a=>"cname"===a.attribute)[0];c&&(b.cname=c.value,b.ssrc=c.ssrc);let e=d.matchPrefix(a,"a=rtcp-rsize");return b.reducedSize=e.length>0,b.compound=0===e.length,b.mux=d.matchPrefix(a,"a=rtcp-mux").length>0,b},d.writeRtcpParameters=function(a){let b="";return a.reducedSize&&(b+="a=rtcp-rsize\r\n"),a.mux&&(b+="a=rtcp-mux\r\n"),void 0!==a.ssrc&&a.cname&&(b+="a=ssrc:"+a.ssrc+" cname:"+a.cname+"\r\n"),b},d.parseMsid=function(a){let b,c=d.matchPrefix(a,"a=msid:");if(1===c.length)return{stream:(b=c[0].substring(7).split(" "))[0],track:b[1]};let e=d.matchPrefix(a,"a=ssrc:").map(a=>d.parseSsrcMedia(a)).filter(a=>"msid"===a.attribute);if(e.length>0)return{stream:(b=e[0].value.split(" "))[0],track:b[1]}},d.parseSctpDescription=function(a){let b,c=d.parseMLine(a),e=d.matchPrefix(a,"a=max-message-size:");e.length>0&&(b=parseInt(e[0].substring(19),10)),isNaN(b)&&(b=65536);let f=d.matchPrefix(a,"a=sctp-port:");if(f.length>0)return{port:parseInt(f[0].substring(12),10),protocol:c.fmt,maxMessageSize:b};let g=d.matchPrefix(a,"a=sctpmap:");if(g.length>0){let a=g[0].substring(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:b}}},d.writeSctpDescription=function(a,b){let c=[];return c="DTLS/SCTP"!==a.protocol?["m="+a.kind+" 9 "+a.protocol+" "+b.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+b.port+"\r\n"]:["m="+a.kind+" 9 "+a.protocol+" "+b.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+b.port+" "+b.protocol+" 65535\r\n"],void 0!==b.maxMessageSize&&c.push("a=max-message-size:"+b.maxMessageSize+"\r\n"),c.join("")},d.generateSessionId=function(){return Math.random().toString().substr(2,22)},d.writeSessionBoilerplate=function(a,b,c){return"v=0\r\no="+(c||"thisisadapterortc")+" "+(a||d.generateSessionId())+" "+(void 0!==b?b:2)+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},d.getDirection=function(a,b){let c=d.splitLines(a);for(let a=0;a<c.length;a++)switch(c[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[a].substring(2)}return b?d.getDirection(b):"sendrecv"},d.getKind=function(a){return d.splitLines(a)[0].split(" ")[0].substring(2)},d.isRejected=function(a){return"0"===a.split(" ",2)[1]},d.parseMLine=function(a){let b=d.splitLines(a)[0].substring(2).split(" ");return{kind:b[0],port:parseInt(b[1],10),protocol:b[2],fmt:b.slice(3).join(" ")}},d.parseOLine=function(a){let b=d.matchPrefix(a,"o=")[0].substring(2).split(" ");return{username:b[0],sessionId:b[1],sessionVersion:parseInt(b[2],10),netType:b[3],addressType:b[4],address:b[5]}},d.isValidSDP=function(a){if("string"!=typeof a||0===a.length)return!1;let b=d.splitLines(a);for(let a=0;a<b.length;a++)if(b[a].length<2||"="!==b[a].charAt(1))return!1;return!0},b.exports=d},24187,a=>{"use strict";let b,c,d;var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=a.i(35618),v=a.i(18199);let w=a=>{let b,c=new Set,d=(a,d)=>{let e="function"==typeof a?a(b):a;if(!Object.is(e,b)){let a=b;b=(null!=d?d:"object"!=typeof e||null===e)?e:Object.assign({},b,e),c.forEach(c=>c(b,a))}},e=()=>b,f={setState:d,getState:e,getInitialState:()=>g,subscribe:a=>(c.add(a),()=>c.delete(a))},g=b=a(d,e,f);return f},x=a=>{let b=a?w(a):w,c=a=>(function(a,b=a=>a){let c=v.default.useSyncExternalStore(a.subscribe,v.default.useCallback(()=>b(a.getState()),[a,b]),v.default.useCallback(()=>b(a.getInitialState()),[a,b]));return v.default.useDebugValue(c),c})(b,a);return Object.assign(c,b),c},y={isAuthenticated:!1,familyKey:null,myPeerId:"",myName:"",peers:new Map,connectionStatus:"disconnected",messages:[],typingUsers:new Map,isSetupComplete:!1,showKeyExchange:!1},z=(b=(a,b)=>({...y,setAuthenticated:(b,c)=>a({isAuthenticated:b,familyKey:c||null}),setMyInfo:(b,c)=>a({myPeerId:b,myName:c}),addPeer:b=>a(a=>{let c=new Map(a.peers);return c.set(b.id,b),{peers:c}}),removePeer:b=>a(a=>{let c=new Map(a.peers);return c.delete(b),{peers:c}}),updatePeer:(b,c)=>a(a=>{let d=new Map(a.peers),e=d.get(b);return e&&d.set(b,{...e,...c}),{peers:d}}),setConnectionStatus:b=>a({connectionStatus:b}),addMessage:b=>a(a=>({messages:[...a.messages,b]})),updateMessageStatus:(b,c)=>a(a=>({messages:a.messages.map(a=>a.id===b?{...a,status:c}:a)})),clearMessages:()=>a({messages:[]}),setTyping:(c,d)=>{let e=new Map(b().typingUsers);if(d)e.set(c,setTimeout(()=>{b().setTyping(c,!1)},3e3));else{let a=e.get(c);a&&(clearTimeout(a),e.delete(c))}a({typingUsers:e})},setSetupComplete:b=>a({isSetupComplete:b}),setShowKeyExchange:b=>a({showKeyExchange:b}),reset:()=>a(y)}))?x(b):x,A=a=>Array.from(a.peers.values()).filter(a=>a.connected),B=a=>Array.from(a.typingUsers.keys());class C{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(a){this.flush(),this._parts.push(a)}append(a){this._pieces.push(a)}flush(){if(this._pieces.length>0){let a=new Uint8Array(this._pieces);this._parts.push(a),this._pieces=[]}}toArrayBuffer(){let a=[];for(let b of this._parts)a.push(b);return function(a){let b=0;for(let c of a)b+=c.byteLength;let c=new Uint8Array(b),d=0;for(let b of a){let a=new Uint8Array(b.buffer,b.byteOffset,b.byteLength);c.set(a,d),d+=b.byteLength}return c}(a).buffer}}function D(a){return new F(a).unpack()}function E(a){let b=new G,c=b.pack(a);return c instanceof Promise?c.then(()=>b.getBuffer()):b.getBuffer()}class F{constructor(a){this.index=0,this.dataBuffer=a,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){let a,b=this.unpack_uint8();if(b<128)return b;if((224^b)<32)return(224^b)-32;if((a=160^b)<=15)return this.unpack_raw(a);if((a=176^b)<=15)return this.unpack_string(a);if((a=144^b)<=15)return this.unpack_array(a);if((a=128^b)<=15)return this.unpack_map(a);switch(b){case 192:return null;case 193:case 212:case 213:case 214:case 215:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 216:return a=this.unpack_uint16(),this.unpack_string(a);case 217:return a=this.unpack_uint32(),this.unpack_string(a);case 218:return a=this.unpack_uint16(),this.unpack_raw(a);case 219:return a=this.unpack_uint32(),this.unpack_raw(a);case 220:return a=this.unpack_uint16(),this.unpack_array(a);case 221:return a=this.unpack_uint32(),this.unpack_array(a);case 222:return a=this.unpack_uint16(),this.unpack_map(a);case 223:return a=this.unpack_uint32(),this.unpack_map(a)}}unpack_uint8(){let a=255&this.dataView[this.index];return this.index++,a}unpack_uint16(){let a=this.read(2),b=(255&a[0])*256+(255&a[1]);return this.index+=2,b}unpack_uint32(){let a=this.read(4),b=((256*a[0]+a[1])*256+a[2])*256+a[3];return this.index+=4,b}unpack_uint64(){let a=this.read(8),b=((((((256*a[0]+a[1])*256+a[2])*256+a[3])*256+a[4])*256+a[5])*256+a[6])*256+a[7];return this.index+=8,b}unpack_int8(){let a=this.unpack_uint8();return a<128?a:a-256}unpack_int16(){let a=this.unpack_uint16();return a<32768?a:a-65536}unpack_int32(){let a=this.unpack_uint32();return a<0x80000000?a:a-0x100000000}unpack_int64(){let a=this.unpack_uint64();return a<0x8000000000000000?a:a-0xffffffffffffffff}unpack_raw(a){if(this.length<this.index+a)throw Error(`BinaryPackFailure: index is out of range ${this.index} ${a} ${this.length}`);let b=this.dataBuffer.slice(this.index,this.index+a);return this.index+=a,b}unpack_string(a){let b,c,d=this.read(a),e=0,f="";for(;e<a;)(b=d[e])<160?(c=b,e++):(192^b)<32?(c=(31&b)<<6|63&d[e+1],e+=2):(224^b)<16?(c=(15&b)<<12|(63&d[e+1])<<6|63&d[e+2],e+=3):(c=(7&b)<<18|(63&d[e+1])<<12|(63&d[e+2])<<6|63&d[e+3],e+=4),f+=String.fromCodePoint(c);return this.index+=a,f}unpack_array(a){let b=Array(a);for(let c=0;c<a;c++)b[c]=this.unpack();return b}unpack_map(a){let b={};for(let c=0;c<a;c++)b[this.unpack()]=this.unpack();return b}unpack_float(){let a=this.unpack_uint32();return(0==a>>31?1:-1)*(8388607&a|8388608)*2**((a>>23&255)-127-23)}unpack_double(){let a=this.unpack_uint32(),b=this.unpack_uint32(),c=(a>>20&2047)-1023;return(0==a>>31?1:-1)*((1048575&a|1048576)*2**(c-20)+b*2**(c-52))}read(a){let b=this.index;if(b+a<=this.length)return this.dataView.subarray(b,b+a);throw Error("BinaryPackFailure: read index out of range")}}class G{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(a){if("string"==typeof a)this.pack_string(a);else if("number"==typeof a)Math.floor(a)===a?this.pack_integer(a):this.pack_double(a);else if("boolean"==typeof a)!0===a?this._bufferBuilder.append(195):!1===a&&this._bufferBuilder.append(194);else if(void 0===a)this._bufferBuilder.append(192);else if("object"==typeof a)if(null===a)this._bufferBuilder.append(192);else{let b=a.constructor;if(a instanceof Array){let b=this.pack_array(a);if(b instanceof Promise)return b.then(()=>this._bufferBuilder.flush())}else if(a instanceof ArrayBuffer)this.pack_bin(new Uint8Array(a));else if("BYTES_PER_ELEMENT"in a)this.pack_bin(new Uint8Array(a.buffer,a.byteOffset,a.byteLength));else if(a instanceof Date)this.pack_string(a.toString());else if(a instanceof Blob)return a.arrayBuffer().then(a=>{this.pack_bin(new Uint8Array(a)),this._bufferBuilder.flush()});else if(b==Object||b.toString().startsWith("class")){let b=this.pack_object(a);if(b instanceof Promise)return b.then(()=>this._bufferBuilder.flush())}else throw Error(`Type "${b.toString()}" not yet supported`)}else throw Error(`Type "${typeof a}" not yet supported`);this._bufferBuilder.flush()}pack_bin(a){let b=a.length;if(b<=15)this.pack_uint8(160+b);else if(b<=65535)this._bufferBuilder.append(218),this.pack_uint16(b);else if(b<=0xffffffff)this._bufferBuilder.append(219),this.pack_uint32(b);else throw Error("Invalid length");this._bufferBuilder.append_buffer(a)}pack_string(a){let b=this._textEncoder.encode(a),c=b.length;if(c<=15)this.pack_uint8(176+c);else if(c<=65535)this._bufferBuilder.append(216),this.pack_uint16(c);else if(c<=0xffffffff)this._bufferBuilder.append(217),this.pack_uint32(c);else throw Error("Invalid length");this._bufferBuilder.append_buffer(b)}pack_array(a){let b=a.length;if(b<=15)this.pack_uint8(144+b);else if(b<=65535)this._bufferBuilder.append(220),this.pack_uint16(b);else if(b<=0xffffffff)this._bufferBuilder.append(221),this.pack_uint32(b);else throw Error("Invalid length");let c=d=>{if(d<b){let b=this.pack(a[d]);return b instanceof Promise?b.then(()=>c(d+1)):c(d+1)}};return c(0)}pack_integer(a){if(a>=-32&&a<=127)this._bufferBuilder.append(255&a);else if(a>=0&&a<=255)this._bufferBuilder.append(204),this.pack_uint8(a);else if(a>=-128&&a<=127)this._bufferBuilder.append(208),this.pack_int8(a);else if(a>=0&&a<=65535)this._bufferBuilder.append(205),this.pack_uint16(a);else if(a>=-32768&&a<=32767)this._bufferBuilder.append(209),this.pack_int16(a);else if(a>=0&&a<=0xffffffff)this._bufferBuilder.append(206),this.pack_uint32(a);else if(a>=-0x80000000&&a<=0x7fffffff)this._bufferBuilder.append(210),this.pack_int32(a);else if(a>=-0x8000000000000000&&a<=0x8000000000000000)this._bufferBuilder.append(211),this.pack_int64(a);else if(a>=0&&a<=0xffffffffffffffff)this._bufferBuilder.append(207),this.pack_uint64(a);else throw Error("Invalid integer")}pack_double(a){let b=0;a<0&&(b=1,a=-a);let c=Math.floor(Math.log(a)/Math.LN2),d=Math.floor((a/2**c-1)*0x10000000000000),e=b<<31|c+1023<<20|d/0x100000000&1048575;this._bufferBuilder.append(203),this.pack_int32(e),this.pack_int32(d%0x100000000)}pack_object(a){let b=Object.keys(a),c=b.length;if(c<=15)this.pack_uint8(128+c);else if(c<=65535)this._bufferBuilder.append(222),this.pack_uint16(c);else if(c<=0xffffffff)this._bufferBuilder.append(223),this.pack_uint32(c);else throw Error("Invalid length");let d=c=>{if(c<b.length){let e=b[c];if(a.hasOwnProperty(e)){this.pack(e);let b=this.pack(a[e]);if(b instanceof Promise)return b.then(()=>d(c+1))}return d(c+1)}};return d(0)}pack_uint8(a){this._bufferBuilder.append(a)}pack_uint16(a){this._bufferBuilder.append(a>>8),this._bufferBuilder.append(255&a)}pack_uint32(a){let b=0|a;this._bufferBuilder.append((0xff000000&b)>>>24),this._bufferBuilder.append((0xff0000&b)>>>16),this._bufferBuilder.append((65280&b)>>>8),this._bufferBuilder.append(255&b)}pack_uint64(a){let b=a/0x100000000,c=a%0x100000000;this._bufferBuilder.append((0xff000000&b)>>>24),this._bufferBuilder.append((0xff0000&b)>>>16),this._bufferBuilder.append((65280&b)>>>8),this._bufferBuilder.append(255&b),this._bufferBuilder.append((0xff000000&c)>>>24),this._bufferBuilder.append((0xff0000&c)>>>16),this._bufferBuilder.append((65280&c)>>>8),this._bufferBuilder.append(255&c)}pack_int8(a){this._bufferBuilder.append(255&a)}pack_int16(a){this._bufferBuilder.append((65280&a)>>8),this._bufferBuilder.append(255&a)}pack_int32(a){this._bufferBuilder.append(a>>>24&255),this._bufferBuilder.append((0xff0000&a)>>>16),this._bufferBuilder.append((65280&a)>>>8),this._bufferBuilder.append(255&a)}pack_int64(a){let b=Math.floor(a/0x100000000),c=a%0x100000000;this._bufferBuilder.append((0xff000000&b)>>>24),this._bufferBuilder.append((0xff0000&b)>>>16),this._bufferBuilder.append((65280&b)>>>8),this._bufferBuilder.append(255&b),this._bufferBuilder.append((0xff000000&c)>>>24),this._bufferBuilder.append((0xff0000&c)>>>16),this._bufferBuilder.append((65280&c)>>>8),this._bufferBuilder.append(255&c)}constructor(){this._bufferBuilder=new C,this._textEncoder=new TextEncoder}}let H=!0;function I(a,b,c){let d=a.match(b);return d&&d.length>=c&&parseFloat(d[c],10)}function J(a,b,c){if(!a.RTCPeerConnection)return;let d=a.RTCPeerConnection.prototype,e=d.addEventListener;d.addEventListener=function(a,d){if(a!==b)return e.apply(this,arguments);let f=a=>{let b=c(a);b&&(d.handleEvent?d.handleEvent(b):d(b))};return this._eventMap=this._eventMap||{},this._eventMap[b]||(this._eventMap[b]=new Map),this._eventMap[b].set(d,f),e.apply(this,[a,f])};let f=d.removeEventListener;d.removeEventListener=function(a,c){if(a!==b||!this._eventMap||!this._eventMap[b]||!this._eventMap[b].has(c))return f.apply(this,arguments);let d=this._eventMap[b].get(c);return this._eventMap[b].delete(c),0===this._eventMap[b].size&&delete this._eventMap[b],0===Object.keys(this._eventMap).length&&delete this._eventMap,f.apply(this,[a,d])},Object.defineProperty(d,"on"+b,{get(){return this["_on"+b]},set(a){this["_on"+b]&&(this.removeEventListener(b,this["_on"+b]),delete this["_on"+b]),a&&this.addEventListener(b,this["_on"+b]=a)},enumerable:!0,configurable:!0})}function K(a){return"boolean"!=typeof a?Error("Argument type: "+typeof a+". Please use a boolean."):a?"adapter.js logging disabled":"adapter.js logging enabled"}function L(a){return"boolean"!=typeof a?Error("Argument type: "+typeof a+". Please use a boolean."):(H=!a,"adapter.js deprecation warnings "+(a?"disabled":"enabled"))}function M(){}function N(a,b){H&&console.warn(a+" is deprecated, please use "+b+" instead.")}function O(a){return"[object Object]"===Object.prototype.toString.call(a)}function P(a,b,c){let d=c?"outbound-rtp":"inbound-rtp",e=new Map;if(null===b)return e;let f=[];return a.forEach(a=>{"track"===a.type&&a.trackIdentifier===b.id&&f.push(a)}),f.forEach(b=>{a.forEach(c=>{c.type===d&&c.trackId===b.id&&function a(b,c,d){!c||d.has(c.id)||(d.set(c.id,c),Object.keys(c).forEach(e=>{e.endsWith("Id")?a(b,b.get(c[e]),d):e.endsWith("Ids")&&c[e].forEach(c=>{a(b,b.get(c),d)})}))}(a,c,e)})}),e}function Q(a,b){let c=a&&a.navigator;if(!c.mediaDevices)return;let d=function(a){if("object"!=typeof a||a.mandatory||a.optional)return a;let b={};return Object.keys(a).forEach(c=>{if("require"===c||"advanced"===c||"mediaSource"===c)return;let d="object"==typeof a[c]?a[c]:{ideal:a[c]};void 0!==d.exact&&"number"==typeof d.exact&&(d.min=d.max=d.exact);let e=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==d.ideal){b.optional=b.optional||[];let a={};"number"==typeof d.ideal?(a[e("min",c)]=d.ideal,b.optional.push(a),(a={})[e("max",c)]=d.ideal):a[e("",c)]=d.ideal,b.optional.push(a)}void 0!==d.exact&&"number"!=typeof d.exact?(b.mandatory=b.mandatory||{},b.mandatory[e("",c)]=d.exact):["min","max"].forEach(a=>{void 0!==d[a]&&(b.mandatory=b.mandatory||{},b.mandatory[e(a,c)]=d[a])})}),a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced)),b},e=function(a,e){if(b.version>=61)return e(a);if((a=JSON.parse(JSON.stringify(a)))&&"object"==typeof a.audio){let b=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])};b((a=JSON.parse(JSON.stringify(a))).audio,"autoGainControl","googAutoGainControl"),b(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=d(a.audio)}if(a&&"object"==typeof a.video){let f=a.video.facingMode;f=f&&("object"==typeof f?f:{ideal:f});let g=b.version<66;if(f&&("user"===f.exact||"environment"===f.exact||"user"===f.ideal||"environment"===f.ideal)&&!(c.mediaDevices.getSupportedConstraints&&c.mediaDevices.getSupportedConstraints().facingMode&&!g)){let b;if(delete a.video.facingMode,"environment"===f.exact||"environment"===f.ideal?b=["back","rear"]:("user"===f.exact||"user"===f.ideal)&&(b=["front"]),b)return c.mediaDevices.enumerateDevices().then(c=>{let g=(c=c.filter(a=>"videoinput"===a.kind)).find(a=>b.some(b=>a.label.toLowerCase().includes(b)));return!g&&c.length&&b.includes("back")&&(g=c[c.length-1]),g&&(a.video.deviceId=f.exact?{exact:g.deviceId}:{ideal:g.deviceId}),a.video=d(a.video),M("chrome: "+JSON.stringify(a)),e(a)})}a.video=d(a.video)}return M("chrome: "+JSON.stringify(a)),e(a)},f=function(a){return b.version>=64?a:{name:({PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"})[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(c.getUserMedia=(function(a,b,d){e(a,a=>{c.webkitGetUserMedia(a,b,a=>{d&&d(f(a))})})}).bind(c),c.mediaDevices.getUserMedia){let a=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(b){return e(b,b=>a(b).then(a=>{if(b.audio&&!a.getAudioTracks().length||b.video&&!a.getVideoTracks().length)throw a.getTracks().forEach(a=>{a.stop()}),new DOMException("","NotFoundError");return a},a=>Promise.reject(f(a))))}}}function R(a){a.MediaStream=a.MediaStream||a.webkitMediaStream}function S(a){if("object"!=typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype)J(a,"track",a=>(a.transceiver||Object.defineProperty(a,"transceiver",{value:{receiver:a.receiver}}),a));else{Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(a){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=a)},enumerable:!0,configurable:!0});let b=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=b=>{b.stream.addEventListener("addtrack",c=>{let d;d=a.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===c.track.id):{track:c.track};let e=new Event("track");e.track=c.track,e.receiver=d,e.transceiver={receiver:d},e.streams=[b.stream],this.dispatchEvent(e)}),b.stream.getTracks().forEach(c=>{let d;d=a.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===c.id):{track:c};let e=new Event("track");e.track=c,e.receiver=d,e.transceiver={receiver:d},e.streams=[b.stream],this.dispatchEvent(e)})},this.addEventListener("addstream",this._ontrackpoly)),b.apply(this,arguments)}}}function T(a){if("object"==typeof a&&a.RTCPeerConnection&&!("getSenders"in a.RTCPeerConnection.prototype)&&"createDTMFSender"in a.RTCPeerConnection.prototype){let b=function(a,b){return{track:b,get dtmf(){return void 0===this._dtmf&&("audio"===b.kind?this._dtmf=a.createDTMFSender(b):this._dtmf=null),this._dtmf},_pc:a}};if(!a.RTCPeerConnection.prototype.getSenders){a.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let c=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,d){let e=c.apply(this,arguments);return e||(e=b(this,a),this._senders.push(e)),e};let d=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){d.apply(this,arguments);let b=this._senders.indexOf(a);-1!==b&&this._senders.splice(b,1)}}let c=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){this._senders=this._senders||[],c.apply(this,[a]),a.getTracks().forEach(a=>{this._senders.push(b(this,a))})};let d=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){this._senders=this._senders||[],d.apply(this,[a]),a.getTracks().forEach(a=>{let b=this._senders.find(b=>b.track===a);b&&this._senders.splice(this._senders.indexOf(b),1)})}}else if("object"==typeof a&&a.RTCPeerConnection&&"getSenders"in a.RTCPeerConnection.prototype&&"createDTMFSender"in a.RTCPeerConnection.prototype&&a.RTCRtpSender&&!("dtmf"in a.RTCRtpSender.prototype)){let b=a.RTCPeerConnection.prototype.getSenders;a.RTCPeerConnection.prototype.getSenders=function(){let a=b.apply(this,[]);return a.forEach(a=>a._pc=this),a},Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function U(a){if(!("object"==typeof a&&a.RTCPeerConnection&&a.RTCRtpSender&&a.RTCRtpReceiver))return;if(!("getStats"in a.RTCRtpSender.prototype)){let b=a.RTCPeerConnection.prototype.getSenders;b&&(a.RTCPeerConnection.prototype.getSenders=function(){let a=b.apply(this,[]);return a.forEach(a=>a._pc=this),a});let c=a.RTCPeerConnection.prototype.addTrack;c&&(a.RTCPeerConnection.prototype.addTrack=function(){let a=c.apply(this,arguments);return a._pc=this,a}),a.RTCRtpSender.prototype.getStats=function(){let a=this;return this._pc.getStats().then(b=>P(b,a.track,!0))}}if(!("getStats"in a.RTCRtpReceiver.prototype)){let b=a.RTCPeerConnection.prototype.getReceivers;b&&(a.RTCPeerConnection.prototype.getReceivers=function(){let a=b.apply(this,[]);return a.forEach(a=>a._pc=this),a}),J(a,"track",a=>(a.receiver._pc=a.srcElement,a)),a.RTCRtpReceiver.prototype.getStats=function(){let a=this;return this._pc.getStats().then(b=>P(b,a.track,!1))}}if(!("getStats"in a.RTCRtpSender.prototype&&"getStats"in a.RTCRtpReceiver.prototype))return;let b=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof a.MediaStreamTrack){let a,b,c,d=arguments[0];return(this.getSenders().forEach(b=>{b.track===d&&(a?c=!0:a=b)}),this.getReceivers().forEach(a=>(a.track===d&&(b?c=!0:b=a),a.track===d)),c||a&&b)?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():b?b.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return b.apply(this,arguments)}}function V(a){a.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};let b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return b.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let d=b.apply(this,arguments);return this._shimmedLocalStreams[c.id]?-1===this._shimmedLocalStreams[c.id].indexOf(d)&&this._shimmedLocalStreams[c.id].push(d):this._shimmedLocalStreams[c.id]=[c,d],d};let c=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(a=>{if(this.getSenders().find(b=>b.track===a))throw new DOMException("Track already exists.","InvalidAccessError")});let b=this.getSenders();c.apply(this,arguments);let d=this.getSenders().filter(a=>-1===b.indexOf(a));this._shimmedLocalStreams[a.id]=[a].concat(d)};let d=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],d.apply(this,arguments)};let e=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(b=>{let c=this._shimmedLocalStreams[b].indexOf(a);-1!==c&&this._shimmedLocalStreams[b].splice(c,1),1===this._shimmedLocalStreams[b].length&&delete this._shimmedLocalStreams[b]}),e.apply(this,arguments)}}function W(a,b){if(!a.RTCPeerConnection)return;if(a.RTCPeerConnection.prototype.addTrack&&b.version>=65)return V(a);let c=a.RTCPeerConnection.prototype.getLocalStreams;a.RTCPeerConnection.prototype.getLocalStreams=function(){let a=c.apply(this);return this._reverseStreams=this._reverseStreams||{},a.map(a=>this._reverseStreams[a.id])};let d=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(b){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},b.getTracks().forEach(a=>{if(this.getSenders().find(b=>b.track===a))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[b.id]){let c=new a.MediaStream(b.getTracks());this._streams[b.id]=c,this._reverseStreams[c.id]=b,b=c}d.apply(this,[b])};let e=a.RTCPeerConnection.prototype.removeStream;function f(a,b){let c=b.sdp;return Object.keys(a._reverseStreams||[]).forEach(b=>{let d=a._reverseStreams[b],e=a._streams[d.id];c=c.replace(RegExp(e.id,"g"),d.id)}),new RTCSessionDescription({type:b.type,sdp:c})}a.RTCPeerConnection.prototype.removeStream=function(a){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},e.apply(this,[this._streams[a.id]||a]),delete this._reverseStreams[this._streams[a.id]?this._streams[a.id].id:a.id],delete this._streams[a.id]},a.RTCPeerConnection.prototype.addTrack=function(b,c){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let d=[].slice.call(arguments,1);if(1!==d.length||!d[0].getTracks().find(a=>a===b))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(a=>a.track===b))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let e=this._streams[c.id];if(e)e.addTrack(b),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let d=new a.MediaStream([b]);this._streams[c.id]=d,this._reverseStreams[d.id]=c,this.addStream(d)}return this.getSenders().find(a=>a.track===b)},["createOffer","createAnswer"].forEach(function(b){let c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=({[b](){let a=arguments,b=arguments.length&&"function"==typeof arguments[0];return b?c.apply(this,[b=>{let c=f(this,b);a[0].apply(null,[c])},b=>{a[1]&&a[1].apply(null,b)},arguments[2]]):c.apply(this,arguments).then(a=>f(this,a))}})[b]});let g=a.RTCPeerConnection.prototype.setLocalDescription;a.RTCPeerConnection.prototype.setLocalDescription=function(){var a,b;let c;return arguments.length&&arguments[0].type?(arguments[0]=(a=this,b=arguments[0],c=b.sdp,Object.keys(a._reverseStreams||[]).forEach(b=>{let d=a._reverseStreams[b],e=a._streams[d.id];c=c.replace(RegExp(d.id,"g"),e.id)}),new RTCSessionDescription({type:b.type,sdp:c})),g.apply(this,arguments)):g.apply(this,arguments)};let h=Object.getOwnPropertyDescriptor(a.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(a.RTCPeerConnection.prototype,"localDescription",{get(){let a=h.get.apply(this);return""===a.type?a:f(this,a)}}),a.RTCPeerConnection.prototype.removeTrack=function(a){let b;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!a._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(a._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach(c=>{this._streams[c].getTracks().find(b=>a.track===b)&&(b=this._streams[c])}),b&&(1===b.getTracks().length?this.removeStream(this._reverseStreams[b.id]):b.removeTrack(a.track),this.dispatchEvent(new Event("negotiationneeded")))}}function X(a,b){!a.RTCPeerConnection&&a.webkitRTCPeerConnection&&(a.RTCPeerConnection=a.webkitRTCPeerConnection),a.RTCPeerConnection&&b.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){let c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=({[b](){return arguments[0]=new("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}})[b]})}function Y(a,b){J(a,"negotiationneeded",a=>{let c=a.target;if(!(b.version<72)&&(!c.getConfiguration||"plan-b"!==c.getConfiguration().sdpSemantics)||"stable"===c.signalingState)return a})}a.s(["fixNegotiationNeeded",()=>Y,"shimAddTrackRemoveTrack",()=>W,"shimAddTrackRemoveTrackWithNative",()=>V,"shimGetSendersWithDtmf",()=>T,"shimMediaStream",()=>R,"shimOnTrack",()=>S,"shimPeerConnection",()=>X,"shimSenderReceiverGetStats",()=>U],28314),a.i(28314),a.s(["fixNegotiationNeeded",()=>Y,"shimAddTrackRemoveTrack",()=>W,"shimAddTrackRemoveTrackWithNative",()=>V,"shimGetSendersWithDtmf",()=>T,"shimGetUserMedia",()=>Q,"shimMediaStream",()=>R,"shimOnTrack",()=>S,"shimPeerConnection",()=>X,"shimSenderReceiverGetStats",()=>U],20353);var Z=a.i(20353);function $(a,b){let c=a&&a.navigator,d=a&&a.MediaStreamTrack;if(c.getUserMedia=function(a,b,d){N("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),c.mediaDevices.getUserMedia(a).then(b,d)},!(b.version>55&&"autoGainControl"in c.mediaDevices.getSupportedConstraints())){let a=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])},b=c.mediaDevices.getUserMedia.bind(c.mediaDevices);if(c.mediaDevices.getUserMedia=function(c){return"object"==typeof c&&"object"==typeof c.audio&&(a((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","mozAutoGainControl"),a(c.audio,"noiseSuppression","mozNoiseSuppression")),b(c)},d&&d.prototype.getSettings){let b=d.prototype.getSettings;d.prototype.getSettings=function(){let c=b.apply(this,arguments);return a(c,"mozAutoGainControl","autoGainControl"),a(c,"mozNoiseSuppression","noiseSuppression"),c}}if(d&&d.prototype.applyConstraints){let b=d.prototype.applyConstraints;d.prototype.applyConstraints=function(c){return"audio"===this.kind&&"object"==typeof c&&(a(c=JSON.parse(JSON.stringify(c)),"autoGainControl","mozAutoGainControl"),a(c,"noiseSuppression","mozNoiseSuppression")),b.apply(this,[c])}}}}function _(a,b){a.navigator.mediaDevices&&"getDisplayMedia"in a.navigator.mediaDevices||a.navigator.mediaDevices&&(a.navigator.mediaDevices.getDisplayMedia=function(c){if(!(c&&c.video)){let a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Promise.reject(a)}return!0===c.video?c.video={mediaSource:b}:c.video.mediaSource=b,a.navigator.mediaDevices.getUserMedia(c)})}function aa(a){"object"==typeof a&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ab(a,b){if("object"!=typeof a||!(a.RTCPeerConnection||a.mozRTCPeerConnection))return;!a.RTCPeerConnection&&a.mozRTCPeerConnection&&(a.RTCPeerConnection=a.mozRTCPeerConnection),b.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){let c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=({[b](){return arguments[0]=new("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}})[b]});let c={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},d=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(){let[a,e,f]=arguments;return d.apply(this,[a||null]).then(a=>{if(b.version<53&&!e)try{a.forEach(a=>{a.type=c[a.type]||a.type})}catch(b){if("TypeError"!==b.name)throw b;a.forEach((b,d)=>{a.set(d,Object.assign({},b,{type:c[b.type]||b.type}))})}return a}).then(e,f)}}function ac(a){if(!("object"==typeof a&&a.RTCPeerConnection&&a.RTCRtpSender)||a.RTCRtpSender&&"getStats"in a.RTCRtpSender.prototype)return;let b=a.RTCPeerConnection.prototype.getSenders;b&&(a.RTCPeerConnection.prototype.getSenders=function(){let a=b.apply(this,[]);return a.forEach(a=>a._pc=this),a});let c=a.RTCPeerConnection.prototype.addTrack;c&&(a.RTCPeerConnection.prototype.addTrack=function(){let a=c.apply(this,arguments);return a._pc=this,a}),a.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function ad(a){if(!("object"==typeof a&&a.RTCPeerConnection&&a.RTCRtpSender)||a.RTCRtpSender&&"getStats"in a.RTCRtpReceiver.prototype)return;let b=a.RTCPeerConnection.prototype.getReceivers;b&&(a.RTCPeerConnection.prototype.getReceivers=function(){let a=b.apply(this,[]);return a.forEach(a=>a._pc=this),a}),J(a,"track",a=>(a.receiver._pc=a.srcElement,a)),a.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function ae(a){!a.RTCPeerConnection||"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){N("removeStream","removeTrack"),this.getSenders().forEach(b=>{b.track&&a.getTracks().includes(b.track)&&this.removeTrack(b)})})}function af(a){a.DataChannel&&!a.RTCDataChannel&&(a.RTCDataChannel=a.DataChannel)}function ag(a){if(!("object"==typeof a&&a.RTCPeerConnection))return;let b=a.RTCPeerConnection.prototype.addTransceiver;b&&(a.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let a=arguments[1]&&arguments[1].sendEncodings;void 0===a&&(a=[]);let c=(a=[...a]).length>0;c&&a.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw RangeError("max_framerate must be >= 0.0")});let d=b.apply(this,arguments);if(c){let{sender:b}=d,c=b.getParameters();"encodings"in c&&(1!==c.encodings.length||0!==Object.keys(c.encodings[0]).length)||(c.encodings=a,b.sendEncodings=a,this.setParametersPromises.push(b.setParameters(c).then(()=>{delete b.sendEncodings}).catch(()=>{delete b.sendEncodings})))}return d})}function ah(a){if(!("object"==typeof a&&a.RTCRtpSender))return;let b=a.RTCRtpSender.prototype.getParameters;b&&(a.RTCRtpSender.prototype.getParameters=function(){let a=b.apply(this,arguments);return"encodings"in a||(a.encodings=[].concat(this.sendEncodings||[{}])),a})}function ai(a){if(!("object"==typeof a&&a.RTCPeerConnection))return;let b=a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>b.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):b.apply(this,arguments)}}function aj(a){if(!("object"==typeof a&&a.RTCPeerConnection))return;let b=a.RTCPeerConnection.prototype.createAnswer;a.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>b.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):b.apply(this,arguments)}}a.s(["shimAddTransceiver",()=>ag,"shimCreateAnswer",()=>aj,"shimCreateOffer",()=>ai,"shimGetParameters",()=>ah,"shimOnTrack",()=>aa,"shimPeerConnection",()=>ab,"shimRTCDataChannel",()=>af,"shimReceiverGetStats",()=>ad,"shimRemoveStream",()=>ae,"shimSenderGetStats",()=>ac],60529),a.i(60529),a.s(["shimAddTransceiver",()=>ag,"shimCreateAnswer",()=>aj,"shimCreateOffer",()=>ai,"shimGetDisplayMedia",()=>_,"shimGetParameters",()=>ah,"shimGetUserMedia",()=>$,"shimOnTrack",()=>aa,"shimPeerConnection",()=>ab,"shimRTCDataChannel",()=>af,"shimReceiverGetStats",()=>ad,"shimRemoveStream",()=>ae,"shimSenderGetStats",()=>ac],16288);var ak=a.i(16288);function al(a){if("object"==typeof a&&a.RTCPeerConnection){if("getLocalStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in a.RTCPeerConnection.prototype)){let b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addStream=function(a){this._localStreams||(this._localStreams=[]),this._localStreams.includes(a)||this._localStreams.push(a),a.getAudioTracks().forEach(c=>b.call(this,c,a)),a.getVideoTracks().forEach(c=>b.call(this,c,a))},a.RTCPeerConnection.prototype.addTrack=function(a,...c){return c&&c.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),b.apply(this,arguments)}}"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){this._localStreams||(this._localStreams=[]);let b=this._localStreams.indexOf(a);if(-1===b)return;this._localStreams.splice(b,1);let c=a.getTracks();this.getSenders().forEach(a=>{c.includes(a.track)&&this.removeTrack(a)})})}}function am(a){if("object"==typeof a&&a.RTCPeerConnection&&("getRemoteStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in a.RTCPeerConnection.prototype))){Object.defineProperty(a.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(a){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=a),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(a=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(a))return;this._remoteStreams.push(a);let b=new Event("addstream");b.stream=a,this.dispatchEvent(b)})})}});let b=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){let a=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(b){b.streams.forEach(b=>{if(a._remoteStreams||(a._remoteStreams=[]),a._remoteStreams.indexOf(b)>=0)return;a._remoteStreams.push(b);let c=new Event("addstream");c.stream=b,a.dispatchEvent(c)})}),b.apply(a,arguments)}}}function an(a){if("object"!=typeof a||!a.RTCPeerConnection)return;let b=a.RTCPeerConnection.prototype,c=b.createOffer,d=b.createAnswer,e=b.setLocalDescription,f=b.setRemoteDescription,g=b.addIceCandidate;b.createOffer=function(a,b){let d=arguments.length>=2?arguments[2]:arguments[0],e=c.apply(this,[d]);return b?(e.then(a,b),Promise.resolve()):e},b.createAnswer=function(a,b){let c=arguments.length>=2?arguments[2]:arguments[0],e=d.apply(this,[c]);return b?(e.then(a,b),Promise.resolve()):e};let h=function(a,b,c){let d=e.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d};b.setLocalDescription=h,b.setRemoteDescription=h=function(a,b,c){let d=f.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d},b.addIceCandidate=function(a,b,c){let d=g.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d}}function ao(a){let b=a&&a.navigator;if(b.mediaDevices&&b.mediaDevices.getUserMedia){let a=b.mediaDevices,c=a.getUserMedia.bind(a);b.mediaDevices.getUserMedia=a=>c(ap(a))}!b.getUserMedia&&b.mediaDevices&&b.mediaDevices.getUserMedia&&(b.getUserMedia=(function(a,c,d){b.mediaDevices.getUserMedia(a).then(c,d)}).bind(b))}function ap(a){return a&&void 0!==a.video?Object.assign({},a,{video:function a(b){return O(b)?Object.keys(b).reduce(function(c,d){let e=O(b[d]),f=e?a(b[d]):b[d],g=e&&!Object.keys(f).length;return void 0===f||g?c:Object.assign(c,{[d]:f})},{}):b}(a.video)}):a}function aq(a){if(!a.RTCPeerConnection)return;let b=a.RTCPeerConnection;a.RTCPeerConnection=function(a,c){if(a&&a.iceServers){let b=[];for(let c=0;c<a.iceServers.length;c++){let d=a.iceServers[c];void 0===d.urls&&d.url?(N("RTCIceServer.url","RTCIceServer.urls"),(d=JSON.parse(JSON.stringify(d))).urls=d.url,delete d.url,b.push(d)):b.push(a.iceServers[c])}a.iceServers=b}return new b(a,c)},a.RTCPeerConnection.prototype=b.prototype,"generateCertificate"in b&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:()=>b.generateCertificate})}function ar(a){"object"==typeof a&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function as(a){let b=a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(a){if(a){void 0!==a.offerToReceiveAudio&&(a.offerToReceiveAudio=!!a.offerToReceiveAudio);let b=this.getTransceivers().find(a=>"audio"===a.receiver.track.kind);!1===a.offerToReceiveAudio&&b?"sendrecv"===b.direction?b.setDirection?b.setDirection("sendonly"):b.direction="sendonly":"recvonly"===b.direction&&(b.setDirection?b.setDirection("inactive"):b.direction="inactive"):!0!==a.offerToReceiveAudio||b||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==a.offerToReceiveVideo&&(a.offerToReceiveVideo=!!a.offerToReceiveVideo);let c=this.getTransceivers().find(a=>"video"===a.receiver.track.kind);!1===a.offerToReceiveVideo&&c?"sendrecv"===c.direction?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":"recvonly"===c.direction&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):!0!==a.offerToReceiveVideo||c||this.addTransceiver("video",{direction:"recvonly"})}return b.apply(this,arguments)}}function at(a){"object"!=typeof a||a.AudioContext||(a.AudioContext=a.webkitAudioContext)}a.s(["shimAudioContext",()=>at,"shimCallbacksAPI",()=>an,"shimConstraints",()=>ap,"shimCreateOfferLegacy",()=>as,"shimGetUserMedia",()=>ao,"shimLocalStreamsAPI",()=>al,"shimRTCIceServerUrls",()=>aq,"shimRemoteStreamsAPI",()=>am,"shimTrackEventTransceiver",()=>ar],57347);var au=a.i(57347),av=a.i(12907);function aw(a){if(!a.RTCIceCandidate||a.RTCIceCandidate&&"foundation"in a.RTCIceCandidate.prototype)return;let b=a.RTCIceCandidate;a.RTCIceCandidate=function(a){if("object"==typeof a&&a.candidate&&0===a.candidate.indexOf("a=")&&((a=JSON.parse(JSON.stringify(a))).candidate=a.candidate.substring(2)),a.candidate&&a.candidate.length){let c=new b(a),d=av.default.parseCandidate(a.candidate);for(let a in d)a in c||Object.defineProperty(c,a,{value:d[a]});return c.toJSON=function(){return{candidate:c.candidate,sdpMid:c.sdpMid,sdpMLineIndex:c.sdpMLineIndex,usernameFragment:c.usernameFragment}},c}return new b(a)},a.RTCIceCandidate.prototype=b.prototype,J(a,"icecandidate",b=>(b.candidate&&Object.defineProperty(b,"candidate",{value:new a.RTCIceCandidate(b.candidate),writable:"false"}),b))}function ax(a){!a.RTCIceCandidate||a.RTCIceCandidate&&"relayProtocol"in a.RTCIceCandidate.prototype||J(a,"icecandidate",a=>{if(a.candidate){let b=av.default.parseCandidate(a.candidate.candidate);"relay"===b.type&&(a.candidate.relayProtocol=({0:"tls",1:"tcp",2:"udp"})[b.priority>>24])}return a})}function ay(a,b){if(!a.RTCPeerConnection)return;"sctp"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});let c=function(a){if(!a||!a.sdp)return!1;let b=av.default.splitSections(a.sdp);return b.shift(),b.some(a=>{let b=av.default.parseMLine(a);return b&&"application"===b.kind&&-1!==b.protocol.indexOf("SCTP")})},d=function(a){let b=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===b||b.length<2)return -1;let c=parseInt(b[1],10);return c!=c?-1:c},e=function(a){let c=65536;return"firefox"===b.browser&&(c=b.version<57?-1===a?16384:0x7ffffff5:b.version<60?57===b.version?65535:65536:0x7ffffff5),c},f=function(a,c){let d=65536;"firefox"===b.browser&&57===b.version&&(d=65535);let e=av.default.matchPrefix(a.sdp,"a=max-message-size:");return e.length>0?d=parseInt(e[0].substring(19),10):"firefox"===b.browser&&-1!==c&&(d=0x7ffffff5),d},g=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===b.browser&&b.version>=76){let{sdpSemantics:a}=this.getConfiguration();"plan-b"===a&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(c(arguments[0])){let a,b=d(arguments[0]),c=e(b),g=f(arguments[0],b);a=0===c&&0===g?1/0:0===c||0===g?Math.max(c,g):Math.min(c,g);let h={};Object.defineProperty(h,"maxMessageSize",{get:()=>a}),this._sctp=h}return g.apply(this,arguments)}}function az(a){if(!(a.RTCPeerConnection&&"createDataChannel"in a.RTCPeerConnection.prototype))return;function b(a,b){let c=a.send;a.send=function(){let d=arguments[0],e=d.length||d.size||d.byteLength;if("open"===a.readyState&&b.sctp&&e>b.sctp.maxMessageSize)throw TypeError("Message too large (can send a maximum of "+b.sctp.maxMessageSize+" bytes)");return c.apply(a,arguments)}}let c=a.RTCPeerConnection.prototype.createDataChannel;a.RTCPeerConnection.prototype.createDataChannel=function(){let a=c.apply(this,arguments);return b(a,this),a},J(a,"datachannel",a=>(b(a.channel,a.target),a))}function aA(a){if(!a.RTCPeerConnection||"connectionState"in a.RTCPeerConnection.prototype)return;let b=a.RTCPeerConnection.prototype;Object.defineProperty(b,"connectionState",{get(){return({completed:"connected",checking:"connecting"})[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(b,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(a){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),a&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=a)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(a=>{let c=b[a];b[a]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=a=>{let b=a.target;if(b._lastConnectionState!==b.connectionState){b._lastConnectionState=b.connectionState;let c=new Event("connectionstatechange",a);b.dispatchEvent(c)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),c.apply(this,arguments)}})}function aB(a,b){if(!a.RTCPeerConnection||"chrome"===b.browser&&b.version>=71||"safari"===b.browser&&b._safariVersion>=13.1)return;let c=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(b){if(b&&b.sdp&&-1!==b.sdp.indexOf("\na=extmap-allow-mixed")){let c=b.sdp.split("\n").filter(a=>"a=extmap-allow-mixed"!==a.trim()).join("\n");a.RTCSessionDescription&&b instanceof a.RTCSessionDescription?arguments[0]=new a.RTCSessionDescription({type:b.type,sdp:c}):b.sdp=c}return c.apply(this,arguments)}}function aC(a,b){if(!(a.RTCPeerConnection&&a.RTCPeerConnection.prototype))return;let c=a.RTCPeerConnection.prototype.addIceCandidate;c&&0!==c.length&&(a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===b.browser&&b.version<78||"firefox"===b.browser&&b.version<68||"safari"===b.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():c.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function aD(a,b){if(!(a.RTCPeerConnection&&a.RTCPeerConnection.prototype))return;let c=a.RTCPeerConnection.prototype.setLocalDescription;c&&0!==c.length&&(a.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if("object"!=typeof a||a.type&&a.sdp)return c.apply(this,arguments);if(!(a={type:a.type,sdp:a.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||"offer"!==a.type&&"answer"!==a.type?c.apply(this,[a]):("offer"===a.type?this.createOffer:this.createAnswer).apply(this).then(a=>c.apply(this,[a]))})}a.s(["removeExtmapAllowMixed",()=>aB,"shimAddIceCandidateNullOrEmpty",()=>aC,"shimConnectionState",()=>aA,"shimMaxMessageSize",()=>ay,"shimParameterlessSetLocalDescription",()=>aD,"shimRTCIceCandidate",()=>aw,"shimRTCIceCandidateRelayProtocol",()=>ax,"shimSendThrowTypeError",()=>az],7850);var aE=a.i(7850);let aF=function({window:a}={},b={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){let c=function(a){let b={browser:null,version:null};if(void 0===a||!a.navigator||!a.navigator.userAgent)return b.browser="Not a browser.",b;let{navigator:c}=a;if(c.userAgentData&&c.userAgentData.brands){let a=c.userAgentData.brands.find(a=>"Chromium"===a.brand);if(a)return{browser:"chrome",version:parseInt(a.version,10)}}return c.mozGetUserMedia?(b.browser="firefox",b.version=parseInt(I(c.userAgent,/Firefox\/(\d+)\./,1))):c.webkitGetUserMedia||!1===a.isSecureContext&&a.webkitRTCPeerConnection?(b.browser="chrome",b.version=parseInt(I(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2))):a.RTCPeerConnection&&c.userAgent.match(/AppleWebKit\/(\d+)\./)?(b.browser="safari",b.version=parseInt(I(c.userAgent,/AppleWebKit\/(\d+)\./,1)),b.supportsUnifiedPlan=a.RTCRtpTransceiver&&"currentDirection"in a.RTCRtpTransceiver.prototype,b._safariVersion=I(c.userAgent,/Version\/(\d+(\.?\d+))/,1)):b.browser="Not a supported browser.",b}(a),d={browserDetails:c,commonShim:aE,extractVersion:I,disableLog:K,disableWarnings:L,sdp:av};switch(c.browser){case"chrome":if(!Z||!Z.shimPeerConnection||!b.shimChrome){M("Chrome shim is not included in this adapter release.");break}if(null===c.version){M("Chrome shim can not determine version, not shimming.");break}M("adapter.js shimming chrome."),d.browserShim=Z,aC(a,c),aD(a,c),Z.shimGetUserMedia(a,c),Z.shimMediaStream(a,c),Z.shimPeerConnection(a,c),Z.shimOnTrack(a,c),Z.shimAddTrackRemoveTrack(a,c),Z.shimGetSendersWithDtmf(a,c),Z.shimSenderReceiverGetStats(a,c),Z.fixNegotiationNeeded(a,c),aw(a,c),ax(a,c),aA(a,c),ay(a,c),az(a,c),aB(a,c);break;case"firefox":if(!ak||!ak.shimPeerConnection||!b.shimFirefox){M("Firefox shim is not included in this adapter release.");break}M("adapter.js shimming firefox."),d.browserShim=ak,aC(a,c),aD(a,c),ak.shimGetUserMedia(a,c),ak.shimPeerConnection(a,c),ak.shimOnTrack(a,c),ak.shimRemoveStream(a,c),ak.shimSenderGetStats(a,c),ak.shimReceiverGetStats(a,c),ak.shimRTCDataChannel(a,c),ak.shimAddTransceiver(a,c),ak.shimGetParameters(a,c),ak.shimCreateOffer(a,c),ak.shimCreateAnswer(a,c),aw(a,c),aA(a,c),ay(a,c),az(a,c);break;case"safari":if(!au||!b.shimSafari){M("Safari shim is not included in this adapter release.");break}M("adapter.js shimming safari."),d.browserShim=au,aC(a,c),aD(a,c),au.shimRTCIceServerUrls(a,c),au.shimCreateOfferLegacy(a,c),au.shimCallbacksAPI(a,c),au.shimLocalStreamsAPI(a,c),au.shimRemoteStreamsAPI(a,c),au.shimTrackEventTransceiver(a,c),au.shimGetUserMedia(a,c),au.shimAudioContext(a,c),aw(a,c),ax(a,c),ay(a,c),az(a,c),aB(a,c);break;default:M("Unsupported browser!")}return d}({window:void 0});function aG(a,b,c){var d=Math.floor(c/0x100000000);a.setUint32(b,d),a.setUint32(b+4,c)}function aH(a,b){return 0x100000000*a.getInt32(b)+a.getUint32(b+4)}var aI=("u"<typeof process||(null==(q=null==process?void 0:process.env)?void 0:q.TEXT_ENCODING)!=="never")&&"u">typeof TextEncoder&&"u">typeof TextDecoder;function aJ(a){for(var b=a.length,c=0,d=0;d<b;){var e=a.charCodeAt(d++);if((0xffffff80&e)==0){c++;continue}if((0xfffff800&e)==0)c+=2;else{if(e>=55296&&e<=56319&&d<b){var f=a.charCodeAt(d);(64512&f)==56320&&(++d,e=((1023&e)<<10)+(1023&f)+65536)}(0xffff0000&e)==0?c+=3:c+=4}}return c}var aK=aI?new TextEncoder:void 0,aL=aI?200*("u">typeof process&&(null==(r=null==process?void 0:process.env)?void 0:r.TEXT_ENCODING)!=="force"):0xffffffff,aM=(null==aK?void 0:aK.encodeInto)?function(a,b,c){aK.encodeInto(a,b.subarray(c))}:function(a,b,c){b.set(aK.encode(a),c)};function aN(a,b,c){for(var d=b,e=d+c,f=[],g="";d<e;){var h=a[d++];if((128&h)==0)f.push(h);else if((224&h)==192){var i=63&a[d++];f.push((31&h)<<6|i)}else if((240&h)==224){var i=63&a[d++],j=63&a[d++];f.push((31&h)<<12|i<<6|j)}else if((248&h)==240){var i=63&a[d++],j=63&a[d++],k=(7&h)<<18|i<<12|j<<6|63&a[d++];k>65535&&(k-=65536,f.push(k>>>10&1023|55296),k=56320|1023&k),f.push(k)}else f.push(h);f.length>=4096&&(g+=String.fromCharCode.apply(String,f),f.length=0)}return f.length>0&&(g+=String.fromCharCode.apply(String,f)),g}var aO=aI?new TextDecoder:null,aP=aI?200*("u">typeof process&&(null==(s=null==process?void 0:process.env)?void 0:s.TEXT_DECODER)!=="force"):0xffffffff,aQ=function(a,b){this.type=a,this.data=b},aR=(e=function(a,b){return(e=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])})(a,b)},function(a,b){if("function"!=typeof b&&null!==b)throw TypeError("Class extends value "+String(b)+" is not a constructor or null");function c(){this.constructor=a}e(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}),aS=function(a){function b(c){var d=a.call(this,c)||this;return Object.setPrototypeOf(d,Object.create(b.prototype)),Object.defineProperty(d,"name",{configurable:!0,enumerable:!1,value:b.name}),d}return aR(b,a),b}(Error),aT={type:-1,encode:function(a){var b,c,d,e;return a instanceof Date?function(a){var b=a.sec,c=a.nsec;if(b>=0&&c>=0&&b<=0x3ffffffff)if(0===c&&b<=0xffffffff){var d=new Uint8Array(4),e=new DataView(d.buffer);return e.setUint32(0,b),d}else{var f=b/0x100000000,d=new Uint8Array(8),e=new DataView(d.buffer);return e.setUint32(0,c<<2|3&f),e.setUint32(4,0|b),d}var d=new Uint8Array(12),e=new DataView(d.buffer);return e.setUint32(0,c),aG(e,4,b),d}((c=Math.floor((b=a.getTime())/1e3),e=Math.floor((d=(b-1e3*c)*1e6)/1e9),{sec:c+e,nsec:d-1e9*e})):null},decode:function(a){var b=function(a){var b=new DataView(a.buffer,a.byteOffset,a.byteLength);switch(a.byteLength){case 4:var c=b.getUint32(0),d=0;return{sec:c,nsec:0};case 8:var e=b.getUint32(0),c=(3&e)*0x100000000+b.getUint32(4),d=e>>>2;return{sec:c,nsec:d};case 12:var c=aH(b,4),d=b.getUint32(0);return{sec:c,nsec:d};default:throw new aS("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(a.length))}}(a);return new Date(1e3*b.sec+b.nsec/1e6)}},aU=function(){function a(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(aT)}return a.prototype.register=function(a){var b=a.type,c=a.encode,d=a.decode;if(b>=0)this.encoders[b]=c,this.decoders[b]=d;else{var e=1+b;this.builtInEncoders[e]=c,this.builtInDecoders[e]=d}},a.prototype.tryToEncode=function(a,b){for(var c=0;c<this.builtInEncoders.length;c++){var d=this.builtInEncoders[c];if(null!=d){var e=d(a,b);if(null!=e){var f=-1-c;return new aQ(f,e)}}}for(var c=0;c<this.encoders.length;c++){var d=this.encoders[c];if(null!=d){var e=d(a,b);if(null!=e){var f=c;return new aQ(f,e)}}}return a instanceof aQ?a:null},a.prototype.decode=function(a,b,c){var d=b<0?this.builtInDecoders[-1-b]:this.decoders[b];return d?d(a,b,c):new aQ(b,a)},a.defaultCodec=new a,a}();function aV(a){return a instanceof Uint8Array?a:ArrayBuffer.isView(a)?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a instanceof ArrayBuffer?new Uint8Array(a):Uint8Array.from(a)}function aW(a,b,c,d,e,f,g,h){void 0===a&&(a=aU.defaultCodec),void 0===b&&(b=void 0),void 0===c&&(c=100),void 0===d&&(d=2048),void 0===e&&(e=!1),void 0===f&&(f=!1),void 0===g&&(g=!1),void 0===h&&(h=!1),this.extensionCodec=a,this.context=b,this.maxDepth=c,this.initialBufferSize=d,this.sortKeys=e,this.forceFloat32=f,this.ignoreUndefined=g,this.forceIntegerToFloat=h,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}function aX(a){return"".concat(a<0?"-":"","0x").concat(Math.abs(a).toString(16).padStart(2,"0"))}aW.prototype.reinitializeState=function(){this.pos=0},aW.prototype.encodeSharedRef=function(a){return this.reinitializeState(),this.doEncode(a,1),this.bytes.subarray(0,this.pos)},aW.prototype.encode=function(a){return this.reinitializeState(),this.doEncode(a,1),this.bytes.slice(0,this.pos)},aW.prototype.doEncode=function(a,b){if(b>this.maxDepth)throw Error("Too deep objects in depth ".concat(b));null==a?this.encodeNil():"boolean"==typeof a?this.encodeBoolean(a):"number"==typeof a?this.encodeNumber(a):"string"==typeof a?this.encodeString(a):this.encodeObject(a,b)},aW.prototype.ensureBufferSizeToWrite=function(a){var b=this.pos+a;this.view.byteLength<b&&this.resizeBuffer(2*b)},aW.prototype.resizeBuffer=function(a){var b=new ArrayBuffer(a),c=new Uint8Array(b),d=new DataView(b);c.set(this.bytes),this.view=d,this.bytes=c},aW.prototype.encodeNil=function(){this.writeU8(192)},aW.prototype.encodeBoolean=function(a){!1===a?this.writeU8(194):this.writeU8(195)},aW.prototype.encodeNumber=function(a){Number.isSafeInteger(a)&&!this.forceIntegerToFloat?a>=0?a<128?this.writeU8(a):a<256?(this.writeU8(204),this.writeU8(a)):a<65536?(this.writeU8(205),this.writeU16(a)):a<0x100000000?(this.writeU8(206),this.writeU32(a)):(this.writeU8(207),this.writeU64(a)):a>=-32?this.writeU8(224|a+32):a>=-128?(this.writeU8(208),this.writeI8(a)):a>=-32768?(this.writeU8(209),this.writeI16(a)):a>=-0x80000000?(this.writeU8(210),this.writeI32(a)):(this.writeU8(211),this.writeI64(a)):this.forceFloat32?(this.writeU8(202),this.writeF32(a)):(this.writeU8(203),this.writeF64(a))},aW.prototype.writeStringHeader=function(a){if(a<32)this.writeU8(160+a);else if(a<256)this.writeU8(217),this.writeU8(a);else if(a<65536)this.writeU8(218),this.writeU16(a);else if(a<0x100000000)this.writeU8(219),this.writeU32(a);else throw Error("Too long string: ".concat(a," bytes in UTF-8"))},aW.prototype.encodeString=function(a){if(a.length>aL){var b=aJ(a);this.ensureBufferSizeToWrite(5+b),this.writeStringHeader(b),aM(a,this.bytes,this.pos),this.pos+=b}else{var b=aJ(a);this.ensureBufferSizeToWrite(5+b),this.writeStringHeader(b),function(a,b,c){for(var d=a.length,e=c,f=0;f<d;){var g=a.charCodeAt(f++);if((0xffffff80&g)==0){b[e++]=g;continue}if((0xfffff800&g)==0)b[e++]=g>>6&31|192;else{if(g>=55296&&g<=56319&&f<d){var h=a.charCodeAt(f);(64512&h)==56320&&(++f,g=((1023&g)<<10)+(1023&h)+65536)}(0xffff0000&g)==0?b[e++]=g>>12&15|224:(b[e++]=g>>18&7|240,b[e++]=g>>12&63|128),b[e++]=g>>6&63|128}b[e++]=63&g|128}}(a,this.bytes,this.pos),this.pos+=b}},aW.prototype.encodeObject=function(a,b){var c=this.extensionCodec.tryToEncode(a,this.context);if(null!=c)this.encodeExtension(c);else if(Array.isArray(a))this.encodeArray(a,b);else if(ArrayBuffer.isView(a))this.encodeBinary(a);else if("object"==typeof a)this.encodeMap(a,b);else throw Error("Unrecognized object: ".concat(Object.prototype.toString.apply(a)))},aW.prototype.encodeBinary=function(a){var b=a.byteLength;if(b<256)this.writeU8(196),this.writeU8(b);else if(b<65536)this.writeU8(197),this.writeU16(b);else if(b<0x100000000)this.writeU8(198),this.writeU32(b);else throw Error("Too large binary: ".concat(b));var c=aV(a);this.writeU8a(c)},aW.prototype.encodeArray=function(a,b){var c=a.length;if(c<16)this.writeU8(144+c);else if(c<65536)this.writeU8(220),this.writeU16(c);else if(c<0x100000000)this.writeU8(221),this.writeU32(c);else throw Error("Too large array: ".concat(c));for(var d=0;d<a.length;d++){var e=a[d];this.doEncode(e,b+1)}},aW.prototype.countWithoutUndefined=function(a,b){for(var c=0,d=0;d<b.length;d++)void 0!==a[b[d]]&&c++;return c},aW.prototype.encodeMap=function(a,b){var c=Object.keys(a);this.sortKeys&&c.sort();var d=this.ignoreUndefined?this.countWithoutUndefined(a,c):c.length;if(d<16)this.writeU8(128+d);else if(d<65536)this.writeU8(222),this.writeU16(d);else if(d<0x100000000)this.writeU8(223),this.writeU32(d);else throw Error("Too large map object: ".concat(d));for(var e=0;e<c.length;e++){var f=c[e],g=a[f];this.ignoreUndefined&&void 0===g||(this.encodeString(f),this.doEncode(g,b+1))}},aW.prototype.encodeExtension=function(a){var b=a.data.length;if(1===b)this.writeU8(212);else if(2===b)this.writeU8(213);else if(4===b)this.writeU8(214);else if(8===b)this.writeU8(215);else if(16===b)this.writeU8(216);else if(b<256)this.writeU8(199),this.writeU8(b);else if(b<65536)this.writeU8(200),this.writeU16(b);else if(b<0x100000000)this.writeU8(201),this.writeU32(b);else throw Error("Too large extension object: ".concat(b));this.writeI8(a.type),this.writeU8a(a.data)},aW.prototype.writeU8=function(a){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,a),this.pos++},aW.prototype.writeU8a=function(a){var b=a.length;this.ensureBufferSizeToWrite(b),this.bytes.set(a,this.pos),this.pos+=b},aW.prototype.writeI8=function(a){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,a),this.pos++},aW.prototype.writeU16=function(a){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,a),this.pos+=2},aW.prototype.writeI16=function(a){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,a),this.pos+=2},aW.prototype.writeU32=function(a){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,a),this.pos+=4},aW.prototype.writeI32=function(a){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,a),this.pos+=4},aW.prototype.writeF32=function(a){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,a),this.pos+=4},aW.prototype.writeF64=function(a){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,a),this.pos+=8},aW.prototype.writeU64=function(a){var b,c;this.ensureBufferSizeToWrite(8),b=this.view,c=this.pos,b.setUint32(c,a/0x100000000),b.setUint32(c+4,a),this.pos+=8},aW.prototype.writeI64=function(a){this.ensureBufferSizeToWrite(8),aG(this.view,this.pos,a),this.pos+=8};var aY=function(){function a(a,b){void 0===a&&(a=16),void 0===b&&(b=16),this.maxKeyLength=a,this.maxLengthPerKey=b,this.hit=0,this.miss=0,this.caches=[];for(var c=0;c<this.maxKeyLength;c++)this.caches.push([])}return a.prototype.canBeCached=function(a){return a>0&&a<=this.maxKeyLength},a.prototype.find=function(a,b,c){var d=this.caches[c-1];a:for(var e=0;e<d.length;e++){for(var f=d[e],g=f.bytes,h=0;h<c;h++)if(g[h]!==a[b+h])continue a;return f.str}return null},a.prototype.store=function(a,b){var c=this.caches[a.length-1],d={bytes:a,str:b};c.length>=this.maxLengthPerKey?c[Math.random()*c.length|0]=d:c.push(d)},a.prototype.decode=function(a,b,c){var d=this.find(a,b,c);if(null!=d)return this.hit++,d;this.miss++;var e=aN(a,b,c),f=Uint8Array.prototype.slice.call(a,b,b+c);return this.store(f,e),e},a}(),aZ=function(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(f){return function(h){var i=[f,h];if(c)throw TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&i[0]?d.return:i[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,i[1])).done)return e;switch(d=0,e&&(i=[2&i[0],e.value]),i[0]){case 0:case 1:e=i;break;case 4:return g.label++,{value:i[1],done:!1};case 5:g.label++,d=i[1],i=[0];continue;case 7:i=g.ops.pop(),g.trys.pop();continue;default:if(!(e=(e=g.trys).length>0&&e[e.length-1])&&(6===i[0]||2===i[0])){g=0;continue}if(3===i[0]&&(!e||i[1]>e[0]&&i[1]<e[3])){g.label=i[1];break}if(6===i[0]&&g.label<e[1]){g.label=e[1],e=i;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(i);break}e[2]&&g.ops.pop(),g.trys.pop();continue}i=b.call(a,g)}catch(a){i=[6,a],d=0}finally{c=e=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}}},a$=function(a){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var b,c=a[Symbol.asyncIterator];return c?c.call(a):(a="function"==typeof __values?__values(a):a[Symbol.iterator](),b={},d("next"),d("throw"),d("return"),b[Symbol.asyncIterator]=function(){return this},b);function d(c){b[c]=a[c]&&function(b){return new Promise(function(d,e){var f,g,h;f=d,g=e,h=(b=a[c](b)).done,Promise.resolve(b.value).then(function(a){f({value:a,done:h})},g)})}}},a_=function(a){return this instanceof a_?(this.v=a,this):new a_(a)},a0=function(a,b,c){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var d,e=c.apply(a,b||[]),f=[];return d={},g("next"),g("throw"),g("return"),d[Symbol.asyncIterator]=function(){return this},d;function g(a){e[a]&&(d[a]=function(b){return new Promise(function(c,d){f.push([a,b,c,d])>1||h(a,b)})})}function h(a,b){try{var c;(c=e[a](b)).value instanceof a_?Promise.resolve(c.value.v).then(i,j):k(f[0][2],c)}catch(a){k(f[0][3],a)}}function i(a){h("next",a)}function j(a){h("throw",a)}function k(a,b){a(b),f.shift(),f.length&&h(f[0][0],f[0][1])}},a1=function(a){var b=typeof a;return"string"===b||"number"===b},a2=new DataView(new ArrayBuffer(0)),a3=new Uint8Array(a2.buffer),a4=function(){try{a2.getInt8(0)}catch(a){return a.constructor}throw Error("never reached")}(),a5=new a4("Insufficient data"),a6=new aY;function a7(a,b,c,d,e,f,g,h){void 0===a&&(a=aU.defaultCodec),void 0===b&&(b=void 0),void 0===c&&(c=0xffffffff),void 0===d&&(d=0xffffffff),void 0===e&&(e=0xffffffff),void 0===f&&(f=0xffffffff),void 0===g&&(g=0xffffffff),void 0===h&&(h=a6),this.extensionCodec=a,this.context=b,this.maxStrLength=c,this.maxBinLength=d,this.maxArrayLength=e,this.maxMapLength=f,this.maxExtLength=g,this.keyDecoder=h,this.totalPos=0,this.pos=0,this.view=a2,this.bytes=a3,this.headByte=-1,this.stack=[]}function a8(a,b,c,d){Object.defineProperty(a,b,{get:c,set:d,enumerable:!0,configurable:!0})}a7.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},a7.prototype.setBuffer=function(a){this.bytes=aV(a),this.view=function(a){if(a instanceof ArrayBuffer)return new DataView(a);var b=aV(a);return new DataView(b.buffer,b.byteOffset,b.byteLength)}(this.bytes),this.pos=0},a7.prototype.appendBuffer=function(a){if(-1!==this.headByte||this.hasRemaining(1)){var b=this.bytes.subarray(this.pos),c=aV(a),d=new Uint8Array(b.length+c.length);d.set(b),d.set(c,b.length),this.setBuffer(d)}else this.setBuffer(a)},a7.prototype.hasRemaining=function(a){return this.view.byteLength-this.pos>=a},a7.prototype.createExtraByteError=function(a){var b=this.view,c=this.pos;return RangeError("Extra ".concat(b.byteLength-c," of ").concat(b.byteLength," byte(s) found at buffer[").concat(a,"]"))},a7.prototype.decode=function(a){this.reinitializeState(),this.setBuffer(a);var b=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return b},a7.prototype.decodeMulti=function(a){return aZ(this,function(b){switch(b.label){case 0:this.reinitializeState(),this.setBuffer(a),b.label=1;case 1:if(!this.hasRemaining(1))return[3,3];return[4,this.doDecodeSync()];case 2:return b.sent(),[3,1];case 3:return[2]}})},a7.prototype.decodeAsync=function(a){var b,c,d,e,f,g,h,i;return f=this,g=void 0,h=void 0,i=function(){var f,g,h,i,j,k,l;return aZ(this,function(m){switch(m.label){case 0:f=!1,m.label=1;case 1:m.trys.push([1,6,7,12]),b=a$(a),m.label=2;case 2:return[4,b.next()];case 3:if((c=m.sent()).done)return[3,5];if(h=c.value,f)throw this.createExtraByteError(this.totalPos);this.appendBuffer(h);try{g=this.doDecodeSync(),f=!0}catch(a){if(!(a instanceof a4))throw a}this.totalPos+=this.pos,m.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return d={error:m.sent()},[3,12];case 7:if(m.trys.push([7,,10,11]),!(c&&!c.done&&(e=b.return)))return[3,9];return[4,e.call(b)];case 8:m.sent(),m.label=9;case 9:return[3,11];case 10:if(d)throw d.error;return[7];case 11:return[7];case 12:if(f){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,g]}throw i=this,j=i.headByte,k=i.pos,l=i.totalPos,RangeError("Insufficient data in parsing ".concat(aX(j)," at ").concat(l," (").concat(k," in the current buffer)"))}})},new(h||(h=Promise))(function(a,b){function c(a){try{e(i.next(a))}catch(a){b(a)}}function d(a){try{e(i.throw(a))}catch(a){b(a)}}function e(b){var e;b.done?a(b.value):((e=b.value)instanceof h?e:new h(function(a){a(e)})).then(c,d)}e((i=i.apply(f,g||[])).next())})},a7.prototype.decodeArrayStream=function(a){return this.decodeMultiAsync(a,!0)},a7.prototype.decodeStream=function(a){return this.decodeMultiAsync(a,!1)},a7.prototype.decodeMultiAsync=function(a,b){return a0(this,arguments,function(){var c,d,e,f,g,h,i,j;return aZ(this,function(k){switch(k.label){case 0:c=b,d=-1,k.label=1;case 1:k.trys.push([1,13,14,19]),e=a$(a),k.label=2;case 2:return[4,a_(e.next())];case 3:if((f=k.sent()).done)return[3,12];if(g=f.value,b&&0===d)throw this.createExtraByteError(this.totalPos);this.appendBuffer(g),c&&(d=this.readArraySize(),c=!1,this.complete()),k.label=4;case 4:k.trys.push([4,9,,10]),k.label=5;case 5:return[4,a_(this.doDecodeSync())];case 6:return[4,k.sent()];case 7:if(k.sent(),0==--d)return[3,8];return[3,5];case 8:return[3,10];case 9:if(!((h=k.sent())instanceof a4))throw h;return[3,10];case 10:this.totalPos+=this.pos,k.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return i={error:k.sent()},[3,19];case 14:if(k.trys.push([14,,17,18]),!(f&&!f.done&&(j=e.return)))return[3,16];return[4,a_(j.call(e))];case 15:k.sent(),k.label=16;case 16:return[3,18];case 17:if(i)throw i.error;return[7];case 18:return[7];case 19:return[2]}})})},a7.prototype.doDecodeSync=function(){b:for(;;){var a=this.readHeadByte(),b=void 0;if(a>=224)b=a-256;else if(a<192)if(a<128)b=a;else if(a<144){var c=a-128;if(0!==c){this.pushMapState(c),this.complete();continue}b={}}else if(a<160){var c=a-144;if(0!==c){this.pushArrayState(c),this.complete();continue}b=[]}else{var d=a-160;b=this.decodeUtf8String(d,0)}else if(192===a)b=null;else if(194===a)b=!1;else if(195===a)b=!0;else if(202===a)b=this.readF32();else if(203===a)b=this.readF64();else if(204===a)b=this.readU8();else if(205===a)b=this.readU16();else if(206===a)b=this.readU32();else if(207===a)b=this.readU64();else if(208===a)b=this.readI8();else if(209===a)b=this.readI16();else if(210===a)b=this.readI32();else if(211===a)b=this.readI64();else if(217===a){var d=this.lookU8();b=this.decodeUtf8String(d,1)}else if(218===a){var d=this.lookU16();b=this.decodeUtf8String(d,2)}else if(219===a){var d=this.lookU32();b=this.decodeUtf8String(d,4)}else if(220===a){var c=this.readU16();if(0!==c){this.pushArrayState(c),this.complete();continue}b=[]}else if(221===a){var c=this.readU32();if(0!==c){this.pushArrayState(c),this.complete();continue}b=[]}else if(222===a){var c=this.readU16();if(0!==c){this.pushMapState(c),this.complete();continue}b={}}else if(223===a){var c=this.readU32();if(0!==c){this.pushMapState(c),this.complete();continue}b={}}else if(196===a){var c=this.lookU8();b=this.decodeBinary(c,1)}else if(197===a){var c=this.lookU16();b=this.decodeBinary(c,2)}else if(198===a){var c=this.lookU32();b=this.decodeBinary(c,4)}else if(212===a)b=this.decodeExtension(1,0);else if(213===a)b=this.decodeExtension(2,0);else if(214===a)b=this.decodeExtension(4,0);else if(215===a)b=this.decodeExtension(8,0);else if(216===a)b=this.decodeExtension(16,0);else if(199===a){var c=this.lookU8();b=this.decodeExtension(c,1)}else if(200===a){var c=this.lookU16();b=this.decodeExtension(c,2)}else if(201===a){var c=this.lookU32();b=this.decodeExtension(c,4)}else throw new aS("Unrecognized type byte: ".concat(aX(a)));this.complete();for(var e=this.stack;e.length>0;){var f=e[e.length-1];if(0===f.type)if(f.array[f.position]=b,f.position++,f.position===f.size)e.pop(),b=f.array;else continue b;else if(1===f.type){if(!a1(b))throw new aS("The type of key must be string or number but "+typeof b);if("__proto__"===b)throw new aS("The key __proto__ is not allowed");f.key=b,f.type=2;continue b}else if(f.map[f.key]=b,f.readCount++,f.readCount===f.size)e.pop(),b=f.map;else{f.key=null,f.type=1;continue b}}return b}},a7.prototype.readHeadByte=function(){return -1===this.headByte&&(this.headByte=this.readU8()),this.headByte},a7.prototype.complete=function(){this.headByte=-1},a7.prototype.readArraySize=function(){var a=this.readHeadByte();switch(a){case 220:return this.readU16();case 221:return this.readU32();default:if(a<160)return a-144;throw new aS("Unrecognized array type byte: ".concat(aX(a)))}},a7.prototype.pushMapState=function(a){if(a>this.maxMapLength)throw new aS("Max length exceeded: map length (".concat(a,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:1,size:a,key:null,readCount:0,map:{}})},a7.prototype.pushArrayState=function(a){if(a>this.maxArrayLength)throw new aS("Max length exceeded: array length (".concat(a,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:0,size:a,array:Array(a),position:0})},a7.prototype.decodeUtf8String=function(a,b){if(a>this.maxStrLength)throw new aS("Max length exceeded: UTF-8 byte length (".concat(a,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+b+a)throw a5;var c,d,e,f,g=this.pos+b;return this.stateIsMapKey()&&(null==(e=this.keyDecoder)?void 0:e.canBeCached(a))?f=this.keyDecoder.decode(this.bytes,g,a):a>aP?(c=this.bytes,d=c.subarray(g,g+a),f=aO.decode(d)):f=aN(this.bytes,g,a),this.pos+=b+a,f},a7.prototype.stateIsMapKey=function(){return this.stack.length>0&&1===this.stack[this.stack.length-1].type},a7.prototype.decodeBinary=function(a,b){if(a>this.maxBinLength)throw new aS("Max length exceeded: bin length (".concat(a,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(a+b))throw a5;var c=this.pos+b,d=this.bytes.subarray(c,c+a);return this.pos+=b+a,d},a7.prototype.decodeExtension=function(a,b){if(a>this.maxExtLength)throw new aS("Max length exceeded: ext length (".concat(a,") > maxExtLength (").concat(this.maxExtLength,")"));var c=this.view.getInt8(this.pos+b),d=this.decodeBinary(a,b+1);return this.extensionCodec.decode(d,c,this.context)},a7.prototype.lookU8=function(){return this.view.getUint8(this.pos)},a7.prototype.lookU16=function(){return this.view.getUint16(this.pos)},a7.prototype.lookU32=function(){return this.view.getUint32(this.pos)},a7.prototype.readU8=function(){var a=this.view.getUint8(this.pos);return this.pos++,a},a7.prototype.readI8=function(){var a=this.view.getInt8(this.pos);return this.pos++,a},a7.prototype.readU16=function(){var a=this.view.getUint16(this.pos);return this.pos+=2,a},a7.prototype.readI16=function(){var a=this.view.getInt16(this.pos);return this.pos+=2,a},a7.prototype.readU32=function(){var a=this.view.getUint32(this.pos);return this.pos+=4,a},a7.prototype.readI32=function(){var a=this.view.getInt32(this.pos);return this.pos+=4,a},a7.prototype.readU64=function(){var a,b,c=(a=this.view,b=this.pos,0x100000000*a.getUint32(b)+a.getUint32(b+4));return this.pos+=8,c},a7.prototype.readI64=function(){var a=aH(this.view,this.pos);return this.pos+=8,a},a7.prototype.readF32=function(){var a=this.view.getFloat32(this.pos);return this.pos+=4,a},a7.prototype.readF64=function(){var a=this.view.getFloat64(this.pos);return this.pos+=8,a};class a9{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=a=>{let b=[],c=a.byteLength,d=Math.ceil(c/this.chunkedMTU),e=0,f=0;for(;f<c;){let g=Math.min(c,f+this.chunkedMTU),h=a.slice(f,g),i={__peerData:this._dataCount,n:e,data:h,total:d};b.push(i),f=g,e++}return this._dataCount++,b}}}let ba=aF.default||aF,bb=new class{isWebRTCSupported(){return"u">typeof RTCPeerConnection}isBrowserSupported(){let a=this.getBrowser(),b=this.getVersion();return!!this.supportedBrowsers.includes(a)&&("chrome"===a?b>=this.minChromeVersion:"firefox"===a?b>=this.minFirefoxVersion:"safari"===a&&!this.isIOS&&b>=this.minSafariVersion)}getBrowser(){return ba.browserDetails.browser}getVersion(){return ba.browserDetails.version||0}isUnifiedPlanSupported(){let a,b=this.getBrowser(),c=ba.browserDetails.version||0;if("chrome"===b&&c<this.minChromeVersion)return!1;if("firefox"===b&&c>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let d=!1;try{(a=new RTCPeerConnection).addTransceiver("audio"),d=!0}catch(a){}finally{a&&a.close()}return d}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS="u">typeof navigator&&["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},bc=a=>!a||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(a),bd=()=>Math.random().toString(36).slice(2),be={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},bf=new class extends a9{noop(){}blobToArrayBuffer(a,b){let c=new FileReader;return c.onload=function(a){a.target&&b(a.target.result)},c.readAsArrayBuffer(a),c}binaryStringToArrayBuffer(a){let b=new Uint8Array(a.length);for(let c=0;c<a.length;c++)b[c]=255&a.charCodeAt(c);return b.buffer}isSecure(){return"https:"===location.protocol}constructor(...a){super(...a),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=be,this.browser=bb.getBrowser(),this.browserVersion=bb.getVersion(),this.pack=E,this.unpack=D,this.supports=function(){let a,b={browser:bb.isBrowserSupported(),webRTC:bb.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!b.webRTC)return b;try{let c;a=new RTCPeerConnection(be),b.audioVideo=!0;try{c=a.createDataChannel("_PEERJSTEST",{ordered:!0}),b.data=!0,b.reliable=!!c.ordered;try{c.binaryType="blob",b.binaryBlob=!bb.isIOS}catch(a){}}catch(a){}finally{c&&c.close()}}catch(a){}finally{a&&a.close()}return b}(),this.validateId=bc,this.randomToken=bd}};var bg=new class{get logLevel(){return this._logLevel}set logLevel(a){this._logLevel=a}log(...a){this._logLevel>=3&&this._print(3,...a)}warn(...a){this._logLevel>=2&&this._print(2,...a)}error(...a){this._logLevel>=1&&this._print(1,...a)}setLogFunction(a){this._print=a}_print(a,...b){let c=["PeerJS: ",...b];for(let a in c)c[a]instanceof Error&&(c[a]="("+c[a].name+") "+c[a].message);a>=3?console.log(...c):a>=2?console.warn("WARNING",...c):a>=1&&console.error("ERROR",...c)}constructor(){this._logLevel=0}},bh={},bi=Object.prototype.hasOwnProperty,bj="~";function bk(){}function bl(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function bm(a,b,c,d,e){if("function"!=typeof c)throw TypeError("The listener must be a function");var f=new bl(c,d||a,e),g=bj?bj+b:b;return a._events[g]?a._events[g].fn?a._events[g]=[a._events[g],f]:a._events[g].push(f):(a._events[g]=f,a._eventsCount++),a}function bn(a,b){0==--a._eventsCount?a._events=new bk:delete a._events[b]}function bo(){this._events=new bk,this._eventsCount=0}Object.create&&(bk.prototype=Object.create(null),new bk().__proto__||(bj=!1)),bo.prototype.eventNames=function(){var a,b,c=[];if(0===this._eventsCount)return c;for(b in a=this._events)bi.call(a,b)&&c.push(bj?b.slice(1):b);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},bo.prototype.listeners=function(a){var b=bj?bj+a:a,c=this._events[b];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,e=c.length,f=Array(e);d<e;d++)f[d]=c[d].fn;return f},bo.prototype.listenerCount=function(a){var b=bj?bj+a:a,c=this._events[b];return c?c.fn?1:c.length:0},bo.prototype.emit=function(a,b,c,d,e,f){var g=bj?bj+a:a;if(!this._events[g])return!1;var h,i,j=this._events[g],k=arguments.length;if(j.fn){switch(j.once&&this.removeListener(a,j.fn,void 0,!0),k){case 1:return j.fn.call(j.context),!0;case 2:return j.fn.call(j.context,b),!0;case 3:return j.fn.call(j.context,b,c),!0;case 4:return j.fn.call(j.context,b,c,d),!0;case 5:return j.fn.call(j.context,b,c,d,e),!0;case 6:return j.fn.call(j.context,b,c,d,e,f),!0}for(i=1,h=Array(k-1);i<k;i++)h[i-1]=arguments[i];j.fn.apply(j.context,h)}else{var l,m=j.length;for(i=0;i<m;i++)switch(j[i].once&&this.removeListener(a,j[i].fn,void 0,!0),k){case 1:j[i].fn.call(j[i].context);break;case 2:j[i].fn.call(j[i].context,b);break;case 3:j[i].fn.call(j[i].context,b,c);break;case 4:j[i].fn.call(j[i].context,b,c,d);break;default:if(!h)for(l=1,h=Array(k-1);l<k;l++)h[l-1]=arguments[l];j[i].fn.apply(j[i].context,h)}}return!0},bo.prototype.on=function(a,b,c){return bm(this,a,b,c,!1)},bo.prototype.once=function(a,b,c){return bm(this,a,b,c,!0)},bo.prototype.removeListener=function(a,b,c,d){var e=bj?bj+a:a;if(!this._events[e])return this;if(!b)return bn(this,e),this;var f=this._events[e];if(f.fn)f.fn!==b||d&&!f.once||c&&f.context!==c||bn(this,e);else{for(var g=0,h=[],i=f.length;g<i;g++)(f[g].fn!==b||d&&!f[g].once||c&&f[g].context!==c)&&h.push(f[g]);h.length?this._events[e]=1===h.length?h[0]:h:bn(this,e)}return this},bo.prototype.removeAllListeners=function(a){var b;return a?(b=bj?bj+a:a,this._events[b]&&bn(this,b)):(this._events=new bk,this._eventsCount=0),this},bo.prototype.off=bo.prototype.removeListener,bo.prototype.addListener=bo.prototype.on,bo.prefixed=bj,bo.EventEmitter=bo,bh=bo;var bp={};a8(bp,"ConnectionType",()=>bq),a8(bp,"PeerErrorType",()=>br),a8(bp,"BaseConnectionErrorType",()=>bs),a8(bp,"DataConnectionErrorType",()=>bt),a8(bp,"SerializationType",()=>bu),a8(bp,"SocketEventType",()=>bv),a8(bp,"ServerMessageType",()=>bw);var bq=((f={}).Data="data",f.Media="media",f),br=((g={}).BrowserIncompatible="browser-incompatible",g.Disconnected="disconnected",g.InvalidID="invalid-id",g.InvalidKey="invalid-key",g.Network="network",g.PeerUnavailable="peer-unavailable",g.SslUnavailable="ssl-unavailable",g.ServerError="server-error",g.SocketError="socket-error",g.SocketClosed="socket-closed",g.UnavailableID="unavailable-id",g.WebRTC="webrtc",g),bs=((h={}).NegotiationFailed="negotiation-failed",h.ConnectionClosed="connection-closed",h),bt=((i={}).NotOpenYet="not-open-yet",i.MessageToBig="message-too-big",i),bu=((j={}).Binary="binary",j.BinaryUTF8="binary-utf8",j.JSON="json",j.None="raw",j),bv=((k={}).Message="message",k.Disconnected="disconnected",k.Error="error",k.Close="close",k),bw=((l={}).Heartbeat="HEARTBEAT",l.Candidate="CANDIDATE",l.Offer="OFFER",l.Answer="ANSWER",l.Open="OPEN",l.Error="ERROR",l.IdTaken="ID-TAKEN",l.InvalidKey="INVALID-KEY",l.Leave="LEAVE",l.Expire="EXPIRE",l);let bx="1.5.5";class by extends bh.EventEmitter{constructor(a,b,c,d,e,f=5e3){super(),this.pingInterval=f,this._disconnected=!0,this._messagesQueue=[],this._baseUrl=(a?"wss://":"ws://")+b+":"+c+d+"peerjs?key="+e}start(a,b){this._id=a;let c=`${this._baseUrl}&id=${a}&token=${b}`;!this._socket&&this._disconnected&&(this._socket=new WebSocket(c+"&version="+bx),this._disconnected=!1,this._socket.onmessage=a=>{let b;try{b=JSON.parse(a.data),bg.log("Server message received:",b)}catch(b){bg.log("Invalid server message",a.data);return}this.emit(bv.Message,b)},this._socket.onclose=a=>{this._disconnected||(bg.log("Socket closed.",a),this._cleanup(),this._disconnected=!0,this.emit(bv.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),bg.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen())return void bg.log("Cannot send heartbeat, because socket closed");let a=JSON.stringify({type:bw.Heartbeat});this._socket.send(a),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&1===this._socket.readyState}_sendQueuedMessages(){let a=[...this._messagesQueue];for(let b of(this._messagesQueue=[],a))this.send(b)}send(a){if(this._disconnected)return;if(!this._id)return void this._messagesQueue.push(a);if(!a.type)return void this.emit(bv.Error,"Invalid message");if(!this._wsOpen())return;let b=JSON.stringify(a);this._socket.send(b)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class bz{constructor(a){this.connection=a}startConnection(a){let b=this._startPeerConnection();if(this.connection.peerConnection=b,this.connection.type===bq.Media&&a._stream&&this._addTracksToConnection(a._stream,b),a.originator){let c=this.connection,d={ordered:!!a.reliable},e=b.createDataChannel(c.label,d);c._initializeDataChannel(e),this._makeOffer()}else this.handleSDP("OFFER",a.sdp)}_startPeerConnection(){bg.log("Creating RTCPeerConnection.");let a=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(a),a}_setupListeners(a){let b=this.connection.peer,c=this.connection.connectionId,d=this.connection.type,e=this.connection.provider;bg.log("Listening for ICE candidates."),a.onicecandidate=a=>{a.candidate&&a.candidate.candidate&&(bg.log(`Received ICE candidates for ${b}:`,a.candidate),e.socket.send({type:bw.Candidate,payload:{candidate:a.candidate,type:d,connectionId:c},dst:b}))},a.oniceconnectionstatechange=()=>{switch(a.iceConnectionState){case"failed":bg.log("iceConnectionState is failed, closing connections to "+b),this.connection.emitError(bs.NegotiationFailed,"Negotiation of connection to "+b+" failed."),this.connection.close();break;case"closed":bg.log("iceConnectionState is closed, closing connections to "+b),this.connection.emitError(bs.ConnectionClosed,"Connection to "+b+" closed."),this.connection.close();break;case"disconnected":bg.log("iceConnectionState changed to disconnected on the connection with "+b);break;case"completed":a.onicecandidate=()=>{}}this.connection.emit("iceStateChanged",a.iceConnectionState)},bg.log("Listening for data channel"),a.ondatachannel=a=>{bg.log("Received data channel");let d=a.channel;e.getConnection(b,c)._initializeDataChannel(d)},bg.log("Listening for remote stream"),a.ontrack=a=>{bg.log("Received remote stream");let d=a.streams[0],f=e.getConnection(b,c);f.type===bq.Media&&this._addStreamToMediaConnection(d,f)}}cleanup(){bg.log("Cleaning up PeerConnection to "+this.connection.peer);let a=this.connection.peerConnection;if(!a)return;this.connection.peerConnection=null,a.onicecandidate=a.oniceconnectionstatechange=a.ondatachannel=a.ontrack=()=>{};let b="closed"!==a.signalingState,c=!1,d=this.connection.dataChannel;d&&(c=!!d.readyState&&"closed"!==d.readyState),(b||c)&&a.close()}async _makeOffer(){let a=this.connection.peerConnection,b=this.connection.provider;try{let c=await a.createOffer(this.connection.options.constraints);bg.log("Created offer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(c.sdp=this.connection.options.sdpTransform(c.sdp)||c.sdp);try{await a.setLocalDescription(c),bg.log("Set localDescription:",c,`for:${this.connection.peer}`);let d={sdp:c,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===bq.Data){let a=this.connection;d={...d,label:a.label,reliable:a.reliable,serialization:a.serialization}}b.socket.send({type:bw.Offer,payload:d,dst:this.connection.peer})}catch(a){"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=a&&(b.emitError(br.WebRTC,a),bg.log("Failed to setLocalDescription, ",a))}}catch(a){b.emitError(br.WebRTC,a),bg.log("Failed to createOffer, ",a)}}async _makeAnswer(){let a=this.connection.peerConnection,b=this.connection.provider;try{let c=await a.createAnswer();bg.log("Created answer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(c.sdp=this.connection.options.sdpTransform(c.sdp)||c.sdp);try{await a.setLocalDescription(c),bg.log("Set localDescription:",c,`for:${this.connection.peer}`),b.socket.send({type:bw.Answer,payload:{sdp:c,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(a){b.emitError(br.WebRTC,a),bg.log("Failed to setLocalDescription, ",a)}}catch(a){b.emitError(br.WebRTC,a),bg.log("Failed to create answer, ",a)}}async handleSDP(a,b){b=new RTCSessionDescription(b);let c=this.connection.peerConnection,d=this.connection.provider;bg.log("Setting remote description",b);try{await c.setRemoteDescription(b),bg.log(`Set remoteDescription:${a} for:${this.connection.peer}`),"OFFER"===a&&await this._makeAnswer()}catch(a){d.emitError(br.WebRTC,a),bg.log("Failed to setRemoteDescription, ",a)}}async handleCandidate(a){bg.log("handleCandidate:",a);try{await this.connection.peerConnection.addIceCandidate(a),bg.log(`Added ICE candidate for:${this.connection.peer}`)}catch(a){this.connection.provider.emitError(br.WebRTC,a),bg.log("Failed to handleCandidate, ",a)}}_addTracksToConnection(a,b){if(bg.log(`add tracks from stream ${a.id} to peer connection`),!b.addTrack)return bg.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");a.getTracks().forEach(c=>{b.addTrack(c,a)})}_addStreamToMediaConnection(a,b){bg.log(`add stream ${a.id} to media connection ${b.connectionId}`),b.addStream(a)}}class bA extends bh.EventEmitter{emitError(a,b){bg.error("Error:",b),this.emit("error",new bB(`${a}`,b))}}class bB extends Error{constructor(a,b){"string"==typeof b?super(b):(super(),Object.assign(this,b)),this.type=a}}class bC extends bA{get open(){return this._open}constructor(a,b,c){super(),this.peer=a,this.provider=b,this.options=c,this._open=!1,this.metadata=c.metadata}}class bD extends bC{static #a=this.ID_PREFIX="mc_";get type(){return bq.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(a,b,c){super(a,b,c),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||bD.ID_PREFIX+bf.randomToken(),this._negotiator=new bz(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(a){this.dataChannel=a,this.dataChannel.onopen=()=>{bg.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{bg.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(a){bg.log("Receiving stream",a),this._remoteStream=a,super.emit("stream",a)}handleMessage(a){let b=a.type,c=a.payload;switch(a.type){case bw.Answer:this._negotiator.handleSDP(b,c.sdp),this._open=!0;break;case bw.Candidate:this._negotiator.handleCandidate(c.candidate);break;default:bg.warn(`Unrecognized message type:${b} from peer:${this.peer}`)}}answer(a,b={}){if(this._localStream)return void bg.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");for(let c of(this._localStream=a,b&&b.sdpTransform&&(this.options.sdpTransform=b.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:a}),this.provider._getMessages(this.connectionId)))this.handleMessage(c);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}}class bE{constructor(a){this._options=a}_buildRequest(a){let b=this._options.secure?"https":"http",{host:c,port:d,path:e,key:f}=this._options,g=new URL(`${b}://${c}:${d}${e}${f}/${a}`);return g.searchParams.set("ts",`${Date.now()}${Math.random()}`),g.searchParams.set("version",bx),fetch(g.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{let a=await this._buildRequest("id");if(200!==a.status)throw Error(`Error. Status:${a.status}`);return a.text()}catch(b){bg.error("Error retrieving ID",b);let a="";throw"/"===this._options.path&&this._options.host!==bf.CLOUD_HOST&&(a=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),Error("Could not get an ID from the server."+a)}}async listAllPeers(){try{let a=await this._buildRequest("peers");if(200!==a.status){if(401===a.status){let a="";throw a=this._options.host===bf.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",Error("It doesn't look like you have permission to list peers IDs. "+a)}throw Error(`Error. Status:${a.status}`)}return a.json()}catch(a){throw bg.error("Error retrieving list peers",a),Error("Could not get list peers from the server."+a)}}}class bF extends bC{static #a=this.ID_PREFIX="dc_";static #b=this.MAX_BUFFERED_AMOUNT=8388608;get type(){return bq.Data}constructor(a,b,c){super(a,b,c),this.connectionId=this.options.connectionId||bF.ID_PREFIX+bd(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new bz(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(a){this.dataChannel=a,this.dataChannel.onopen=()=>{bg.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=a=>{bg.log(`DC#${this.connectionId} dc onmessage:`,a.data)},this.dataChannel.onclose=()=>{bg.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(a){a?.flush?this.send({__peerData:{type:"close"}}):(this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close")))}send(a,b=!1){return this.open?this._send(a,b):void this.emitError(bt.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.")}async handleMessage(a){let b=a.payload;switch(a.type){case bw.Answer:await this._negotiator.handleSDP(a.type,b.sdp);break;case bw.Candidate:await this._negotiator.handleCandidate(b.candidate);break;default:bg.warn("Unrecognized message type:",a.type,"from peer:",this.peer)}}}class bG extends bF{get bufferSize(){return this._bufferSize}_initializeDataChannel(a){super._initializeDataChannel(a),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",a=>this._handleDataMessage(a))}_bufferedSend(a){(this._buffering||!this._trySend(a))&&(this._buffer.push(a),this._bufferSize=this._buffer.length)}_trySend(a){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>bF.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(a)}catch(a){return bg.error(`DC#:${this.connectionId} Error when sending:`,a),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||0===this._buffer.length)return;let a=this._buffer[0];this._trySend(a)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(a){a?.flush?this.send({__peerData:{type:"close"}}):(this._buffer=[],this._bufferSize=0,super.close())}constructor(...a){super(...a),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class bH extends bG{close(a){super.close(a),this._chunkedData={}}constructor(a,b,c){super(a,b,c),this.chunker=new a9,this.serialization=bu.Binary,this._chunkedData={}}_handleDataMessage({data:a}){let b=D(a),c=b.__peerData;c?"close"===c.type?this.close():this._handleChunk(b):this.emit("data",b)}_handleChunk(a){let b=a.__peerData,c=this._chunkedData[b]||{data:[],count:0,total:a.total};if(c.data[a.n]=new Uint8Array(a.data),c.count++,this._chunkedData[b]=c,c.total===c.count){delete this._chunkedData[b];let a=function(a){let b=0;for(let c of a)b+=c.byteLength;let c=new Uint8Array(b),d=0;for(let b of a)c.set(b,d),d+=b.byteLength;return c}(c.data);this._handleDataMessage({data:a})}}_send(a,b){let c=E(a);return c instanceof Promise?this._send_blob(c):!b&&c.byteLength>this.chunker.chunkedMTU?void this._sendChunks(c):void this._bufferedSend(c)}async _send_blob(a){let b=await a;b.byteLength>this.chunker.chunkedMTU?this._sendChunks(b):this._bufferedSend(b)}_sendChunks(a){let b=this.chunker.chunk(a);for(let a of(bg.log(`DC#${this.connectionId} Try to send ${b.length} chunks...`),b))this.send(a,!0)}}class bI extends bG{_handleDataMessage({data:a}){super.emit("data",a)}_send(a,b){this._bufferedSend(a)}constructor(...a){super(...a),this.serialization=bu.None}}class bJ extends bG{_handleDataMessage({data:a}){let b=this.parse(this.decoder.decode(a)),c=b.__peerData;c&&"close"===c.type?this.close():this.emit("data",b)}_send(a,b){let c=this.encoder.encode(this.stringify(a));c.byteLength>=bf.chunkedMTU?this.emitError(bt.MessageToBig,"Message too big for JSON channel"):this._bufferedSend(c)}constructor(...a){super(...a),this.serialization=bu.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}class bK extends bA{static #a=this.DEFAULT_KEY="peerjs";get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){let a=Object.create(null);for(let[b,c]of this._connections)a[b]=c;return a}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(a,b){let c;if(super(),this._serializers={raw:bI,json:bJ,binary:bH,"binary-utf8":bH,default:bH},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map,a&&a.constructor==Object?b=a:a&&(c=a.toString()),b={debug:0,host:bf.CLOUD_HOST,port:bf.CLOUD_PORT,path:"/",key:bK.DEFAULT_KEY,token:bf.randomToken(),config:bf.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...b},this._options=b,this._serializers={...this._serializers,...this.options.serializers},"/"===this._options.host&&(this._options.host=window.location.hostname),this._options.path&&("/"!==this._options.path[0]&&(this._options.path="/"+this._options.path),"/"!==this._options.path[this._options.path.length-1]&&(this._options.path+="/")),void 0===this._options.secure&&this._options.host!==bf.CLOUD_HOST?this._options.secure=bf.isSecure():this._options.host==bf.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&bg.setLogFunction(this._options.logFunction),bg.logLevel=this._options.debug||0,this._api=new bE(b),this._socket=this._createServerConnection(),!bf.supports.audioVideo&&!bf.supports.data)return void this._delayedAbort(br.BrowserIncompatible,"The current browser does not support WebRTC");if(c&&!bf.validateId(c))return void this._delayedAbort(br.InvalidID,`ID "${c}" is invalid`);c?this._initialize(c):this._api.retrieveId().then(a=>this._initialize(a)).catch(a=>this._abort(br.ServerError,a))}_createServerConnection(){let a=new by(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return a.on(bv.Message,a=>{this._handleMessage(a)}),a.on(bv.Error,a=>{this._abort(br.SocketError,a)}),a.on(bv.Disconnected,()=>{this.disconnected||(this.emitError(br.Network,"Lost connection to server."),this.disconnect())}),a.on(bv.Close,()=>{this.disconnected||this._abort(br.SocketClosed,"Underlying socket is already closed.")}),a}_initialize(a){this._id=a,this.socket.start(a,this._options.token)}_handleMessage(a){let b=a.type,c=a.payload,d=a.src;switch(b){case bw.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case bw.Error:this._abort(br.ServerError,c.msg);break;case bw.IdTaken:this._abort(br.UnavailableID,`ID "${this.id}" is taken`);break;case bw.InvalidKey:this._abort(br.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case bw.Leave:bg.log(`Received leave message from ${d}`),this._cleanupPeer(d),this._connections.delete(d);break;case bw.Expire:this.emitError(br.PeerUnavailable,`Could not connect to peer ${d}`);break;case bw.Offer:{let a=c.connectionId,b=this.getConnection(d,a);if(b&&(b.close(),bg.warn(`Offer received for existing Connection ID:${a}`)),c.type===bq.Media){let e=new bD(d,this,{connectionId:a,_payload:c,metadata:c.metadata});b=e,this._addConnection(d,b),this.emit("call",e)}else{if(c.type!==bq.Data)return void bg.warn(`Received malformed connection type:${c.type}`);let e=new this._serializers[c.serialization](d,this,{connectionId:a,_payload:c,metadata:c.metadata,label:c.label,serialization:c.serialization,reliable:c.reliable});b=e,this._addConnection(d,b),this.emit("connection",e)}for(let c of this._getMessages(a))b.handleMessage(c);break}default:{if(!c)return void bg.warn(`You received a malformed message from ${d} of type ${b}`);let e=c.connectionId,f=this.getConnection(d,e);f&&f.peerConnection?f.handleMessage(a):e?this._storeMessage(e,a):bg.warn("You received an unrecognized message:",a)}}}_storeMessage(a,b){this._lostMessages.has(a)||this._lostMessages.set(a,[]),this._lostMessages.get(a).push(b)}_getMessages(a){let b=this._lostMessages.get(a);return b?(this._lostMessages.delete(a),b):[]}connect(a,b={}){if(b={serialization:"default",...b},this.disconnected){bg.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(br.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}let c=new this._serializers[b.serialization](a,this,b);return this._addConnection(a,c),c}call(a,b,c={}){if(this.disconnected){bg.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(br.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!b)return void bg.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");let d=new bD(a,this,{...c,_stream:b});return this._addConnection(a,d),d}_addConnection(a,b){bg.log(`add connection ${b.type}:${b.connectionId} to peerId:${a}`),this._connections.has(a)||this._connections.set(a,[]),this._connections.get(a).push(b)}_removeConnection(a){let b=this._connections.get(a.peer);if(b){let c=b.indexOf(a);-1!==c&&b.splice(c,1)}this._lostMessages.delete(a.connectionId)}getConnection(a,b){let c=this._connections.get(a);if(!c)return null;for(let a of c)if(a.connectionId===b)return a;return null}_delayedAbort(a,b){setTimeout(()=>{this._abort(a,b)},0)}_abort(a,b){bg.error("Aborting!"),this.emitError(a,b),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(bg.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(let a of this._connections.keys())this._cleanupPeer(a),this._connections.delete(a);this.socket.removeAllListeners()}_cleanupPeer(a){let b=this._connections.get(a);if(b)for(let a of b)a.close()}disconnect(){if(this.disconnected)return;let a=this.id;bg.log(`Disconnect peer with ID:${a}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=a,this._id=null,this.emit("disconnected",a)}reconnect(){if(this.disconnected&&!this.destroyed)bg.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else if(this.destroyed)throw Error("This peer cannot reconnect to the server. It has already been destroyed.");else if(this.disconnected||this.open)throw Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`);else bg.error("In a hurry? We're still trying to make the initial connection!")}listAllPeers(a=a=>{}){this._api.listAllPeers().then(b=>a(b)).catch(a=>this._abort(br.ServerError,a))}}let bL=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}];class bM{peer=null;connections=new Map;config;events;reconnectAttempts=new Map;maxReconnectAttempts=5;constructor(a,b){this.config=a,this.events=b;return}async init(){try{this.peer=new bK(this.config.peerId,{debug:this.config.debug||!1,config:{iceServers:bL}}),this.setupPeerEvents()}catch(a){this.events.onError(a)}}setupPeerEvents(){this.peer&&(this.peer.on("open",a=>{console.log("[P2P] My Peer ID:",a),z.getState().setMyInfo(a,"")}),this.peer.on("connection",a=>{console.log("[P2P] Incoming connection from:",a.peer),this.setupConnectionEvents(a)}),this.peer.on("error",a=>{console.error("[P2P] Peer error:",a),this.events.onError(Error(a.type))}),this.peer.on("disconnected",()=>{console.log("[P2P] Peer disconnected"),z.getState().setConnectionStatus("disconnected")}),this.peer.on("close",()=>{console.log("[P2P] Peer closed"),z.getState().setConnectionStatus("disconnected")}))}setupConnectionEvents(a){let b=a.peer;a.on("open",()=>{console.log("[P2P] Connection opened:",b),this.connections.set(b,a),this.reconnectAttempts.delete(b);let c={id:b,name:"",publicKey:new Uint8Array(0),fingerprint:"",connected:!0,lastSeen:Date.now()};z.getState().addPeer(c),z.getState().setConnectionStatus("connected"),this.events.onPeerConnected(c)}),a.on("data",a=>{console.log("[P2P] Message received from:",b,a),this.handleIncomingData(b,a)}),a.on("close",()=>{console.log("[P2P] Connection closed:",b),this.connections.delete(b),z.getState().removePeer(b),this.events.onPeerDisconnected(b)}),a.on("error",a=>{console.error("[P2P] Connection error:",b,a),this.handleConnectionError(b,a)})}handleIncomingData(a,b){try{switch(z.getState().updatePeer(a,{lastSeen:Date.now()}),b.type){case"text":case"encrypted":this.events.onMessage(b);break;case"typing":z.getState().setTyping(a,b.data.isTyping);break;case"presence":z.getState().updatePeer(a,{name:b.data.name||"",connected:!0})}}catch(a){console.error("[P2P] Error handling incoming data:",a)}}handleConnectionError(a,b){let c=(this.reconnectAttempts.get(a)||0)+1;this.reconnectAttempts.set(a,c),c<this.maxReconnectAttempts?(console.log(`[P2P] Reconnecting to ${a} (attempt ${c})`),setTimeout(()=>{this.connectToPeer(a)},1e3*Math.pow(2,c))):(console.error(`[P2P] Failed to reconnect to ${a} after ${c} attempts`),this.events.onError(Error(` : ${a}`)))}connectToPeer(a){return new Promise((b,c)=>{if(!this.peer)return void c(Error("Peer  "));if(this.connections.has(a))return void b();console.log("[P2P] Connecting to:",a),z.getState().setConnectionStatus("connecting");let d=this.peer.connect(a,{reliable:!0,serialization:"json"});this.setupConnectionEvents(d),d.on("open",()=>{b()}),d.on("error",a=>{c(a)})})}sendToPeer(a,b){let c=this.connections.get(a);if(!c||!c.open)return console.error("[P2P] No connection to peer:",a),!1;try{return c.send(b),!0}catch(a){return console.error("[P2P] Error sending message:",a),!1}}broadcast(a){for(let b of Array.from(z.getState().peers.values()).filter(a=>a.connected))this.sendToPeer(b.id,a)}disconnectFromPeer(a){let b=this.connections.get(a);b&&(b.close(),this.connections.delete(a))}disconnectAll(){for(let[a,b]of this.connections.entries())b.close();this.connections.clear()}destroy(){this.disconnectAll(),this.peer&&(this.peer.destroy(),this.peer=null)}getMyPeerId(){return this.peer?.id||null}getConnectedPeers(){return Array.from(this.connections.keys())}isConnectedTo(a){let b=this.connections.get(a);return b?.open||!1}}let bN=null;function bO({message:a,isMine:b}){let c=new Date(a.timestamp).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"});return(0,u.jsx)("div",{className:`flex ${b?"justify-end":"justify-start"} animate-fade-in`,children:(0,u.jsxs)("div",{className:`max-w-[80%] ${b?"items-end":"items-start"} flex flex-col`,children:[!b&&(0,u.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1 ml-2",children:[a.senderId.slice(0,8),"..."]}),(0,u.jsxs)("div",{className:`message-bubble ${b?"message-sent":"message-received"}`,children:[(0,u.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:a.content}),(0,u.jsxs)("div",{className:`flex items-center gap-2 mt-1 ${b?"justify-end":"justify-start"}`,children:[(0,u.jsx)("span",{className:"text-xs opacity-70",children:c}),a.encrypted&&(0,u.jsx)("span",{className:"text-xs opacity-70",title:"End-to-End ",children:""}),b&&(0,u.jsx)(bP,{status:a.status})]})]})]})})}function bP({status:a}){let b={sending:{icon:"",label:" "},sent:{icon:"",label:""},delivered:{icon:"",label:""},read:{icon:"",label:""}}[a];return(0,u.jsx)("span",{className:"text-xs opacity-70",title:b.label,children:b.icon})}function bQ(){let[a,b]=(0,v.useState)(""),[c,d]=(0,v.useState)(!1),e=(0,v.useRef)(null),{myPeerId:f}=z();(0,v.useEffect)(()=>{if(!c||!f)return;let a=bN;if(!a)return;let b={id:crypto.randomUUID(),type:"typing",senderId:f,timestamp:Date.now(),data:{isTyping:!0}};a.broadcast(b);let e=setTimeout(()=>{d(!1)},3e3);return()=>clearTimeout(e)},[c,f]);let g=()=>{if(!a.trim()||!f)return;let c={id:crypto.randomUUID(),type:"text",senderId:f,timestamp:Date.now(),data:a,encrypted:!0},e=bN;e&&(e.broadcast(c),z.getState().addMessage({id:c.id,senderId:f,content:a,timestamp:Date.now(),status:"sent",encrypted:!0}),b(""),d(!1))};return(0,u.jsxs)("div",{className:"flex items-end gap-2",children:[(0,u.jsxs)("div",{className:"flex-1 relative",children:[(0,u.jsx)("textarea",{ref:e,value:a,onChange:a=>{b(a.target.value),!c&&a.target.value.length>0&&d(!0)},onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),g())},placeholder:" ... (Shift+Enter )",className:"w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-2 border-transparent focus:border-blue-500 focus:bg-white dark:focus:bg-gray-600 rounded-2xl resize-none focus:outline-none transition-colors text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400",rows:1,style:{minHeight:"48px",maxHeight:"120px"}}),(0,u.jsxs)("div",{className:"absolute right-3 bottom-3 text-xs text-secure-green flex items-center gap-1",children:[(0,u.jsx)("span",{className:"animate-pulse",children:""}),(0,u.jsx)("span",{className:"hidden sm:inline",children:"E2E"})]})]}),(0,u.jsxs)("button",{onClick:g,disabled:!a.trim(),className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-2xl font-semibold hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2","aria-label":" ",children:[(0,u.jsx)("span",{className:"hidden sm:inline",children:""}),(0,u.jsx)("span",{className:"text-xl",children:""})]})]})}function bR(){let{isAuthenticated:a,connectionStatus:b,peers:c}=z(),[d,e]=(0,v.useState)({level:"secure",message:"E2E  "});(0,v.useEffect)(()=>{a?"connected"!==b?e({level:"warning",message:" "}):0===Array.from(c.values()).filter(a=>a.connected).length?e({level:"warning",message:"  "}):e({level:"secure",message:"E2E "}):e({level:"insecure",message:""})},[a,b,c]);let f={secure:{containerClass:"bg-secure-green/10 text-secure-green border-secure-green/20",dotClass:"bg-secure-green animate-pulse",icon:""},warning:{containerClass:"bg-secure-yellow/10 text-secure-yellow border-secure-yellow/20",dotClass:"bg-secure-yellow animate-pulse",icon:""},insecure:{containerClass:"bg-secure-red/10 text-secure-red border-secure-red/20",dotClass:"bg-secure-red",icon:""}}[d.level];return(0,u.jsxs)("div",{className:`security-badge ${f.containerClass} border`,children:[(0,u.jsx)("div",{className:`w-2 h-2 rounded-full ${f.dotClass}`}),(0,u.jsxs)("span",{className:"font-medium",children:[f.icon," ",d.message]})]})}var bS=Object.defineProperty,bT=Object.getOwnPropertySymbols,bU=Object.prototype.hasOwnProperty,bV=Object.prototype.propertyIsEnumerable,bW=(a,b,c)=>b in a?bS(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,bX=(a,b)=>{for(var c in b||(b={}))bU.call(b,c)&&bW(a,c,b[c]);if(bT)for(var c of bT(b))bV.call(b,c)&&bW(a,c,b[c]);return a},bY=(a,b)=>{var c={};for(var d in a)bU.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&bT)for(var d of bT(a))0>b.indexOf(d)&&bV.call(a,d)&&(c[d]=a[d]);return c};(a=>{let b=class b{constructor(a,c,d,f){if(this.version=a,this.errorCorrectionLevel=c,this.modules=[],this.isFunction=[],a<b.MIN_VERSION||a>b.MAX_VERSION)throw RangeError("Version value out of range");if(f<-1||f>7)throw RangeError("Mask value out of range");this.size=4*a+17;let g=[];for(let a=0;a<this.size;a++)g.push(!1);for(let a=0;a<this.size;a++)this.modules.push(g.slice()),this.isFunction.push(g.slice());this.drawFunctionPatterns();const h=this.addEccAndInterleave(d);if(this.drawCodewords(h),-1==f){let a=1e9;for(let b=0;b<8;b++){this.applyMask(b),this.drawFormatBits(b);const c=this.getPenaltyScore();c<a&&(f=b,a=c),this.applyMask(b)}}e(0<=f&&f<=7),this.mask=f,this.applyMask(f),this.drawFormatBits(f),this.isFunction=[]}static encodeText(c,d){let e=a.QrSegment.makeSegments(c);return b.encodeSegments(e,d)}static encodeBinary(c,d){let e=a.QrSegment.makeBytes(c);return b.encodeSegments([e],d)}static encodeSegments(a,d,f=1,h=40,i=-1,j=!0){let k,l;if(!(b.MIN_VERSION<=f&&f<=h&&h<=b.MAX_VERSION)||i<-1||i>7)throw RangeError("Invalid value");for(k=f;;k++){let c=8*b.getNumDataCodewords(k,d),e=g.getTotalBits(a,k);if(e<=c){l=e;break}if(k>=h)throw RangeError("Data too long")}for(let a of[b.Ecc.MEDIUM,b.Ecc.QUARTILE,b.Ecc.HIGH])j&&l<=8*b.getNumDataCodewords(k,a)&&(d=a);let m=[];for(let b of a)for(let a of(c(b.mode.modeBits,4,m),c(b.numChars,b.mode.numCharCountBits(k),m),b.getData()))m.push(a);e(m.length==l);let n=8*b.getNumDataCodewords(k,d);e(m.length<=n),c(0,Math.min(4,n-m.length),m),c(0,(8-m.length%8)%8,m),e(m.length%8==0);for(let a=236;m.length<n;a^=253)c(a,8,m);let o=[];for(;8*o.length<m.length;)o.push(0);return m.forEach((a,b)=>o[b>>>3]|=a<<7-(7&b)),new b(k,d,o,i)}getModule(a,b){return 0<=a&&a<this.size&&0<=b&&b<this.size&&this.modules[b][a]}getModules(){return this.modules}drawFunctionPatterns(){for(let a=0;a<this.size;a++)this.setFunctionModule(6,a,a%2==0),this.setFunctionModule(a,6,a%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);let a=this.getAlignmentPatternPositions(),b=a.length;for(let c=0;c<b;c++)for(let d=0;d<b;d++)(0!=c||0!=d)&&(0!=c||d!=b-1)&&(c!=b-1||0!=d)&&this.drawAlignmentPattern(a[c],a[d]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(a){let b=this.errorCorrectionLevel.formatBits<<3|a,c=b;for(let a=0;a<10;a++)c=c<<1^(c>>>9)*1335;let f=(b<<10|c)^21522;e(f>>>15==0);for(let a=0;a<=5;a++)this.setFunctionModule(8,a,d(f,a));this.setFunctionModule(8,7,d(f,6)),this.setFunctionModule(8,8,d(f,7)),this.setFunctionModule(7,8,d(f,8));for(let a=9;a<15;a++)this.setFunctionModule(14-a,8,d(f,a));for(let a=0;a<8;a++)this.setFunctionModule(this.size-1-a,8,d(f,a));for(let a=8;a<15;a++)this.setFunctionModule(8,this.size-15+a,d(f,a));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let a=this.version;for(let b=0;b<12;b++)a=a<<1^(a>>>11)*7973;let b=this.version<<12|a;e(b>>>18==0);for(let a=0;a<18;a++){let c=d(b,a),e=this.size-11+a%3,f=Math.floor(a/3);this.setFunctionModule(e,f,c),this.setFunctionModule(f,e,c)}}drawFinderPattern(a,b){for(let c=-4;c<=4;c++)for(let d=-4;d<=4;d++){let e=Math.max(Math.abs(d),Math.abs(c)),f=a+d,g=b+c;0<=f&&f<this.size&&0<=g&&g<this.size&&this.setFunctionModule(f,g,2!=e&&4!=e)}}drawAlignmentPattern(a,b){for(let c=-2;c<=2;c++)for(let d=-2;d<=2;d++)this.setFunctionModule(a+d,b+c,1!=Math.max(Math.abs(d),Math.abs(c)))}setFunctionModule(a,b,c){this.modules[b][a]=c,this.isFunction[b][a]=!0}addEccAndInterleave(a){let c=this.version,d=this.errorCorrectionLevel;if(a.length!=b.getNumDataCodewords(c,d))throw RangeError("Invalid argument");let f=b.NUM_ERROR_CORRECTION_BLOCKS[d.ordinal][c],g=b.ECC_CODEWORDS_PER_BLOCK[d.ordinal][c],h=Math.floor(b.getNumRawDataModules(c)/8),i=f-h%f,j=Math.floor(h/f),k=[],l=b.reedSolomonComputeDivisor(g);for(let c=0,d=0;c<f;c++){let e=a.slice(d,d+j-g+(c<i?0:1));d+=e.length;let f=b.reedSolomonComputeRemainder(e,l);c<i&&e.push(0),k.push(e.concat(f))}let m=[];for(let a=0;a<k[0].length;a++)k.forEach((b,c)=>{(a!=j-g||c>=i)&&m.push(b[a])});return e(m.length==h),m}drawCodewords(a){if(a.length!=Math.floor(b.getNumRawDataModules(this.version)/8))throw RangeError("Invalid argument");let c=0;for(let b=this.size-1;b>=1;b-=2){6==b&&(b=5);for(let e=0;e<this.size;e++)for(let f=0;f<2;f++){let g=b-f,h=(b+1&2)==0?this.size-1-e:e;!this.isFunction[h][g]&&c<8*a.length&&(this.modules[h][g]=d(a[c>>>3],7-(7&c)),c++)}}e(c==8*a.length)}applyMask(a){if(a<0||a>7)throw RangeError("Mask value out of range");for(let b=0;b<this.size;b++)for(let c=0;c<this.size;c++){let d;switch(a){case 0:d=(c+b)%2==0;break;case 1:d=b%2==0;break;case 2:d=c%3==0;break;case 3:d=(c+b)%3==0;break;case 4:d=(Math.floor(c/3)+Math.floor(b/2))%2==0;break;case 5:d=c*b%2+c*b%3==0;break;case 6:d=(c*b%2+c*b%3)%2==0;break;case 7:d=((c+b)%2+c*b%3)%2==0;break;default:throw Error("Unreachable")}!this.isFunction[b][c]&&d&&(this.modules[b][c]=!this.modules[b][c])}}getPenaltyScore(){let a=0;for(let c=0;c<this.size;c++){let d=!1,e=0,f=[0,0,0,0,0,0,0];for(let g=0;g<this.size;g++)this.modules[c][g]==d?5==++e?a+=b.PENALTY_N1:e>5&&a++:(this.finderPenaltyAddHistory(e,f),d||(a+=this.finderPenaltyCountPatterns(f)*b.PENALTY_N3),d=this.modules[c][g],e=1);a+=this.finderPenaltyTerminateAndCount(d,e,f)*b.PENALTY_N3}for(let c=0;c<this.size;c++){let d=!1,e=0,f=[0,0,0,0,0,0,0];for(let g=0;g<this.size;g++)this.modules[g][c]==d?5==++e?a+=b.PENALTY_N1:e>5&&a++:(this.finderPenaltyAddHistory(e,f),d||(a+=this.finderPenaltyCountPatterns(f)*b.PENALTY_N3),d=this.modules[g][c],e=1);a+=this.finderPenaltyTerminateAndCount(d,e,f)*b.PENALTY_N3}for(let c=0;c<this.size-1;c++)for(let d=0;d<this.size-1;d++){let e=this.modules[c][d];e==this.modules[c][d+1]&&e==this.modules[c+1][d]&&e==this.modules[c+1][d+1]&&(a+=b.PENALTY_N2)}let c=0;for(let a of this.modules)c=a.reduce((a,b)=>a+ +!!b,c);let d=this.size*this.size,f=Math.ceil(Math.abs(20*c-10*d)/d)-1;return e(0<=f&&f<=9),e(0<=(a+=f*b.PENALTY_N4)&&a<=2568888),a}getAlignmentPatternPositions(){if(1==this.version)return[];{let a=Math.floor(this.version/7)+2,b=32==this.version?26:2*Math.ceil((4*this.version+4)/(2*a-2)),c=[6];for(let d=this.size-7;c.length<a;d-=b)c.splice(1,0,d);return c}}static getNumRawDataModules(a){if(a<b.MIN_VERSION||a>b.MAX_VERSION)throw RangeError("Version number out of range");let c=(16*a+128)*a+64;if(a>=2){let b=Math.floor(a/7)+2;c-=(25*b-10)*b-55,a>=7&&(c-=36)}return e(208<=c&&c<=29648),c}static getNumDataCodewords(a,c){return Math.floor(b.getNumRawDataModules(a)/8)-b.ECC_CODEWORDS_PER_BLOCK[c.ordinal][a]*b.NUM_ERROR_CORRECTION_BLOCKS[c.ordinal][a]}static reedSolomonComputeDivisor(a){if(a<1||a>255)throw RangeError("Degree out of range");let c=[];for(let b=0;b<a-1;b++)c.push(0);c.push(1);let d=1;for(let e=0;e<a;e++){for(let a=0;a<c.length;a++)c[a]=b.reedSolomonMultiply(c[a],d),a+1<c.length&&(c[a]^=c[a+1]);d=b.reedSolomonMultiply(d,2)}return c}static reedSolomonComputeRemainder(a,c){let d=c.map(a=>0);for(let e of a){let a=e^d.shift();d.push(0),c.forEach((c,e)=>d[e]^=b.reedSolomonMultiply(c,a))}return d}static reedSolomonMultiply(a,b){if(a>>>8!=0||b>>>8!=0)throw RangeError("Byte out of range");let c=0;for(let d=7;d>=0;d--)c=c<<1^(c>>>7)*285^(b>>>d&1)*a;return e(c>>>8==0),c}finderPenaltyCountPatterns(a){let b=a[1];e(b<=3*this.size);let c=b>0&&a[2]==b&&a[3]==3*b&&a[4]==b&&a[5]==b;return(c&&a[0]>=4*b&&a[6]>=b?1:0)+(c&&a[6]>=4*b&&a[0]>=b?1:0)}finderPenaltyTerminateAndCount(a,b,c){return a&&(this.finderPenaltyAddHistory(b,c),b=0),b+=this.size,this.finderPenaltyAddHistory(b,c),this.finderPenaltyCountPatterns(c)}finderPenaltyAddHistory(a,b){0==b[0]&&(a+=this.size),b.pop(),b.unshift(a)}};function c(a,b,c){if(b<0||b>31||a>>>b!=0)throw RangeError("Value out of range");for(let d=b-1;d>=0;d--)c.push(a>>>d&1)}function d(a,b){return(a>>>b&1)!=0}function e(a){if(!a)throw Error("Assertion error")}b.MIN_VERSION=1,b.MAX_VERSION=40,b.PENALTY_N1=3,b.PENALTY_N2=3,b.PENALTY_N3=40,b.PENALTY_N4=10,b.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],b.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],a.QrCode=b;let f=class a{constructor(a,b,c){if(this.mode=a,this.numChars=b,this.bitData=c,b<0)throw RangeError("Invalid argument");this.bitData=c.slice()}static makeBytes(b){let d=[];for(let a of b)c(a,8,d);return new a(a.Mode.BYTE,b.length,d)}static makeNumeric(b){if(!a.isNumeric(b))throw RangeError("String contains non-numeric characters");let d=[];for(let a=0;a<b.length;){let e=Math.min(b.length-a,3);c(parseInt(b.substring(a,a+e),10),3*e+1,d),a+=e}return new a(a.Mode.NUMERIC,b.length,d)}static makeAlphanumeric(b){let d;if(!a.isAlphanumeric(b))throw RangeError("String contains unencodable characters in alphanumeric mode");let e=[];for(d=0;d+2<=b.length;d+=2){let f=45*a.ALPHANUMERIC_CHARSET.indexOf(b.charAt(d));c(f+=a.ALPHANUMERIC_CHARSET.indexOf(b.charAt(d+1)),11,e)}return d<b.length&&c(a.ALPHANUMERIC_CHARSET.indexOf(b.charAt(d)),6,e),new a(a.Mode.ALPHANUMERIC,b.length,e)}static makeSegments(b){return""==b?[]:a.isNumeric(b)?[a.makeNumeric(b)]:a.isAlphanumeric(b)?[a.makeAlphanumeric(b)]:[a.makeBytes(a.toUtf8ByteArray(b))]}static makeEci(b){let d=[];if(b<0)throw RangeError("ECI assignment value out of range");if(b<128)c(b,8,d);else if(b<16384)c(2,2,d),c(b,14,d);else if(b<1e6)c(6,3,d),c(b,21,d);else throw RangeError("ECI assignment value out of range");return new a(a.Mode.ECI,0,d)}static isNumeric(b){return a.NUMERIC_REGEX.test(b)}static isAlphanumeric(b){return a.ALPHANUMERIC_REGEX.test(b)}getData(){return this.bitData.slice()}static getTotalBits(a,b){let c=0;for(let d of a){let a=d.mode.numCharCountBits(b);if(d.numChars>=1<<a)return 1/0;c+=4+a+d.bitData.length}return c}static toUtf8ByteArray(a){a=encodeURI(a);let b=[];for(let c=0;c<a.length;c++)"%"!=a.charAt(c)?b.push(a.charCodeAt(c)):(b.push(parseInt(a.substring(c+1,c+3),16)),c+=2);return b}};f.NUMERIC_REGEX=/^[0-9]*$/,f.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,f.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let g=f;a.QrSegment=f})(t||(t={})),n=(m=t||(t={})).QrCode||(m.QrCode={}),(c=class{constructor(a,b){this.ordinal=a,this.formatBits=b}}).LOW=new c(0,1),c.MEDIUM=new c(1,0),c.QUARTILE=new c(2,3),c.HIGH=new c(3,2),n.Ecc=c,p=(o=t||(t={})).QrSegment||(o.QrSegment={}),(d=class{constructor(a,b){this.modeBits=a,this.numBitsCharCount=b}numCharCountBits(a){return this.numBitsCharCount[Math.floor((a+7)/17)]}}).NUMERIC=new d(1,[10,12,14]),d.ALPHANUMERIC=new d(2,[9,11,13]),d.BYTE=new d(4,[8,16,16]),d.KANJI=new d(8,[8,10,12]),d.ECI=new d(7,[0,0,0]),p.Mode=d;var bZ=t,b$={L:bZ.QrCode.Ecc.LOW,M:bZ.QrCode.Ecc.MEDIUM,Q:bZ.QrCode.Ecc.QUARTILE,H:bZ.QrCode.Ecc.HIGH},b_="#FFFFFF",b0="#000000";function b1(a,b=0){let c=[];return a.forEach(function(a,d){let e=null;a.forEach(function(f,g){if(!f&&null!==e){c.push(`M${e+b} ${d+b}h${g-e}v1H${e+b}z`),e=null;return}if(g===a.length-1){if(!f)return;null===e?c.push(`M${g+b},${d+b} h1v1H${g+b}z`):c.push(`M${e+b},${d+b} h${g+1-e}v1H${e+b}z`);return}f&&null===e&&(e=g)})}),c.join("")}function b2(a,b){return a.slice().map((a,c)=>c<b.y||c>=b.y+b.h?a:a.map((a,c)=>(c<b.x||c>=b.x+b.w)&&a))}function b3({value:a,level:b,minVersion:c,includeMargin:d,marginSize:e,imageSettings:f,size:g,boostLevel:h}){let i=v.default.useMemo(()=>{let d=(Array.isArray(a)?a:[a]).reduce((a,b)=>(a.push(...bZ.QrSegment.makeSegments(b)),a),[]);return bZ.QrCode.encodeSegments(d,b$[b],c,void 0,void 0,h)},[a,b,c,h]),{cells:j,margin:k,numCells:l,calculatedImageSettings:m}=v.default.useMemo(()=>{let a=i.getModules(),b=null!=e?Math.max(Math.floor(e),0):4*!!d,c=a.length+2*b,h=function(a,b,c,d){if(null==d)return null;let e=a.length+2*c,f=Math.floor(.1*b),g=e/b,h=(d.width||f)*g,i=(d.height||f)*g,j=null==d.x?a.length/2-h/2:d.x*g,k=null==d.y?a.length/2-i/2:d.y*g,l=null==d.opacity?1:d.opacity,m=null;if(d.excavate){let a=Math.floor(j),b=Math.floor(k),c=Math.ceil(h+j-a),d=Math.ceil(i+k-b);m={x:a,y:b,w:c,h:d}}return{x:j,y:k,h:i,w:h,excavation:m,opacity:l,crossOrigin:d.crossOrigin}}(a,g,b,f);return{cells:a,margin:b,numCells:c,calculatedImageSettings:h}},[i,g,f,d,e]);return{qrcode:i,margin:k,cells:j,numCells:l,calculatedImageSettings:m}}var b4=function(){try{new Path2D().addPath(new Path2D)}catch(a){return!1}return!0}();v.default.forwardRef(function(a,b){let{value:c,size:d=128,level:e="L",bgColor:f=b_,fgColor:g=b0,includeMargin:h=!1,minVersion:i=1,boostLevel:j,marginSize:k,imageSettings:l}=a,m=bY(a,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:n}=m,o=bY(m,["style"]),p=null==l?void 0:l.src,q=v.default.useRef(null),r=v.default.useRef(null),s=v.default.useCallback(a=>{q.current=a,"function"==typeof b?b(a):b&&(b.current=a)},[b]),[t,u]=v.default.useState(!1),{margin:w,cells:x,numCells:y,calculatedImageSettings:z}=b3({value:c,level:e,minVersion:i,boostLevel:j,includeMargin:h,marginSize:k,imageSettings:l,size:d});v.default.useEffect(()=>{if(null!=q.current){let a=q.current,b=a.getContext("2d");if(!b)return;let c=x,e=r.current,h=null!=z&&null!==e&&e.complete&&0!==e.naturalHeight&&0!==e.naturalWidth;h&&null!=z.excavation&&(c=b2(x,z.excavation));let i=window.devicePixelRatio||1;a.height=a.width=d*i;let j=d/y*i;b.scale(j,j),b.fillStyle=f,b.fillRect(0,0,y,y),b.fillStyle=g,b4?b.fill(new Path2D(b1(c,w))):x.forEach(function(a,c){a.forEach(function(a,d){a&&b.fillRect(d+w,c+w,1,1)})}),z&&(b.globalAlpha=z.opacity),h&&b.drawImage(e,z.x+w,z.y+w,z.w,z.h)}}),v.default.useEffect(()=>{u(!1)},[p]);let A=bX({height:d,width:d},n),B=null;return null!=p&&(B=v.default.createElement("img",{src:p,key:p,style:{display:"none"},onLoad:()=>{u(!0)},ref:r,crossOrigin:null==z?void 0:z.crossOrigin})),v.default.createElement(v.default.Fragment,null,v.default.createElement("canvas",bX({style:A,height:d,width:d,ref:s,role:"img"},o)),B)}).displayName="QRCodeCanvas";var b5=v.default.forwardRef(function(a,b){let{value:c,size:d=128,level:e="L",bgColor:f=b_,fgColor:g=b0,includeMargin:h=!1,minVersion:i=1,boostLevel:j,title:k,marginSize:l,imageSettings:m}=a,n=bY(a,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:o,cells:p,numCells:q,calculatedImageSettings:r}=b3({value:c,level:e,minVersion:i,boostLevel:j,includeMargin:h,marginSize:l,imageSettings:m,size:d}),s=p,t=null;null!=m&&null!=r&&(null!=r.excavation&&(s=b2(p,r.excavation)),t=v.default.createElement("image",{href:m.src,height:r.h,width:r.w,x:r.x+o,y:r.y+o,preserveAspectRatio:"none",opacity:r.opacity,crossOrigin:r.crossOrigin}));let u=b1(s,o);return v.default.createElement("svg",bX({height:d,width:d,viewBox:`0 0 ${q} ${q}`,ref:b,role:"img"},n),!!k&&v.default.createElement("title",null,k),v.default.createElement("path",{fill:f,d:`M0,0 h${q}v${q}H0z`,shapeRendering:"crispEdges"}),v.default.createElement("path",{fill:g,d:u,shapeRendering:"crispEdges"}),t)});function b6({isOpen:a,onClose:b,myPeerId:c,onConnect:d}){let[e,f]=(0,v.useState)("my-code"),[g,h]=(0,v.useState)(""),[i,j]=(0,v.useState)(!1),[k,l]=(0,v.useState)(""),m=()=>{h(""),l(""),j(!1)},n=async()=>{if(!g.trim())return void l("Peer ID ");if(g===c)return void l("    ");j(!0),l("");try{await d(g.trim()),b(),m()}catch(a){l(a.message||" ")}finally{j(!1)}};return((0,v.useEffect)(()=>{let c=c=>{"Escape"===c.key&&a&&b()};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[a,b]),a)?(0,u.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,u.jsx)("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:b}),(0,u.jsxs)("div",{className:"relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[(0,u.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,u.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:" "}),(0,u.jsx)("button",{onClick:b,className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":"",children:""})]}),(0,u.jsxs)("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[(0,u.jsx)("button",{onClick:()=>{f("my-code"),m()},className:`flex-1 py-4 font-medium transition-colors ${"my-code"===e?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:" "}),(0,u.jsx)("button",{onClick:()=>{f("scan-code"),m()},className:`flex-1 py-4 font-medium transition-colors ${"scan-code"===e?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:" "})]}),(0,u.jsxs)("div",{className:"p-6",children:["my-code"===e&&(0,u.jsxs)("div",{className:"text-center space-y-6",children:[(0,u.jsxs)("div",{className:"space-y-2",children:[(0,u.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white",children:" Peer ID"}),(0,u.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:" QR   "})]}),(0,u.jsx)("div",{className:"bg-white p-6 rounded-xl border-2 border-dashed border-gray-300 inline-block",children:(0,u.jsx)(b5,{value:JSON.stringify({pid:c,v:1}),size:200,level:"H",includeMargin:!1})}),(0,u.jsxs)("div",{className:"space-y-2",children:[(0,u.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Peer ID ( )"}),(0,u.jsxs)("div",{className:"flex gap-2",children:[(0,u.jsx)("input",{type:"text",value:c,readOnly:!0,className:"flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-gray-900 dark:text-white text-sm font-mono"}),(0,u.jsx)("button",{onClick:()=>navigator.clipboard.writeText(c),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium",children:""})]})]}),(0,u.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 text-left",children:(0,u.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:[" ",(0,u.jsx)("strong",{children:":"}),"   QR   Peer ID  ."]})})]}),"scan-code"===e&&(0,u.jsxs)("div",{className:"space-y-6",children:[(0,u.jsxs)("div",{className:"space-y-2",children:[(0,u.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white",children:" Peer ID "}),(0,u.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"  Peer ID "})]}),(0,u.jsxs)("div",{className:"space-y-4",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{htmlFor:"peerIdInput",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Peer ID"}),(0,u.jsx)("input",{id:"peerIdInput",type:"text",value:g,onChange:a=>h(a.target.value),placeholder:" Peer ID ",className:"w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:border-blue-500 focus:outline-none focus:bg-white dark:focus:bg-gray-600 transition-colors text-gray-900 dark:text-white",disabled:i,autoFocus:!0})]}),k&&(0,u.jsxs)("div",{className:"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 px-4 py-3 rounded-lg text-sm",children:[" ",k]}),(0,u.jsx)("button",{onClick:n,disabled:!g.trim()||i,className:"w-full py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl font-semibold hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2",children:i?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("span",{className:"animate-spin",children:""}),(0,u.jsx)("span",{children:" ..."})]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("span",{children:""}),(0,u.jsx)("span",{children:""})]})})]}),(0,u.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[(0,u.jsx)("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:" "}),(0,u.jsxs)("ol",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 list-decimal list-inside",children:[(0,u.jsx)("li",{children:" Peer ID "}),(0,u.jsx)("li",{children:"  Peer ID "}),(0,u.jsx)("li",{children:'""  '})]})]})]})]})]})]}):null}function b7(){let[a,b]=(0,v.useState)(!1),[c,d]=(0,v.useState)(!1),{isAuthenticated:e,myPeerId:f,myName:g,connectionStatus:h,messages:i,isSetupComplete:j}=z(),k=z(A),l=z(B);return((0,v.useEffect)(()=>{var a,b;return a={debug:!0},b={onPeerConnected:a=>console.log("Peer connected:",a),onPeerDisconnected:a=>console.log("Peer disconnected:",a),onMessage:a=>{"text"===a.type&&z.getState().addMessage({id:a.id,senderId:a.senderId,content:a.data,timestamp:a.timestamp,status:"delivered",encrypted:a.encrypted||!1})},onError:a=>console.error("P2P error:",a)},bN&&bN.destroy(),bN=new bM(a,b),()=>{bN&&(bN.destroy(),bN=null)}},[]),j)?(0,u.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800",children:[(0,u.jsx)("header",{className:"bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 sticky top-0 z-10",children:(0,u.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-3 flex items-center justify-between",children:[(0,u.jsxs)("div",{className:"flex items-center gap-3",children:[(0,u.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center",children:(0,u.jsx)("span",{className:"text-white text-xl",children:""})}),(0,u.jsxs)("div",{children:[(0,u.jsx)("h1",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:" "}),(0,u.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"E2E  "})]})]}),(0,u.jsx)(bR,{})]})}),(0,u.jsxs)("main",{className:"max-w-4xl mx-auto p-4 pb-32",children:[(0,u.jsx)(b9,{status:h,peerCount:k.length}),(0,u.jsxs)("div",{className:"message-list overflow-y-auto space-y-4",style:{maxHeight:"calc(100vh - 300px)"},children:[0===i.length?(0,u.jsxs)("div",{className:"text-center py-12",children:[(0,u.jsx)("div",{className:"text-6xl mb-4",children:""}),(0,u.jsx)("h2",{className:"text-xl font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"  "}),(0,u.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"   !"})]}):i.map(a=>(0,u.jsx)(bO,{message:a,isMine:a.senderId===f},a.id)),l.length>0&&(0,u.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400 animate-pulse",children:[l.join(", "),"   ..."]})]})]}),(0,u.jsx)("footer",{className:"fixed bottom-0 left-0 right-0 bg-white/90 dark:bg-gray-900/90 backdrop-blur-sm border-t border-gray-200 dark:border-gray-700",children:(0,u.jsx)("div",{className:"max-w-4xl mx-auto p-4",children:(0,u.jsx)(bQ,{})})}),(0,u.jsx)(b6,{isOpen:c,onClose:()=>d(!1),myPeerId:f,onConnect:async a=>{let b=bN;b&&(await b.connectToPeer(a),d(!1))}}),(0,u.jsx)("button",{onClick:()=>d(!0),className:"fixed bottom-24 right-4 w-14 h-14 bg-gradient-to-br from-blue-500 to-indigo-600 text-white rounded-full shadow-lg hover:shadow-xl transition-all flex items-center justify-center text-2xl",children:""})]}):(0,u.jsx)(b8,{onSetupComplete:()=>b(!0)})}function b8({onSetupComplete:a}){let[b,c]=(0,v.useState)("welcome"),[d,e]=(0,v.useState)(""),[f,g]=(0,v.useState)(""),h=()=>{z.getState().setSetupComplete(!0),z.getState().setMyInfo(crypto.randomUUID(),f||""),z.getState().setAuthenticated(!0),a()};return(0,u.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4",children:(0,u.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 max-w-md w-full",children:["welcome"===b&&(0,u.jsxs)("div",{className:"text-center space-y-6",children:[(0,u.jsx)("div",{className:"text-6xl",children:""}),(0,u.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"    !"}),(0,u.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:" 3     ."}),(0,u.jsxs)("div",{className:"space-y-3",children:[(0,u.jsx)("button",{onClick:()=>{e(Array.from(crypto.getRandomValues(new Uint8Array(32))).map(a=>a.toString(16).padStart(2,"0")).join("")),c("create")},className:"w-full py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl font-semibold hover:shadow-lg transition-all",children:"   "}),(0,u.jsx)("button",{onClick:()=>c("join"),className:"w-full py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-semibold hover:bg-gray-200 dark:hover:bg-gray-600 transition-all",children:"  "})]}),(0,u.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 space-y-1",children:[(0,u.jsx)("p",{children:" End-to-End "}),(0,u.jsx)("p",{children:" P2P  "}),(0,u.jsx)("p",{children:"    "})]})]}),"create"===b&&(0,u.jsxs)("div",{className:"text-center space-y-6",children:[(0,u.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"  !"}),(0,u.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:" QR   "}),(0,u.jsx)("div",{className:"bg-white p-4 rounded-xl border-2 border-dashed border-gray-300",children:(0,u.jsx)(b5,{value:JSON.stringify({key:d,type:"family-key"}),size:200,level:"H",includeMargin:!1})}),(0,u.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"    .     ."}),(0,u.jsx)("button",{onClick:h,className:"w-full py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl font-semibold hover:shadow-lg transition-all",children:""})]}),"join"===b&&(0,u.jsxs)("div",{className:"text-center space-y-6",children:[(0,u.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"  "}),(0,u.jsx)("input",{type:"text",value:d,onChange:a=>e(a.target.value),placeholder:"  ",className:"w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),(0,u.jsx)("button",{onClick:h,disabled:!d,className:"w-full py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl font-semibold hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:""})]})]})})}function b9({status:a,peerCount:b}){let c={disconnected:{color:"bg-secure-red",text:" "},connecting:{color:"bg-secure-yellow",text:" ..."},connected:{color:"bg-secure-green",text:""}}[a];return(0,u.jsx)("div",{className:"mb-4 bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm",children:(0,u.jsxs)("div",{className:"flex items-center justify-between",children:[(0,u.jsxs)("div",{className:"flex items-center gap-3",children:[(0,u.jsx)("div",{className:`w-3 h-3 rounded-full ${c.color} ${"connected"===a?"animate-pulse":""}`}),(0,u.jsx)("span",{className:"font-medium text-gray-900 dark:text-white",children:c.text})]}),(0,u.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:b>0?` ${b} `:"  ..."})]})})}b5.displayName="QRCodeSVG",a.s(["default",()=>b7],24187)}];

//# sourceMappingURL=family-messenger_b66a2468._.js.map