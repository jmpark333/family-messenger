{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///home/rg3270/family-messenger/stores/chat-store.ts"],"sourcesContent":["import { create } from 'zustand';\nimport {\n  type ChatMessage,\n  type PeerInfo,\n  type FamilyKey,\n  type TypingIndicator,\n  type KeyExchangeData,\n} from '@/types';\n\n// Typing timeout (ms)\nconst TYPING_TIMEOUT = 3000;\n\ninterface ChatStore {\n  // ============ State ============\n  // Ïù∏Ï¶ù\n  isAuthenticated: boolean;\n  familyKey: FamilyKey | null;\n  myPeerId: string;\n  myName: string;\n\n  // P2P Ïó∞Í≤∞\n  peers: Map<string, PeerInfo>;\n  connectionStatus: 'disconnected' | 'connecting' | 'connected';\n\n  // Î©îÏãúÏßÄ\n  messages: ChatMessage[];\n  typingUsers: Map<string, NodeJS.Timeout>;\n\n  // Computed (memoized) values for selectors\n  connectedPeers: PeerInfo[];\n  typingUserList: string[];\n\n  // UI\n  isSetupComplete: boolean;\n  showKeyExchange: boolean;\n\n  // ============ Actions ============\n  // Ïù∏Ï¶ù\n  setAuthenticated: (authenticated: boolean, key?: FamilyKey) => void;\n  setMyInfo: (peerId: string, name: string) => void;\n\n  // P2P Ïó∞Í≤∞\n  addPeer: (peer: PeerInfo) => void;\n  removePeer: (peerId: string) => void;\n  updatePeer: (peerId: string, updates: Partial<PeerInfo>) => void;\n  setConnectionStatus: (status: 'disconnected' | 'connecting' | 'connected') => void;\n\n  // Î©îÏãúÏßÄ\n  addMessage: (message: ChatMessage) => void;\n  updateMessageStatus: (messageId: string, status: ChatMessage['status']) => void;\n  clearMessages: () => void;\n\n  // ÌÉÄÏù¥Ìïë\n  setTyping: (userId: string, isTyping: boolean) => void;\n\n  // UI\n  setSetupComplete: (complete: boolean) => void;\n  setShowKeyExchange: (show: boolean) => void;\n\n  // Ï¥àÍ∏∞Ìôî\n  reset: () => void;\n}\n\nconst initialState = {\n  isAuthenticated: false,\n  familyKey: null,\n  myPeerId: '',\n  myName: '',\n  peers: new Map(),\n  connectionStatus: 'disconnected' as const,\n  messages: [],\n  typingUsers: new Map(),\n  connectedPeers: [],\n  typingUserList: [],\n  isSetupComplete: false,\n  showKeyExchange: false,\n};\n\nexport const useChatStore = create<ChatStore>((set, get) => ({\n  ...initialState,\n\n  // Ïù∏Ï¶ù Ïï°ÏÖò\n  setAuthenticated: (authenticated, key) =>\n    set({\n      isAuthenticated: authenticated,\n      familyKey: key || null,\n    }),\n\n  setMyInfo: (peerId, name) =>\n    set({\n      myPeerId: peerId,\n      myName: name,\n    }),\n\n  // P2P Ïó∞Í≤∞ Ïï°ÏÖò\n  addPeer: (peer) =>\n    set((state) => {\n      const newPeers = new Map(state.peers);\n      newPeers.set(peer.id, peer);\n      const connectedPeers = Array.from(newPeers.values()).filter((p) => p.connected);\n      return { peers: newPeers, connectedPeers };\n    }),\n\n  removePeer: (peerId) =>\n    set((state) => {\n      const newPeers = new Map(state.peers);\n      newPeers.delete(peerId);\n      const connectedPeers = Array.from(newPeers.values()).filter((p) => p.connected);\n      return { peers: newPeers, connectedPeers };\n    }),\n\n  updatePeer: (peerId, updates) =>\n    set((state) => {\n      const newPeers = new Map(state.peers);\n      const peer = newPeers.get(peerId);\n      if (peer) {\n        newPeers.set(peerId, { ...peer, ...updates });\n      }\n      const connectedPeers = Array.from(newPeers.values()).filter((p) => p.connected);\n      return { peers: newPeers, connectedPeers };\n    }),\n\n  setConnectionStatus: (status) =>\n    set({ connectionStatus: status }),\n\n  // Î©îÏãúÏßÄ Ïï°ÏÖò\n  addMessage: (message) =>\n    set((state) => ({\n      messages: [...state.messages, message],\n    })),\n\n  updateMessageStatus: (messageId, status) =>\n    set((state) => ({\n      messages: state.messages.map((m) =>\n        m.id === messageId ? { ...m, status } : m,\n      ),\n    })),\n\n  clearMessages: () =>\n    set({ messages: [] }),\n\n  // ÌÉÄÏù¥Ìïë Ïï°ÏÖò\n  setTyping: (userId, isTyping) => {\n    const state = get();\n    const newTypingUsers = new Map(state.typingUsers);\n\n    if (isTyping) {\n      // Set typing indicator\n      newTypingUsers.set(userId, setTimeout(() => {\n        get().setTyping(userId, false);\n      }, TYPING_TIMEOUT) as unknown as NodeJS.Timeout);\n    } else {\n      // Clear typing indicator\n      const timeout = newTypingUsers.get(userId);\n      if (timeout) {\n        clearTimeout(timeout);\n        newTypingUsers.delete(userId);\n      }\n    }\n\n    const typingUserList = Array.from(newTypingUsers.keys());\n    set({ typingUsers: newTypingUsers, typingUserList });\n  },\n\n  // UI Ïï°ÏÖò\n  setSetupComplete: (complete) =>\n    set({ isSetupComplete: complete }),\n\n  setShowKeyExchange: (show) =>\n    set({ showKeyExchange: show }),\n\n  // Ï¥àÍ∏∞Ìôî\n  reset: () => set(initialState),\n}));\n\n// Selector helpers for optimized re-renders\nexport const selectPeers = (state: ChatStore) => Array.from(state.peers.values());\nexport const selectConnectedPeers = (state: ChatStore) => state.connectedPeers;\nexport const selectTypingUsers = (state: ChatStore) => state.typingUserList;\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AASA,sBAAsB;AACtB,MAAM,iBAAiB;AAqDvB,MAAM,eAAe;IACnB,iBAAiB;IACjB,WAAW;IACX,UAAU;IACV,QAAQ;IACR,OAAO,IAAI;IACX,kBAAkB;IAClB,UAAU,EAAE;IACZ,aAAa,IAAI;IACjB,gBAAgB,EAAE;IAClB,gBAAgB,EAAE;IAClB,iBAAiB;IACjB,iBAAiB;AACnB;AAEO,MAAM,eAAe,IAAA,yKAAM,EAAY,CAAC,KAAK,MAAQ,CAAC;QAC3D,GAAG,YAAY;QAEf,QAAQ;QACR,kBAAkB,CAAC,eAAe,MAChC,IAAI;gBACF,iBAAiB;gBACjB,WAAW,OAAO;YACpB;QAEF,WAAW,CAAC,QAAQ,OAClB,IAAI;gBACF,UAAU;gBACV,QAAQ;YACV;QAEF,YAAY;QACZ,SAAS,CAAC,OACR,IAAI,CAAC;gBACH,MAAM,WAAW,IAAI,IAAI,MAAM,KAAK;gBACpC,SAAS,GAAG,CAAC,KAAK,EAAE,EAAE;gBACtB,MAAM,iBAAiB,MAAM,IAAI,CAAC,SAAS,MAAM,IAAI,MAAM,CAAC,CAAC,IAAM,EAAE,SAAS;gBAC9E,OAAO;oBAAE,OAAO;oBAAU;gBAAe;YAC3C;QAEF,YAAY,CAAC,SACX,IAAI,CAAC;gBACH,MAAM,WAAW,IAAI,IAAI,MAAM,KAAK;gBACpC,SAAS,MAAM,CAAC;gBAChB,MAAM,iBAAiB,MAAM,IAAI,CAAC,SAAS,MAAM,IAAI,MAAM,CAAC,CAAC,IAAM,EAAE,SAAS;gBAC9E,OAAO;oBAAE,OAAO;oBAAU;gBAAe;YAC3C;QAEF,YAAY,CAAC,QAAQ,UACnB,IAAI,CAAC;gBACH,MAAM,WAAW,IAAI,IAAI,MAAM,KAAK;gBACpC,MAAM,OAAO,SAAS,GAAG,CAAC;gBAC1B,IAAI,MAAM;oBACR,SAAS,GAAG,CAAC,QAAQ;wBAAE,GAAG,IAAI;wBAAE,GAAG,OAAO;oBAAC;gBAC7C;gBACA,MAAM,iBAAiB,MAAM,IAAI,CAAC,SAAS,MAAM,IAAI,MAAM,CAAC,CAAC,IAAM,EAAE,SAAS;gBAC9E,OAAO;oBAAE,OAAO;oBAAU;gBAAe;YAC3C;QAEF,qBAAqB,CAAC,SACpB,IAAI;gBAAE,kBAAkB;YAAO;QAEjC,SAAS;QACT,YAAY,CAAC,UACX,IAAI,CAAC,QAAU,CAAC;oBACd,UAAU;2BAAI,MAAM,QAAQ;wBAAE;qBAAQ;gBACxC,CAAC;QAEH,qBAAqB,CAAC,WAAW,SAC/B,IAAI,CAAC,QAAU,CAAC;oBACd,UAAU,MAAM,QAAQ,CAAC,GAAG,CAAC,CAAC,IAC5B,EAAE,EAAE,KAAK,YAAY;4BAAE,GAAG,CAAC;4BAAE;wBAAO,IAAI;gBAE5C,CAAC;QAEH,eAAe,IACb,IAAI;gBAAE,UAAU,EAAE;YAAC;QAErB,SAAS;QACT,WAAW,CAAC,QAAQ;YAClB,MAAM,QAAQ;YACd,MAAM,iBAAiB,IAAI,IAAI,MAAM,WAAW;YAEhD,IAAI,UAAU;gBACZ,uBAAuB;gBACvB,eAAe,GAAG,CAAC,QAAQ,WAAW;oBACpC,MAAM,SAAS,CAAC,QAAQ;gBAC1B,GAAG;YACL,OAAO;gBACL,yBAAyB;gBACzB,MAAM,UAAU,eAAe,GAAG,CAAC;gBACnC,IAAI,SAAS;oBACX,aAAa;oBACb,eAAe,MAAM,CAAC;gBACxB;YACF;YAEA,MAAM,iBAAiB,MAAM,IAAI,CAAC,eAAe,IAAI;YACrD,IAAI;gBAAE,aAAa;gBAAgB;YAAe;QACpD;QAEA,QAAQ;QACR,kBAAkB,CAAC,WACjB,IAAI;gBAAE,iBAAiB;YAAS;QAElC,oBAAoB,CAAC,OACnB,IAAI;gBAAE,iBAAiB;YAAK;QAE9B,MAAM;QACN,OAAO,IAAM,IAAI;IACnB,CAAC;AAGM,MAAM,cAAc,CAAC,QAAqB,MAAM,IAAI,CAAC,MAAM,KAAK,CAAC,MAAM;AACvE,MAAM,uBAAuB,CAAC,QAAqB,MAAM,cAAc;AACvE,MAAM,oBAAoB,CAAC,QAAqB,MAAM,cAAc"}},
    {"offset": {"line": 142, "column": 0}, "map": {"version":3,"sources":["file:///home/rg3270/family-messenger/lib/webrtc/peer.ts"],"sourcesContent":["/**\n * WebRTC Í∏∞Î∞ò P2P ÌÜµÏã† Í¥ÄÎ¶¨Ïûê\n *\n * Ïù¥ Íµ¨ÌòÑÏóêÏÑúÎäî ÏãúÍ∑∏ÎÑêÎßÅ ÏóÜÏù¥ÎèÑ ÎèôÏûëÌïòÎèÑÎ°ù ÏÑ§Í≥ÑÌñàÏäµÎãàÎã§.\n * Ïã§Ï†ú Î∞∞Ìè¨ÏóêÏÑúÎäî ÏµúÏÜåÌïúÏùò ÏãúÍ∑∏ÎÑêÎßÅ ÏÑúÎ≤ÑÍ∞Ä ÌïÑÏöîÌï† Ïàò ÏûàÏäµÎãàÎã§.\n */\n\nimport Peer, { DataConnection, MediaConnection } from 'peerjs';\nimport type { PeerInfo, DataMessage } from '@/types';\nimport { useChatStore } from '@/stores/chat-store';\n\n// Í≥µÏö© STUN ÏÑúÎ≤Ñ\nconst ICE_SERVERS = [\n  { urls: 'stun:stun.l.google.com:19302' },\n  { urls: 'stun:stun1.l.google.com:19302' },\n  { urls: 'stun:stun2.l.google.com:19302' },\n  { urls: 'stun:stun3.l.google.com:19302' },\n  { urls: 'stun:stun4.l.google.com:19302' },\n];\n\nexport interface P2PConfig {\n  peerId?: string;\n  debug?: boolean;\n}\n\nexport interface P2PEvents {\n  onPeerConnected: (peer: PeerInfo) => void;\n  onPeerDisconnected: (peerId: string) => void;\n  onMessage: (message: DataMessage) => void;\n  onError: (error: Error) => void;\n}\n\n/**\n * P2P ÌÜµÏã† Í¥ÄÎ¶¨Ïûê\n */\nexport class P2PManager {\n  private peer: Peer | null = null;\n  private connections: Map<string, DataConnection> = new Map();\n  private config: P2PConfig;\n  private events: P2PEvents;\n  private reconnectAttempts: Map<string, number> = new Map();\n  private maxReconnectAttempts = 5;\n\n  constructor(config: P2PConfig, events: P2PEvents) {\n    this.config = config;\n    this.events = events;\n\n    if (typeof window === 'undefined') {\n      return; // SSR Î∞©ÏßÄ\n    }\n\n    this.init();\n  }\n\n  /**\n   * PeerJS Ï¥àÍ∏∞Ìôî\n   */\n  private async init() {\n    try {\n      this.peer = new Peer(this.config.peerId, {\n        debug: this.config.debug || false,\n        config: {\n          iceServers: ICE_SERVERS,\n        },\n      });\n\n      this.setupPeerEvents();\n    } catch (error) {\n      this.events.onError(error as Error);\n    }\n  }\n\n  /**\n   * Peer Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨ ÏÑ§Ï†ï\n   */\n  private setupPeerEvents() {\n    if (!this.peer) return;\n\n    // PeerÍ∞Ä Ï§ÄÎπÑÎê®\n    this.peer.on('open', (peerId) => {\n      console.log('[P2P] My Peer ID:', peerId);\n      useChatStore.getState().setMyInfo(peerId, 'ÎÇò');\n    });\n\n    // Ïó∞Í≤∞ ÏàòÎùΩ\n    this.peer.on('connection', (conn) => {\n      console.log('[P2P] Incoming connection from:', conn.peer);\n      this.setupConnectionEvents(conn);\n    });\n\n    // ÏóêÎü¨ Ï≤òÎ¶¨\n    this.peer.on('error', (error) => {\n      console.error('[P2P] Peer error:', error);\n      this.events.onError(new Error(error.type));\n    });\n\n    // Ïó∞Í≤∞ Ï¢ÖÎ£å\n    this.peer.on('disconnected', () => {\n      console.log('[P2P] Peer disconnected');\n      useChatStore.getState().setConnectionStatus('disconnected');\n    });\n\n    // Peer Ï¢ÖÎ£å\n    this.peer.on('close', () => {\n      console.log('[P2P] Peer closed');\n      useChatStore.getState().setConnectionStatus('disconnected');\n    });\n  }\n\n  /**\n   * Data Connection Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨ ÏÑ§Ï†ï\n   */\n  private setupConnectionEvents(conn: DataConnection) {\n    const peerId = conn.peer;\n\n    // Ïó∞Í≤∞Îê®\n    conn.on('open', () => {\n      console.log('[P2P] Connection opened:', peerId);\n      this.connections.set(peerId, conn);\n      this.reconnectAttempts.delete(peerId);\n\n      // ÌîºÏñ¥ Ï†ïÎ≥¥ Ï†ÄÏû•\n      const peerInfo: PeerInfo = {\n        id: peerId,\n        name: '', // Ï∂îÌõÑ Î©îÏãúÏßÄÎ°ú ÏàòÏã†\n        publicKey: new Uint8Array(0),\n        fingerprint: '',\n        connected: true,\n        lastSeen: Date.now(),\n      };\n\n      useChatStore.getState().addPeer(peerInfo);\n      useChatStore.getState().setConnectionStatus('connected');\n      this.events.onPeerConnected(peerInfo);\n    });\n\n    // Î©îÏãúÏßÄ ÏàòÎùΩ\n    conn.on('data', (data) => {\n      console.log('[P2P] Message received from:', peerId, data);\n      this.handleIncomingData(peerId, data);\n    });\n\n    // Ïó∞Í≤∞ Ï¢ÖÎ£å\n    conn.on('close', () => {\n      console.log('[P2P] Connection closed:', peerId);\n      this.connections.delete(peerId);\n      useChatStore.getState().removePeer(peerId);\n      this.events.onPeerDisconnected(peerId);\n    });\n\n    // ÏóêÎü¨\n    conn.on('error', (error) => {\n      console.error('[P2P] Connection error:', peerId, error);\n      this.handleConnectionError(peerId, error);\n    });\n  }\n\n  /**\n   * ÏàòÏã† Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨\n   */\n  private handleIncomingData(peerId: string, data: any) {\n    try {\n      const message: DataMessage = data;\n\n      // ÌîºÏñ¥Ïùò lastSeen ÏóÖÎç∞Ïù¥Ìä∏\n      useChatStore.getState().updatePeer(peerId, {\n        lastSeen: Date.now(),\n      });\n\n      // Î©îÏãúÏßÄ ÌÉÄÏûÖÎ≥Ñ Ï≤òÎ¶¨\n      switch (message.type) {\n        case 'text':\n        case 'encrypted':\n          this.events.onMessage(message);\n          break;\n\n        case 'typing':\n          useChatStore.getState().setTyping(peerId, message.data.isTyping);\n          break;\n\n        case 'presence':\n          // ÌîºÏñ¥ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏\n          useChatStore.getState().updatePeer(peerId, {\n            name: message.data.name || '',\n            connected: true,\n          });\n          break;\n      }\n    } catch (error) {\n      console.error('[P2P] Error handling incoming data:', error);\n    }\n  }\n\n  /**\n   * Ïó∞Í≤∞ ÏóêÎü¨ Ï≤òÎ¶¨\n   */\n  private handleConnectionError(peerId: string, error: any) {\n    const attempts = (this.reconnectAttempts.get(peerId) || 0) + 1;\n    this.reconnectAttempts.set(peerId, attempts);\n\n    if (attempts < this.maxReconnectAttempts) {\n      // Ïû¨Ïó∞Í≤∞ ÏãúÎèÑ\n      console.log(`[P2P] Reconnecting to ${peerId} (attempt ${attempts})`);\n      setTimeout(() => {\n        this.connectToPeer(peerId);\n      }, Math.pow(2, attempts) * 1000); // ÏßÄÏàò Î∞±Ïò§ÌîÑ\n    } else {\n      // ÏµúÏ¢Ö Ïã§Ìå®\n      console.error(`[P2P] Failed to reconnect to ${peerId} after ${attempts} attempts`);\n      this.events.onError(new Error(`Ïó∞Í≤∞ Ïã§Ìå®: ${peerId}`));\n    }\n  }\n\n  /**\n   * ÌîºÏñ¥Ïóê Ïó∞Í≤∞\n   */\n  connectToPeer(peerId: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n      if (!this.peer) {\n        reject(new Error('PeerÍ∞Ä Ï¥àÍ∏∞ÌôîÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§'));\n        return;\n      }\n\n      // Ïù¥ÎØ∏ Ïó∞Í≤∞Îê®\n      if (this.connections.has(peerId)) {\n        resolve();\n        return;\n      }\n\n      console.log('[P2P] Connecting to:', peerId);\n      useChatStore.getState().setConnectionStatus('connecting');\n\n      const conn = this.peer.connect(peerId, {\n        reliable: true,\n        serialization: 'json', // JSON ÏßÅÎ†¨Ìôî\n      });\n\n      this.setupConnectionEvents(conn);\n\n      // Ïó∞Í≤∞ ÎåÄÍ∏∞\n      conn.on('open', () => {\n        resolve();\n      });\n\n      conn.on('error', (error) => {\n        reject(error);\n      });\n    });\n  }\n\n  /**\n   * ÌîºÏñ¥Ïóê Î©îÏãúÏßÄ Ï†ÑÏÜ°\n   */\n  sendToPeer(peerId: string, message: DataMessage): boolean {\n    const conn = this.connections.get(peerId);\n    if (!conn || !conn.open) {\n      console.error('[P2P] No connection to peer:', peerId);\n      return false;\n    }\n\n    try {\n      conn.send(message);\n      return true;\n    } catch (error) {\n      console.error('[P2P] Error sending message:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Î™®Îì† ÌîºÏñ¥Ïóê Î©îÏãúÏßÄ Î∞©ÏÜ°\n   */\n  broadcast(message: DataMessage): void {\n    const store = useChatStore.getState();\n    const peers = Array.from(store.peers.values()).filter((p) => p.connected);\n\n    for (const peer of peers) {\n      this.sendToPeer(peer.id, message);\n    }\n  }\n\n  /**\n   * ÌäπÏ†ï ÌîºÏñ¥ÏôÄ Ïó∞Í≤∞ Ï¢ÖÎ£å\n   */\n  disconnectFromPeer(peerId: string): void {\n    const conn = this.connections.get(peerId);\n    if (conn) {\n      conn.close();\n      this.connections.delete(peerId);\n    }\n  }\n\n  /**\n   * Î™®Îì† Ïó∞Í≤∞ Ï¢ÖÎ£å\n   */\n  disconnectAll(): void {\n    for (const [peerId, conn] of this.connections.entries()) {\n      conn.close();\n    }\n    this.connections.clear();\n  }\n\n  /**\n   * P2P Í¥ÄÎ¶¨Ïûê Ï¢ÖÎ£å\n   */\n  destroy(): void {\n    this.disconnectAll();\n\n    if (this.peer) {\n      this.peer.destroy();\n      this.peer = null;\n    }\n  }\n\n  /**\n   * ÎÇ¥ Peer ID Î∞òÌôò\n   */\n  getMyPeerId(): string | null {\n    return this.peer?.id || null;\n  }\n\n  /**\n   * Ïó∞Í≤∞Îêú ÌîºÏñ¥ Î™©Î°ù Î∞òÌôò\n   */\n  getConnectedPeers(): string[] {\n    return Array.from(this.connections.keys());\n  }\n\n  /**\n   * ÌäπÏ†ï ÌîºÏñ¥ÏôÄ Ïó∞Í≤∞Îê® ÌôïÏù∏\n   */\n  isConnectedTo(peerId: string): boolean {\n    const conn = this.connections.get(peerId);\n    return conn?.open || false;\n  }\n}\n\n// ============ P2P Í¥ÄÎ¶¨Ïûê Ìå©ÌÜ†Î¶¨ ============\n\nlet p2pManagerInstance: P2PManager | null = null;\n\nexport function initP2PManager(config: P2PConfig, events: P2PEvents): P2PManager {\n  if (p2pManagerInstance) {\n    p2pManagerInstance.destroy();\n  }\n\n  p2pManagerInstance = new P2PManager(config, events);\n  return p2pManagerInstance;\n}\n\nexport function getP2PManager(): P2PManager | null {\n  return p2pManagerInstance;\n}\n\nexport function destroyP2PManager(): void {\n  if (p2pManagerInstance) {\n    p2pManagerInstance.destroy();\n    p2pManagerInstance = null;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;CAKC,GAED;AAEA;;;AAEA,aAAa;AACb,MAAM,cAAc;IAClB;QAAE,MAAM;IAA+B;IACvC;QAAE,MAAM;IAAgC;IACxC;QAAE,MAAM;IAAgC;IACxC;QAAE,MAAM;IAAgC;IACxC;QAAE,MAAM;IAAgC;CACzC;AAiBM,MAAM;IACH,OAAoB,KAAK;IACzB,cAA2C,IAAI,MAAM;IACrD,OAAkB;IAClB,OAAkB;IAClB,oBAAyC,IAAI,MAAM;IACnD,uBAAuB,EAAE;IAEjC,YAAY,MAAiB,EAAE,MAAiB,CAAE;QAChD,IAAI,CAAC,MAAM,GAAG;QACd,IAAI,CAAC,MAAM,GAAG;QAEd,wCAAmC;YACjC,QAAQ,SAAS;QACnB;;;IAGF;IAEA;;GAEC,GACD,MAAc,OAAO;QACnB,IAAI;YACF,IAAI,CAAC,IAAI,GAAG,IAAI,4KAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE;gBACvC,OAAO,IAAI,CAAC,MAAM,CAAC,KAAK,IAAI;gBAC5B,QAAQ;oBACN,YAAY;gBACd;YACF;YAEA,IAAI,CAAC,eAAe;QACtB,EAAE,OAAO,OAAO;YACd,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC;QACtB;IACF;IAEA;;GAEC,GACD,AAAQ,kBAAkB;QACxB,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE;QAEhB,YAAY;QACZ,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC;YACpB,QAAQ,GAAG,CAAC,qBAAqB;YACjC,8JAAY,CAAC,QAAQ,GAAG,SAAS,CAAC,QAAQ;QAC5C;QAEA,QAAQ;QACR,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,cAAc,CAAC;YAC1B,QAAQ,GAAG,CAAC,mCAAmC,KAAK,IAAI;YACxD,IAAI,CAAC,qBAAqB,CAAC;QAC7B;QAEA,QAAQ;QACR,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC;YACrB,QAAQ,KAAK,CAAC,qBAAqB;YACnC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,MAAM,MAAM,IAAI;QAC1C;QAEA,QAAQ;QACR,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,gBAAgB;YAC3B,QAAQ,GAAG,CAAC;YACZ,8JAAY,CAAC,QAAQ,GAAG,mBAAmB,CAAC;QAC9C;QAEA,UAAU;QACV,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,SAAS;YACpB,QAAQ,GAAG,CAAC;YACZ,8JAAY,CAAC,QAAQ,GAAG,mBAAmB,CAAC;QAC9C;IACF;IAEA;;GAEC,GACD,AAAQ,sBAAsB,IAAoB,EAAE;QAClD,MAAM,SAAS,KAAK,IAAI;QAExB,MAAM;QACN,KAAK,EAAE,CAAC,QAAQ;YACd,QAAQ,GAAG,CAAC,4BAA4B;YACxC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,QAAQ;YAC7B,IAAI,CAAC,iBAAiB,CAAC,MAAM,CAAC;YAE9B,WAAW;YACX,MAAM,WAAqB;gBACzB,IAAI;gBACJ,MAAM;gBACN,WAAW,IAAI,WAAW;gBAC1B,aAAa;gBACb,WAAW;gBACX,UAAU,KAAK,GAAG;YACpB;YAEA,8JAAY,CAAC,QAAQ,GAAG,OAAO,CAAC;YAChC,8JAAY,CAAC,QAAQ,GAAG,mBAAmB,CAAC;YAC5C,IAAI,CAAC,MAAM,CAAC,eAAe,CAAC;QAC9B;QAEA,SAAS;QACT,KAAK,EAAE,CAAC,QAAQ,CAAC;YACf,QAAQ,GAAG,CAAC,gCAAgC,QAAQ;YACpD,IAAI,CAAC,kBAAkB,CAAC,QAAQ;QAClC;QAEA,QAAQ;QACR,KAAK,EAAE,CAAC,SAAS;YACf,QAAQ,GAAG,CAAC,4BAA4B;YACxC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACxB,8JAAY,CAAC,QAAQ,GAAG,UAAU,CAAC;YACnC,IAAI,CAAC,MAAM,CAAC,kBAAkB,CAAC;QACjC;QAEA,KAAK;QACL,KAAK,EAAE,CAAC,SAAS,CAAC;YAChB,QAAQ,KAAK,CAAC,2BAA2B,QAAQ;YACjD,IAAI,CAAC,qBAAqB,CAAC,QAAQ;QACrC;IACF;IAEA;;GAEC,GACD,AAAQ,mBAAmB,MAAc,EAAE,IAAS,EAAE;QACpD,IAAI;YACF,MAAM,UAAuB;YAE7B,oBAAoB;YACpB,8JAAY,CAAC,QAAQ,GAAG,UAAU,CAAC,QAAQ;gBACzC,UAAU,KAAK,GAAG;YACpB;YAEA,aAAa;YACb,OAAQ,QAAQ,IAAI;gBAClB,KAAK;gBACL,KAAK;oBACH,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC;oBACtB;gBAEF,KAAK;oBACH,8JAAY,CAAC,QAAQ,GAAG,SAAS,CAAC,QAAQ,QAAQ,IAAI,CAAC,QAAQ;oBAC/D;gBAEF,KAAK;oBACH,aAAa;oBACb,8JAAY,CAAC,QAAQ,GAAG,UAAU,CAAC,QAAQ;wBACzC,MAAM,QAAQ,IAAI,CAAC,IAAI,IAAI;wBAC3B,WAAW;oBACb;oBACA;YACJ;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,uCAAuC;QACvD;IACF;IAEA;;GAEC,GACD,AAAQ,sBAAsB,MAAc,EAAE,KAAU,EAAE;QACxD,MAAM,WAAW,CAAC,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,WAAW,CAAC,IAAI;QAC7D,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,QAAQ;QAEnC,IAAI,WAAW,IAAI,CAAC,oBAAoB,EAAE;YACxC,SAAS;YACT,QAAQ,GAAG,CAAC,CAAC,sBAAsB,EAAE,OAAO,UAAU,EAAE,SAAS,CAAC,CAAC;YACnE,WAAW;gBACT,IAAI,CAAC,aAAa,CAAC;YACrB,GAAG,KAAK,GAAG,CAAC,GAAG,YAAY,OAAO,SAAS;QAC7C,OAAO;YACL,QAAQ;YACR,QAAQ,KAAK,CAAC,CAAC,6BAA6B,EAAE,OAAO,OAAO,EAAE,SAAS,SAAS,CAAC;YACjF,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,MAAM,CAAC,OAAO,EAAE,QAAQ;QAClD;IACF;IAEA;;GAEC,GACD,cAAc,MAAc,EAAiB;QAC3C,OAAO,IAAI,QAAQ,CAAC,SAAS;YAC3B,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE;gBACd,OAAO,IAAI,MAAM;gBACjB;YACF;YAEA,SAAS;YACT,IAAI,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,SAAS;gBAChC;gBACA;YACF;YAEA,QAAQ,GAAG,CAAC,wBAAwB;YACpC,8JAAY,CAAC,QAAQ,GAAG,mBAAmB,CAAC;YAE5C,MAAM,OAAO,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ;gBACrC,UAAU;gBACV,eAAe;YACjB;YAEA,IAAI,CAAC,qBAAqB,CAAC;YAE3B,QAAQ;YACR,KAAK,EAAE,CAAC,QAAQ;gBACd;YACF;YAEA,KAAK,EAAE,CAAC,SAAS,CAAC;gBAChB,OAAO;YACT;QACF;IACF;IAEA;;GAEC,GACD,WAAW,MAAc,EAAE,OAAoB,EAAW;QACxD,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC;QAClC,IAAI,CAAC,QAAQ,CAAC,KAAK,IAAI,EAAE;YACvB,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,OAAO;QACT;QAEA,IAAI;YACF,KAAK,IAAI,CAAC;YACV,OAAO;QACT,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,OAAO;QACT;IACF;IAEA;;GAEC,GACD,UAAU,OAAoB,EAAQ;QACpC,MAAM,QAAQ,8JAAY,CAAC,QAAQ;QACnC,MAAM,QAAQ,MAAM,IAAI,CAAC,MAAM,KAAK,CAAC,MAAM,IAAI,MAAM,CAAC,CAAC,IAAM,EAAE,SAAS;QAExE,KAAK,MAAM,QAAQ,MAAO;YACxB,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE,EAAE;QAC3B;IACF;IAEA;;GAEC,GACD,mBAAmB,MAAc,EAAQ;QACvC,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC;QAClC,IAAI,MAAM;YACR,KAAK,KAAK;YACV,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;QAC1B;IACF;IAEA;;GAEC,GACD,gBAAsB;QACpB,KAAK,MAAM,CAAC,QAAQ,KAAK,IAAI,IAAI,CAAC,WAAW,CAAC,OAAO,GAAI;YACvD,KAAK,KAAK;QACZ;QACA,IAAI,CAAC,WAAW,CAAC,KAAK;IACxB;IAEA;;GAEC,GACD,UAAgB;QACd,IAAI,CAAC,aAAa;QAElB,IAAI,IAAI,CAAC,IAAI,EAAE;YACb,IAAI,CAAC,IAAI,CAAC,OAAO;YACjB,IAAI,CAAC,IAAI,GAAG;QACd;IACF;IAEA;;GAEC,GACD,cAA6B;QAC3B,OAAO,IAAI,CAAC,IAAI,EAAE,MAAM;IAC1B;IAEA;;GAEC,GACD,oBAA8B;QAC5B,OAAO,MAAM,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI;IACzC;IAEA;;GAEC,GACD,cAAc,MAAc,EAAW;QACrC,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC;QAClC,OAAO,MAAM,QAAQ;IACvB;AACF;AAEA,wCAAwC;AAExC,IAAI,qBAAwC;AAErC,SAAS,eAAe,MAAiB,EAAE,MAAiB;IACjE,IAAI,oBAAoB;QACtB,mBAAmB,OAAO;IAC5B;IAEA,qBAAqB,IAAI,WAAW,QAAQ;IAC5C,OAAO;AACT;AAEO,SAAS;IACd,OAAO;AACT;AAEO,SAAS;IACd,IAAI,oBAAoB;QACtB,mBAAmB,OAAO;QAC1B,qBAAqB;IACvB;AACF"}},
    {"offset": {"line": 446, "column": 0}, "map": {"version":3,"sources":["file:///home/rg3270/family-messenger/components/chat/ChatMessage.tsx"],"sourcesContent":["'use client';\n\nimport type { ChatMessage as MessageType } from '@/types';\n\ninterface ChatMessageProps {\n  message: MessageType;\n  isMine: boolean;\n}\n\nexport default function ChatMessage({ message, isMine }: ChatMessageProps) {\n  const timeString = new Date(message.timestamp).toLocaleTimeString('ko-KR', {\n    hour: '2-digit',\n    minute: '2-digit',\n  });\n\n  return (\n    <div\n      className={`flex ${isMine ? 'justify-end' : 'justify-start'} animate-fade-in`}\n    >\n      <div className={`max-w-[80%] ${isMine ? 'items-end' : 'items-start'} flex flex-col`}>\n        {/* Î∞úÏã†Ïûê Ïù¥Î¶Ñ (ÎÇ¥ Î©îÏãúÏßÄÎäî ÌëúÏãú ÏïàÌï®) */}\n        {!isMine && (\n          <span className=\"text-xs text-gray-500 dark:text-gray-400 mb-1 ml-2\">\n            {message.senderId.slice(0, 8)}...\n          </span>\n        )}\n\n        {/* Î©îÏãúÏßÄ Î≤ÑÎ∏î */}\n        <div className={`message-bubble ${isMine ? 'message-sent' : 'message-received'}`}>\n          <p className=\"text-sm whitespace-pre-wrap break-words\">\n            {message.content}\n          </p>\n\n          {/* Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ */}\n          <div className={`flex items-center gap-2 mt-1 ${isMine ? 'justify-end' : 'justify-start'}`}>\n            <span className=\"text-xs opacity-70\">\n              {timeString}\n            </span>\n\n            {/* ÏïîÌò∏Ìôî ÌëúÏãú */}\n            {message.encrypted && (\n              <span className=\"text-xs opacity-70\" title=\"End-to-End ÏïîÌò∏ÌôîÎê®\">\n                üîí\n              </span>\n            )}\n\n            {/* Ï†ÑÏÜ° ÏÉÅÌÉú (ÎÇ¥ Î©îÏãúÏßÄÎßå) */}\n            {isMine && (\n              <MessageStatus status={message.status} />\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// ============ Î©îÏãúÏßÄ ÏÉÅÌÉú Ïª¥Ìè¨ÎÑåÌä∏ ============\n\ninterface MessageStatusProps {\n  status: MessageType['status'];\n}\n\nfunction MessageStatus({ status }: MessageStatusProps) {\n  const statusConfig = {\n    sending: { icon: '‚è≥', label: 'Ï†ÑÏÜ° Ï§ë' },\n    sent: { icon: '‚úì', label: 'Ï†ÑÏÜ°Îê®' },\n    delivered: { icon: '‚úì‚úì', label: 'ÎèÑÏ∞©' },\n    read: { icon: '‚úì‚úì‚úì', label: 'ÏùΩÏùå' },\n  };\n\n  const config = statusConfig[status];\n\n  return (\n    <span className=\"text-xs opacity-70\" title={config.label}>\n      {config.icon}\n    </span>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;;AASe,SAAS,YAAY,EAAE,OAAO,EAAE,MAAM,EAAoB;IACvE,MAAM,aAAa,IAAI,KAAK,QAAQ,SAAS,EAAE,kBAAkB,CAAC,SAAS;QACzE,MAAM;QACN,QAAQ;IACV;IAEA,qBACE,qQAAC;QACC,WAAW,CAAC,KAAK,EAAE,SAAS,gBAAgB,gBAAgB,gBAAgB,CAAC;kBAE7E,cAAA,qQAAC;YAAI,WAAW,CAAC,YAAY,EAAE,SAAS,cAAc,cAAc,cAAc,CAAC;;gBAEhF,CAAC,wBACA,qQAAC;oBAAK,WAAU;;wBACb,QAAQ,QAAQ,CAAC,KAAK,CAAC,GAAG;wBAAG;;;;;;;8BAKlC,qQAAC;oBAAI,WAAW,CAAC,eAAe,EAAE,SAAS,iBAAiB,oBAAoB;;sCAC9E,qQAAC;4BAAE,WAAU;sCACV,QAAQ,OAAO;;;;;;sCAIlB,qQAAC;4BAAI,WAAW,CAAC,6BAA6B,EAAE,SAAS,gBAAgB,iBAAiB;;8CACxF,qQAAC;oCAAK,WAAU;8CACb;;;;;;gCAIF,QAAQ,SAAS,kBAChB,qQAAC;oCAAK,WAAU;oCAAqB,OAAM;8CAAkB;;;;;;gCAM9D,wBACC,qQAAC;oCAAc,QAAQ,QAAQ,MAAM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOnD;AAQA,SAAS,cAAc,EAAE,MAAM,EAAsB;IACnD,MAAM,eAAe;QACnB,SAAS;YAAE,MAAM;YAAK,OAAO;QAAO;QACpC,MAAM;YAAE,MAAM;YAAK,OAAO;QAAM;QAChC,WAAW;YAAE,MAAM;YAAM,OAAO;QAAK;QACrC,MAAM;YAAE,MAAM;YAAO,OAAO;QAAK;IACnC;IAEA,MAAM,SAAS,YAAY,CAAC,OAAO;IAEnC,qBACE,qQAAC;QAAK,WAAU;QAAqB,OAAO,OAAO,KAAK;kBACrD,OAAO,IAAI;;;;;;AAGlB"}},
    {"offset": {"line": 570, "column": 0}, "map": {"version":3,"sources":["file:///home/rg3270/family-messenger/components/chat/MessageInput.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport { useChatStore } from '@/stores/chat-store';\nimport { getP2PManager } from '@/lib/webrtc/peer';\nimport type { DataMessage } from '@/types';\n\nexport default function MessageInput() {\n  const [text, setText] = useState('');\n  const [isTyping, setIsTyping] = useState(false);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n\n  const { myPeerId } = useChatStore();\n\n  // ÌÉÄÏù¥Ìïë Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ Ï†ÑÏÜ°\n  useEffect(() => {\n    if (!isTyping || !myPeerId) return;\n\n    const p2pManager = getP2PManager();\n    if (!p2pManager) return;\n\n    const typingMessage: DataMessage = {\n      id: crypto.randomUUID(),\n      type: 'typing',\n      senderId: myPeerId,\n      timestamp: Date.now(),\n      data: { isTyping: true },\n    };\n\n    p2pManager.broadcast(typingMessage);\n\n    // 3Ï¥à ÌõÑ ÌÉÄÏù¥Ìïë Ï¢ÖÎ£å\n    const timeout = setTimeout(() => {\n      setIsTyping(false);\n    }, 3000);\n\n    return () => clearTimeout(timeout);\n  }, [isTyping, myPeerId]);\n\n  const handleSend = () => {\n    if (!text.trim() || !myPeerId) return;\n\n    // Î©îÏãúÏßÄ ÏÉùÏÑ±\n    const message: DataMessage = {\n      id: crypto.randomUUID(),\n      type: 'text',\n      senderId: myPeerId,\n      timestamp: Date.now(),\n      data: text,\n      encrypted: true,\n    };\n\n    // P2PÎ°ú Ï†ÑÏÜ°\n    const p2pManager = getP2PManager();\n    if (p2pManager) {\n      p2pManager.broadcast(message);\n\n      if (true) {\n        // Î°úÏª¨ Î©îÏãúÏßÄ Î™©Î°ùÏóê Ï∂îÍ∞Ä\n        useChatStore.getState().addMessage({\n          id: message.id,\n          senderId: myPeerId,\n          content: text,\n          timestamp: Date.now(),\n          status: 'sent',\n          encrypted: true,\n        });\n\n        setText('');\n        setIsTyping(false);\n      }\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    }\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    setText(e.target.value);\n\n    // ÌÉÄÏù¥Ìïë Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ ÌôúÏÑ±Ìôî\n    if (!isTyping && e.target.value.length > 0) {\n      setIsTyping(true);\n    }\n  };\n\n  return (\n    <div className=\"flex items-end gap-2\">\n      {/* ÌÖçÏä§Ìä∏ ÏûÖÎ†• */}\n      <div className=\"flex-1 relative\">\n        <textarea\n          ref={textareaRef}\n          value={text}\n          onChange={handleChange}\n          onKeyDown={handleKeyDown}\n          placeholder=\"Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî... (Shift+EnterÎ°ú Ï§ÑÎ∞îÍøà)\"\n          className=\"w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-2 border-transparent focus:border-blue-500 focus:bg-white dark:focus:bg-gray-600 rounded-2xl resize-none focus:outline-none transition-colors text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400\"\n          rows={1}\n          style={{ minHeight: '48px', maxHeight: '120px' }}\n        />\n\n        {/* ÏïîÌò∏Ìôî ÌëúÏãú */}\n        <div className=\"absolute right-3 bottom-3 text-xs text-secure-green flex items-center gap-1\">\n          <span className=\"animate-pulse\">üîí</span>\n          <span className=\"hidden sm:inline\">E2E</span>\n        </div>\n      </div>\n\n      {/* Ï†ÑÏÜ° Î≤ÑÌäº */}\n      <button\n        onClick={handleSend}\n        disabled={!text.trim()}\n        className=\"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-2xl font-semibold hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2\"\n        aria-label=\"Î©îÏãúÏßÄ Ï†ÑÏÜ°\"\n      >\n        <span className=\"hidden sm:inline\">Ï†ÑÏÜ°</span>\n        <span className=\"text-xl\">‚û§</span>\n      </button>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAOe,SAAS;IACtB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,wOAAQ,EAAC;IACjC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,wOAAQ,EAAC;IACzC,MAAM,cAAc,IAAA,sOAAM,EAAsB;IAEhD,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,8JAAY;IAEjC,eAAe;IACf,IAAA,yOAAS,EAAC;QACR,IAAI,CAAC,YAAY,CAAC,UAAU;QAE5B,MAAM,aAAa,IAAA,6JAAa;QAChC,IAAI,CAAC,YAAY;QAEjB,MAAM,gBAA6B;YACjC,IAAI,OAAO,UAAU;YACrB,MAAM;YACN,UAAU;YACV,WAAW,KAAK,GAAG;YACnB,MAAM;gBAAE,UAAU;YAAK;QACzB;QAEA,WAAW,SAAS,CAAC;QAErB,cAAc;QACd,MAAM,UAAU,WAAW;YACzB,YAAY;QACd,GAAG;QAEH,OAAO,IAAM,aAAa;IAC5B,GAAG;QAAC;QAAU;KAAS;IAEvB,MAAM,aAAa;QACjB,IAAI,CAAC,KAAK,IAAI,MAAM,CAAC,UAAU;QAE/B,SAAS;QACT,MAAM,UAAuB;YAC3B,IAAI,OAAO,UAAU;YACrB,MAAM;YACN,UAAU;YACV,WAAW,KAAK,GAAG;YACnB,MAAM;YACN,WAAW;QACb;QAEA,UAAU;QACV,MAAM,aAAa,IAAA,6JAAa;QAChC,IAAI,YAAY;YACd,WAAW,SAAS,CAAC;YAErB,wCAAU;gBACR,gBAAgB;gBAChB,8JAAY,CAAC,QAAQ,GAAG,UAAU,CAAC;oBACjC,IAAI,QAAQ,EAAE;oBACd,UAAU;oBACV,SAAS;oBACT,WAAW,KAAK,GAAG;oBACnB,QAAQ;oBACR,WAAW;gBACb;gBAEA,QAAQ;gBACR,YAAY;YACd;QACF;IACF;IAEA,MAAM,gBAAgB,CAAC;QACrB,IAAI,EAAE,GAAG,KAAK,WAAW,CAAC,EAAE,QAAQ,EAAE;YACpC,EAAE,cAAc;YAChB;QACF;IACF;IAEA,MAAM,eAAe,CAAC;QACpB,QAAQ,EAAE,MAAM,CAAC,KAAK;QAEtB,gBAAgB;QAChB,IAAI,CAAC,YAAY,EAAE,MAAM,CAAC,KAAK,CAAC,MAAM,GAAG,GAAG;YAC1C,YAAY;QACd;IACF;IAEA,qBACE,qQAAC;QAAI,WAAU;;0BAEb,qQAAC;gBAAI,WAAU;;kCACb,qQAAC;wBACC,KAAK;wBACL,OAAO;wBACP,UAAU;wBACV,WAAW;wBACX,aAAY;wBACZ,WAAU;wBACV,MAAM;wBACN,OAAO;4BAAE,WAAW;4BAAQ,WAAW;wBAAQ;;;;;;kCAIjD,qQAAC;wBAAI,WAAU;;0CACb,qQAAC;gCAAK,WAAU;0CAAgB;;;;;;0CAChC,qQAAC;gCAAK,WAAU;0CAAmB;;;;;;;;;;;;;;;;;;0BAKvC,qQAAC;gBACC,SAAS;gBACT,UAAU,CAAC,KAAK,IAAI;gBACpB,WAAU;gBACV,cAAW;;kCAEX,qQAAC;wBAAK,WAAU;kCAAmB;;;;;;kCACnC,qQAAC;wBAAK,WAAU;kCAAU;;;;;;;;;;;;;;;;;;AAIlC"}},
    {"offset": {"line": 748, "column": 0}, "map": {"version":3,"sources":["file:///home/rg3270/family-messenger/components/security/SecurityIndicator.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useChatStore } from '@/stores/chat-store';\n\ninterface SecurityStatus {\n  level: 'secure' | 'warning' | 'insecure';\n  message: string;\n}\n\nexport default function SecurityIndicator() {\n  const { isAuthenticated, connectionStatus, peers } = useChatStore();\n  const [securityStatus, setSecurityStatus] = useState<SecurityStatus>({\n    level: 'secure',\n    message: 'E2E ÏïîÌò∏Ìôî ÌôúÏÑ±Ìôî',\n  });\n\n  useEffect(() => {\n    if (!isAuthenticated) {\n      setSecurityStatus({\n        level: 'insecure',\n        message: 'ÎØ∏Ïù∏Ï¶ù',\n      });\n      return;\n    }\n\n    if (connectionStatus !== 'connected') {\n      setSecurityStatus({\n        level: 'warning',\n        message: 'Ïó∞Í≤∞ ÏïàÎê®',\n      });\n      return;\n    }\n\n    const connectedCount = Array.from(peers.values()).filter((p) => p.connected).length;\n\n    if (connectedCount === 0) {\n      setSecurityStatus({\n        level: 'warning',\n        message: 'Í∞ÄÏ°±Ïõê ÎåÄÍ∏∞ Ï§ë',\n      });\n      return;\n    }\n\n    setSecurityStatus({\n      level: 'secure',\n      message: 'E2E ÏïîÌò∏Ìôî',\n    });\n  }, [isAuthenticated, connectionStatus, peers]);\n\n  const levelConfig = {\n    secure: {\n      containerClass: 'bg-secure-green/10 text-secure-green border-secure-green/20',\n      dotClass: 'bg-secure-green animate-pulse',\n      icon: 'üîí',\n    },\n    warning: {\n      containerClass: 'bg-secure-yellow/10 text-secure-yellow border-secure-yellow/20',\n      dotClass: 'bg-secure-yellow animate-pulse',\n      icon: '‚ö†Ô∏è',\n    },\n    insecure: {\n      containerClass: 'bg-secure-red/10 text-secure-red border-secure-red/20',\n      dotClass: 'bg-secure-red',\n      icon: 'üîì',\n    },\n  };\n\n  const config = levelConfig[securityStatus.level];\n\n  return (\n    <div className={`security-badge ${config.containerClass} border`}>\n      <div className={`w-2 h-2 rounded-full ${config.dotClass}`} />\n      <span className=\"font-medium\">\n        {config.icon} {securityStatus.message}\n      </span>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAUe,SAAS;IACtB,MAAM,EAAE,eAAe,EAAE,gBAAgB,EAAE,KAAK,EAAE,GAAG,IAAA,8JAAY;IACjE,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,wOAAQ,EAAiB;QACnE,OAAO;QACP,SAAS;IACX;IAEA,IAAA,yOAAS,EAAC;QACR,IAAI,CAAC,iBAAiB;YACpB,kBAAkB;gBAChB,OAAO;gBACP,SAAS;YACX;YACA;QACF;QAEA,IAAI,qBAAqB,aAAa;YACpC,kBAAkB;gBAChB,OAAO;gBACP,SAAS;YACX;YACA;QACF;QAEA,MAAM,iBAAiB,MAAM,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM,CAAC,CAAC,IAAM,EAAE,SAAS,EAAE,MAAM;QAEnF,IAAI,mBAAmB,GAAG;YACxB,kBAAkB;gBAChB,OAAO;gBACP,SAAS;YACX;YACA;QACF;QAEA,kBAAkB;YAChB,OAAO;YACP,SAAS;QACX;IACF,GAAG;QAAC;QAAiB;QAAkB;KAAM;IAE7C,MAAM,cAAc;QAClB,QAAQ;YACN,gBAAgB;YAChB,UAAU;YACV,MAAM;QACR;QACA,SAAS;YACP,gBAAgB;YAChB,UAAU;YACV,MAAM;QACR;QACA,UAAU;YACR,gBAAgB;YAChB,UAAU;YACV,MAAM;QACR;IACF;IAEA,MAAM,SAAS,WAAW,CAAC,eAAe,KAAK,CAAC;IAEhD,qBACE,qQAAC;QAAI,WAAW,CAAC,eAAe,EAAE,OAAO,cAAc,CAAC,OAAO,CAAC;;0BAC9D,qQAAC;gBAAI,WAAW,CAAC,qBAAqB,EAAE,OAAO,QAAQ,EAAE;;;;;;0BACzD,qQAAC;gBAAK,WAAU;;oBACb,OAAO,IAAI;oBAAC;oBAAE,eAAe,OAAO;;;;;;;;;;;;;AAI7C"}},
    {"offset": {"line": 848, "column": 0}, "map": {"version":3,"sources":["file:///home/rg3270/family-messenger/components/p2p/PeerConnection.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport { QRCodeSVG as QRCode } from 'qrcode.react';\nimport { useChatStore } from '@/stores/chat-store';\n\ninterface PeerConnectionProps {\n  isOpen: boolean;\n  onClose: () => void;\n  myPeerId: string;\n  onConnect: (peerId: string) => Promise<void>;\n}\n\nexport default function PeerConnection({ isOpen, onClose, myPeerId, onConnect }: PeerConnectionProps) {\n  const [tab, setTab] = useState<'my-code' | 'scan-code'>('my-code');\n  const [peerIdInput, setPeerIdInput] = useState('');\n  const [isConnecting, setIsConnecting] = useState(false);\n  const [error, setError] = useState('');\n\n  const resetForm = () => {\n    setPeerIdInput('');\n    setError('');\n    setIsConnecting(false);\n  };\n\n  const handleConnect = async () => {\n    if (!peerIdInput.trim()) {\n      setError('Peer IDÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî');\n      return;\n    }\n\n    if (peerIdInput === myPeerId) {\n      setError('ÏûêÍ∏∞ ÏûêÏã†ÏóêÍ≤åÎäî Ïó∞Í≤∞Ìï† Ïàò ÏóÜÏäµÎãàÎã§');\n      return;\n    }\n\n    setIsConnecting(true);\n    setError('');\n\n    try {\n      await onConnect(peerIdInput.trim());\n      onClose();\n      resetForm();\n    } catch (err) {\n      setError((err as Error).message || 'Ïó∞Í≤∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§');\n    } finally {\n      setIsConnecting(false);\n    }\n  };\n\n  // ESC ÌÇ§Î°ú Îã´Í∏∞\n  useEffect(() => {\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape' && isOpen) {\n        onClose();\n      }\n    };\n\n    window.addEventListener('keydown', handleEscape);\n    return () => window.removeEventListener('keydown', handleEscape);\n  }, [isOpen, onClose]);\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n      {/* Î∞∞Í≤Ω Ïò§Î≤ÑÎ†àÏù¥ */}\n      <div\n        className=\"absolute inset-0 bg-black/50 backdrop-blur-sm\"\n        onClick={onClose}\n      />\n\n      {/* Î™®Îã¨ ÏΩòÌÖêÏ∏† */}\n      <div className=\"relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto\">\n        {/* Ìó§Îçî */}\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700\">\n          <h2 className=\"text-xl font-bold text-gray-900 dark:text-white\">\n            Í∞ÄÏ°±Ïõê Ïó∞Í≤∞\n          </h2>\n          <button\n            onClick={onClose}\n            className=\"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors\"\n            aria-label=\"Îã´Í∏∞\"\n          >\n            ‚úï\n          </button>\n        </div>\n\n        {/* ÌÉ≠ */}\n        <div className=\"flex border-b border-gray-200 dark:border-gray-700\">\n          <button\n            onClick={() => {\n              setTab('my-code');\n              resetForm();\n            }}\n            className={`flex-1 py-4 font-medium transition-colors ${\n              tab === 'my-code'\n                ? 'text-blue-600 border-b-2 border-blue-600'\n                : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'\n            }`}\n          >\n            ÎÇ¥ ÏΩîÎìú\n          </button>\n          <button\n            onClick={() => {\n              setTab('scan-code');\n              resetForm();\n            }}\n            className={`flex-1 py-4 font-medium transition-colors ${\n              tab === 'scan-code'\n                ? 'text-blue-600 border-b-2 border-blue-600'\n                : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'\n            }`}\n          >\n            ÏΩîÎìú ÏûÖÎ†•\n          </button>\n        </div>\n\n        {/* ÏΩòÌÖêÏ∏† */}\n        <div className=\"p-6\">\n          {/* ÎÇ¥ ÏΩîÎìú ÌÉ≠ */}\n          {tab === 'my-code' && (\n            <div className=\"text-center space-y-6\">\n              <div className=\"space-y-2\">\n                <h3 className=\"font-semibold text-gray-900 dark:text-white\">\n                  ÎÇ¥ Peer ID\n                </h3>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                  Ïù¥ QR ÏΩîÎìúÎ•º Í∞ÄÏ°±ÏõêÏóêÍ≤å Î≥¥Ïó¨Ï£ºÏÑ∏Ïöî\n                </p>\n              </div>\n\n              {/* QR ÏΩîÎìú */}\n              <div className=\"bg-white p-6 rounded-xl border-2 border-dashed border-gray-300 inline-block\">\n                <QRCode\n                  value={JSON.stringify({ pid: myPeerId, v: 1 })}\n                  size={200}\n                  level=\"H\"\n                  includeMargin={false}\n                />\n              </div>\n\n              {/* ÌÖçÏä§Ìä∏ Î≥µÏÇ¨ */}\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                  Peer ID (Î≥µÏÇ¨Ìï¥ÏÑú Í≥µÏú†)\n                </label>\n                <div className=\"flex gap-2\">\n                  <input\n                    type=\"text\"\n                    value={myPeerId}\n                    readOnly\n                    className=\"flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-gray-900 dark:text-white text-sm font-mono\"\n                  />\n                  <button\n                    onClick={() => navigator.clipboard.writeText(myPeerId)}\n                    className=\"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium\"\n                  >\n                    Î≥µÏÇ¨\n                  </button>\n                </div>\n              </div>\n\n              {/* ÏïàÎÇ¥ */}\n              <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 text-left\">\n                <p className=\"text-sm text-blue-800 dark:text-blue-300\">\n                  üí° <strong>ÌåÅ:</strong> Í∞ÄÏ°±ÏõêÏù¥ Ïù¥ QR ÏΩîÎìúÎ•º Ïä§Ï∫îÌïòÍ±∞ÎÇò Peer IDÎ•º ÏûÖÎ†•ÌïòÎ©¥ Ïó∞Í≤∞Îê©ÎãàÎã§.\n                </p>\n              </div>\n            </div>\n          )}\n\n          {/* ÏΩîÎìú ÏûÖÎ†• ÌÉ≠ */}\n          {tab === 'scan-code' && (\n            <div className=\"space-y-6\">\n              <div className=\"space-y-2\">\n                <h3 className=\"font-semibold text-gray-900 dark:text-white\">\n                  Í∞ÄÏ°±Ïõê Peer ID ÏûÖÎ†•\n                </h3>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                  Í∞ÄÏ°±ÏõêÏóêÍ≤å Î∞õÏùÄ Peer IDÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî\n                </p>\n              </div>\n\n              {/* ÏûÖÎ†• ÌïÑÎìú */}\n              <div className=\"space-y-4\">\n                <div>\n                  <label\n                    htmlFor=\"peerIdInput\"\n                    className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\"\n                  >\n                    Peer ID\n                  </label>\n                  <input\n                    id=\"peerIdInput\"\n                    type=\"text\"\n                    value={peerIdInput}\n                    onChange={(e) => setPeerIdInput(e.target.value)}\n                    placeholder=\"Í∞ÄÏ°±ÏõêÏùò Peer IDÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî\"\n                    className=\"w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:border-blue-500 focus:outline-none focus:bg-white dark:focus:bg-gray-600 transition-colors text-gray-900 dark:text-white\"\n                    disabled={isConnecting}\n                    autoFocus\n                  />\n                </div>\n\n                {/* ÏóêÎü¨ ÌëúÏãú */}\n                {error && (\n                  <div className=\"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 px-4 py-3 rounded-lg text-sm\">\n                    ‚ö†Ô∏è {error}\n                  </div>\n                )}\n\n                {/* Ïó∞Í≤∞ Î≤ÑÌäº */}\n                <button\n                  onClick={handleConnect}\n                  disabled={!peerIdInput.trim() || isConnecting}\n                  className=\"w-full py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl font-semibold hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2\"\n                >\n                  {isConnecting ? (\n                    <>\n                      <span className=\"animate-spin\">‚è≥</span>\n                      <span>Ïó∞Í≤∞ Ï§ë...</span>\n                    </>\n                  ) : (\n                    <>\n                      <span>üîó</span>\n                      <span>Ïó∞Í≤∞ÌïòÍ∏∞</span>\n                    </>\n                  )}\n                </button>\n              </div>\n\n              {/* ÏïàÎÇ¥ */}\n              <div className=\"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4\">\n                <h4 className=\"font-medium text-gray-900 dark:text-white mb-2\">\n                  Ïó∞Í≤∞ Î∞©Î≤ï\n                </h4>\n                <ol className=\"text-sm text-gray-600 dark:text-gray-400 space-y-1 list-decimal list-inside\">\n                  <li>Í∞ÄÏ°±ÏõêÏóêÍ≤å Peer IDÎ•º Î∞õÏúºÏÑ∏Ïöî</li>\n                  <li>ÏúÑ ÏûÖÎ†•Ï∞ΩÏóê Peer IDÎ•º Î∂ôÏó¨ÎÑ£ÏúºÏÑ∏Ïöî</li>\n                  <li>\"Ïó∞Í≤∞ÌïòÍ∏∞\" Î≤ÑÌäºÏùÑ ÎàÑÎ•¥ÏÑ∏Ïöî</li>\n                </ol>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAae,SAAS,eAAe,EAAE,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAuB;IAClG,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,wOAAQ,EAA0B;IACxD,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,wOAAQ,EAAC;IAC/C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,wOAAQ,EAAC;IACjD,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,wOAAQ,EAAC;IAEnC,MAAM,YAAY;QAChB,eAAe;QACf,SAAS;QACT,gBAAgB;IAClB;IAEA,MAAM,gBAAgB;QACpB,IAAI,CAAC,YAAY,IAAI,IAAI;YACvB,SAAS;YACT;QACF;QAEA,IAAI,gBAAgB,UAAU;YAC5B,SAAS;YACT;QACF;QAEA,gBAAgB;QAChB,SAAS;QAET,IAAI;YACF,MAAM,UAAU,YAAY,IAAI;YAChC;YACA;QACF,EAAE,OAAO,KAAK;YACZ,SAAS,AAAC,IAAc,OAAO,IAAI;QACrC,SAAU;YACR,gBAAgB;QAClB;IACF;IAEA,YAAY;IACZ,IAAA,yOAAS,EAAC;QACR,MAAM,eAAe,CAAC;YACpB,IAAI,EAAE,GAAG,KAAK,YAAY,QAAQ;gBAChC;YACF;QACF;QAEA,OAAO,gBAAgB,CAAC,WAAW;QACnC,OAAO,IAAM,OAAO,mBAAmB,CAAC,WAAW;IACrD,GAAG;QAAC;QAAQ;KAAQ;IAEpB,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACE,qQAAC;QAAI,WAAU;;0BAEb,qQAAC;gBACC,WAAU;gBACV,SAAS;;;;;;0BAIX,qQAAC;gBAAI,WAAU;;kCAEb,qQAAC;wBAAI,WAAU;;0CACb,qQAAC;gCAAG,WAAU;0CAAkD;;;;;;0CAGhE,qQAAC;gCACC,SAAS;gCACT,WAAU;gCACV,cAAW;0CACZ;;;;;;;;;;;;kCAMH,qQAAC;wBAAI,WAAU;;0CACb,qQAAC;gCACC,SAAS;oCACP,OAAO;oCACP;gCACF;gCACA,WAAW,CAAC,0CAA0C,EACpD,QAAQ,YACJ,6CACA,iFACJ;0CACH;;;;;;0CAGD,qQAAC;gCACC,SAAS;oCACP,OAAO;oCACP;gCACF;gCACA,WAAW,CAAC,0CAA0C,EACpD,QAAQ,cACJ,6CACA,iFACJ;0CACH;;;;;;;;;;;;kCAMH,qQAAC;wBAAI,WAAU;;4BAEZ,QAAQ,2BACP,qQAAC;gCAAI,WAAU;;kDACb,qQAAC;wCAAI,WAAU;;0DACb,qQAAC;gDAAG,WAAU;0DAA8C;;;;;;0DAG5D,qQAAC;gDAAE,WAAU;0DAA2C;;;;;;;;;;;;kDAM1D,qQAAC;wCAAI,WAAU;kDACb,cAAA,qQAAC,0LAAM;4CACL,OAAO,KAAK,SAAS,CAAC;gDAAE,KAAK;gDAAU,GAAG;4CAAE;4CAC5C,MAAM;4CACN,OAAM;4CACN,eAAe;;;;;;;;;;;kDAKnB,qQAAC;wCAAI,WAAU;;0DACb,qQAAC;gDAAM,WAAU;0DAAuD;;;;;;0DAGxE,qQAAC;gDAAI,WAAU;;kEACb,qQAAC;wDACC,MAAK;wDACL,OAAO;wDACP,QAAQ;wDACR,WAAU;;;;;;kEAEZ,qQAAC;wDACC,SAAS,IAAM,UAAU,SAAS,CAAC,SAAS,CAAC;wDAC7C,WAAU;kEACX;;;;;;;;;;;;;;;;;;kDAOL,qQAAC;wCAAI,WAAU;kDACb,cAAA,qQAAC;4CAAE,WAAU;;gDAA2C;8DACnD,qQAAC;8DAAO;;;;;;gDAAW;;;;;;;;;;;;;;;;;;4BAO7B,QAAQ,6BACP,qQAAC;gCAAI,WAAU;;kDACb,qQAAC;wCAAI,WAAU;;0DACb,qQAAC;gDAAG,WAAU;0DAA8C;;;;;;0DAG5D,qQAAC;gDAAE,WAAU;0DAA2C;;;;;;;;;;;;kDAM1D,qQAAC;wCAAI,WAAU;;0DACb,qQAAC;;kEACC,qQAAC;wDACC,SAAQ;wDACR,WAAU;kEACX;;;;;;kEAGD,qQAAC;wDACC,IAAG;wDACH,MAAK;wDACL,OAAO;wDACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;wDAC9C,aAAY;wDACZ,WAAU;wDACV,UAAU;wDACV,SAAS;;;;;;;;;;;;4CAKZ,uBACC,qQAAC;gDAAI,WAAU;;oDAA2F;oDACpG;;;;;;;0DAKR,qQAAC;gDACC,SAAS;gDACT,UAAU,CAAC,YAAY,IAAI,MAAM;gDACjC,WAAU;0DAET,6BACC;;sEACE,qQAAC;4DAAK,WAAU;sEAAe;;;;;;sEAC/B,qQAAC;sEAAK;;;;;;;iFAGR;;sEACE,qQAAC;sEAAK;;;;;;sEACN,qQAAC;sEAAK;;;;;;;;;;;;;;;;;;;kDAOd,qQAAC;wCAAI,WAAU;;0DACb,qQAAC;gDAAG,WAAU;0DAAiD;;;;;;0DAG/D,qQAAC;gDAAG,WAAU;;kEACZ,qQAAC;kEAAG;;;;;;kEACJ,qQAAC;kEAAG;;;;;;kEACJ,qQAAC;kEAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAStB"}},
    {"offset": {"line": 1305, "column": 0}, "map": {"version":3,"sources":["file:///home/rg3270/family-messenger/app/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useChatStore, selectConnectedPeers, selectTypingUsers } from '@/stores/chat-store';\nimport { initP2PManager, destroyP2PManager, getP2PManager } from '@/lib/webrtc/peer';\nimport type { DataMessage } from '@/types';\nimport ChatMessage from '@/components/chat/ChatMessage';\nimport MessageInput from '@/components/chat/MessageInput';\nimport SecurityIndicator from '@/components/security/SecurityIndicator';\nimport PeerConnection from '@/components/p2p/PeerConnection';\nimport { QRCodeSVG as QRCode } from 'qrcode.react';\n\nexport default function HomePage() {\n  const [isReady, setIsReady] = useState(false);\n  const [showQR, setShowQR] = useState(false);\n\n  const {\n    isAuthenticated,\n    myPeerId,\n    myName,\n    connectionStatus,\n    messages,\n    isSetupComplete,\n  } = useChatStore();\n\n  const connectedPeers = useChatStore(selectConnectedPeers);\n  const typingUsers = useChatStore(selectTypingUsers);\n\n  // P2P Í¥ÄÎ¶¨Ïûê Ï¥àÍ∏∞Ìôî\n  useEffect(() => {\n    const p2pManager = initP2PManager(\n      { debug: true },\n      {\n        onPeerConnected: (peer) => console.log('Peer connected:', peer),\n        onPeerDisconnected: (peerId) => console.log('Peer disconnected:', peerId),\n        onMessage: (message) => {\n          if (message.type === 'text') {\n            useChatStore.getState().addMessage({\n              id: message.id,\n              senderId: message.senderId,\n              content: message.data,\n              timestamp: message.timestamp,\n              status: 'delivered',\n              encrypted: message.encrypted || false,\n            });\n          }\n        },\n        onError: (error) => console.error('P2P error:', error),\n      }\n    );\n\n    return () => { destroyP2PManager(); };\n  }, []);\n\n  // Ï¥àÍ∏∞ ÏÑ§Ï†ïÏù¥ Ïïà Îêú Í≤ΩÏö∞\n  if (!isSetupComplete) {\n    return <InitialSetup onSetupComplete={() => setIsReady(true)} />;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n      <header className=\"bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 sticky top-0 z-10\">\n        <div className=\"max-w-4xl mx-auto px-4 py-3 flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center\">\n              <span className=\"text-white text-xl\">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>\n            </div>\n            <div>\n              <h1 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Í∞ÄÏ°± Î©îÏã†Ï†Ä</h1>\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">E2E ÏïîÌò∏Ìôî ÌôúÏÑ±Ìôî</p>\n            </div>\n          </div>\n          <SecurityIndicator />\n        </div>\n      </header>\n\n      <main className=\"max-w-4xl mx-auto p-4 pb-32\">\n        <ConnectionStatus status={connectionStatus} peerCount={connectedPeers.length} />\n        \n        <div className=\"message-list overflow-y-auto space-y-4\" style={{ maxHeight: 'calc(100vh - 300px)' }}>\n          {messages.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <div className=\"text-6xl mb-4\">üí¨</div>\n              <h2 className=\"text-xl font-semibold text-gray-700 dark:text-gray-300 mb-2\">ÏïÑÏßÅ Î©îÏãúÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§</h2>\n              <p className=\"text-gray-500 dark:text-gray-400\">Í∞ÄÏ°±ÏõêÏóêÍ≤å Ï≤´ Î©îÏãúÏßÄÎ•º Î≥¥ÎÇ¥Î≥¥ÏÑ∏Ïöî!</p>\n            </div>\n          ) : (\n            messages.map((message) => (\n              <ChatMessage key={message.id} message={message} isMine={message.senderId === myPeerId} />\n            ))\n          )}\n          {typingUsers.length > 0 && (\n            <div className=\"text-sm text-gray-500 dark:text-gray-400 animate-pulse\">\n              {typingUsers.join(', ')} ÎãòÏù¥ ÏûÖÎ†• Ï§ë...\n            </div>\n          )}\n        </div>\n      </main>\n\n      <footer className=\"fixed bottom-0 left-0 right-0 bg-white/90 dark:bg-gray-900/90 backdrop-blur-sm border-t border-gray-200 dark:border-gray-700\">\n        <div className=\"max-w-4xl mx-auto p-4\"><MessageInput /></div>\n      </footer>\n\n      <PeerConnection\n        isOpen={showQR}\n        onClose={() => setShowQR(false)}\n        myPeerId={myPeerId}\n        onConnect={async (peerId) => {\n          const p2pManager = getP2PManager();\n          if (p2pManager) {\n            await p2pManager.connectToPeer(peerId);\n            setShowQR(false);\n          }\n        }}\n      />\n\n      <button onClick={() => setShowQR(true)} className=\"fixed bottom-24 right-4 w-14 h-14 bg-gradient-to-br from-blue-500 to-indigo-600 text-white rounded-full shadow-lg hover:shadow-xl transition-all flex items-center justify-center text-2xl\">\n        ‚ûï\n      </button>\n    </div>\n  );\n}\n\ninterface InitialSetupProps {\n  onSetupComplete: () => void;\n}\n\nfunction InitialSetup({ onSetupComplete }: InitialSetupProps) {\n  const [step, setStep] = useState<'welcome' | 'create' | 'join'>('welcome');\n  const [familyKey, setFamilyKey] = useState('');\n  const [myName, setMyName] = useState('');\n\n  const handleCreateFamily = () => {\n    const mockKey = Array.from(crypto.getRandomValues(new Uint8Array(32)))\n      .map(b => b.toString(16).padStart(2, '0'))\n      .join('');\n    setFamilyKey(mockKey);\n    setStep('create');\n  };\n\n  const handleJoinFamily = () => setStep('join');\n\n  const handleSetupComplete = () => {\n    useChatStore.getState().setSetupComplete(true);\n    useChatStore.getState().setMyInfo(crypto.randomUUID(), myName || 'ÎÇò');\n    useChatStore.getState().setAuthenticated(true);\n    onSetupComplete();\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 max-w-md w-full\">\n        {step === 'welcome' && (\n          <div className=\"text-center space-y-6\">\n            <div className=\"text-6xl\">üè†</div>\n            <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Í∞ÄÏ°± Î©îÏã†Ï†ÄÏóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§!</h1>\n            <p className=\"text-gray-600 dark:text-gray-400\">Í∞ÄÏ°± 3Î™ÖÎßåÏùÑ ÏúÑÌïú ÏôÑÏ†Ñ Î≥¥Ïïà Î©îÏã†Ï†ÄÎ•º ÏãúÏûëÌï¥Î≥¥ÏÑ∏Ïöî.</p>\n            <div className=\"space-y-3\">\n              <button onClick={handleCreateFamily} className=\"w-full py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl font-semibold hover:shadow-lg transition-all\">üÜï ÏÉà Í∞ÄÏ°± ÎßåÎì§Í∏∞</button>\n              <button onClick={handleJoinFamily} className=\"w-full py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-semibold hover:bg-gray-200 dark:hover:bg-gray-600 transition-all\">üîó Í∞ÄÏ°±Ïóê Ï∞∏Ïó¨ÌïòÍ∏∞</button>\n            </div>\n            <div className=\"text-xs text-gray-500 dark:text-gray-400 space-y-1\">\n              <p>üîí End-to-End ÏïîÌò∏Ìôî</p>\n              <p>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ P2P ÏßÅÏ†ë ÌÜµÏã†</p>\n              <p>üîê ÏÇ¨Ï†Ñ Í≥µÏú† ÌÇ§ Ïù∏Ï¶ù</p>\n            </div>\n          </div>\n        )}\n\n        {step === 'create' && (\n          <div className=\"text-center space-y-6\">\n            <h2 className=\"text-xl font-bold text-gray-900 dark:text-white\">Í∞ÄÏ°± ÌÇ§Í∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!</h2>\n            <p className=\"text-gray-600 dark:text-gray-400\">Ïù¥ QR ÏΩîÎìúÎ•º Í∞ÄÏ°±ÏõêÏóêÍ≤å Î≥¥Ïó¨Ï£ºÏÑ∏Ïöî</p>\n            <div className=\"bg-white p-4 rounded-xl border-2 border-dashed border-gray-300\">\n              <QRCode value={JSON.stringify({ key: familyKey, type: 'family-key' })} size={200} level=\"H\" includeMargin={false} />\n            </div>\n            <div className=\"text-xs text-gray-500 dark:text-gray-400\">‚ö†Ô∏è Ïù¥ ÏΩîÎìúÎäî ÏïàÏ†ÑÌïòÍ≤å Î≥¥Í¥ÄÌïòÏÑ∏Ïöî. Î∂ÑÏã§ Ïãú Ïû¨Î∞úÍ∏âÌï† Ïàò ÏóÜÏäµÎãàÎã§.</div>\n            <button onClick={handleSetupComplete} className=\"w-full py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl font-semibold hover:shadow-lg transition-all\">ÏãúÏûëÌïòÍ∏∞</button>\n          </div>\n        )}\n\n        {step === 'join' && (\n          <div className=\"text-center space-y-6\">\n            <h2 className=\"text-xl font-bold text-gray-900 dark:text-white\">Í∞ÄÏ°± ÏΩîÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî</h2>\n            <input type=\"text\" value={familyKey} onChange={(e) => setFamilyKey(e.target.value)} placeholder=\"Í∞ÄÏ°± ÏΩîÎìú ÏûÖÎ†•\" className=\"w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white\" />\n            <button onClick={handleSetupComplete} disabled={!familyKey} className=\"w-full py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl font-semibold hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed\">Ï∞∏Ïó¨ÌïòÍ∏∞</button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\ninterface ConnectionStatusProps {\n  status: 'disconnected' | 'connecting' | 'connected';\n  peerCount: number;\n}\n\nfunction ConnectionStatus({ status, peerCount }: ConnectionStatusProps) {\n  const statusConfig = {\n    disconnected: { color: 'bg-secure-red', text: 'Ïó∞Í≤∞ ÏïàÎê®' },\n    connecting: { color: 'bg-secure-yellow', text: 'Ïó∞Í≤∞ Ï§ë...' },\n    connected: { color: 'bg-secure-green', text: 'Ïó∞Í≤∞Îê®' },\n  };\n  const config = statusConfig[status];\n\n  return (\n    <div className=\"mb-4 bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-3\">\n          <div className={`w-3 h-3 rounded-full ${config.color} ${status === 'connected' ? 'animate-pulse' : ''}`} />\n          <span className=\"font-medium text-gray-900 dark:text-white\">{config.text}</span>\n        </div>\n        <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n          {peerCount > 0 ? `Í∞ÄÏ°±Ïõê ${peerCount}Î™ÖÍ≥º Ïó∞Í≤∞Îê®` : 'Í∞ÄÏ°±ÏõêÏùÑ Í∏∞Îã§Î¶¨Îäî Ï§ë...'}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}